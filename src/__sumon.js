var CAAT=CAAT||{};Function.prototype.bind=Function.prototype.bind||function(){var fn=this;var args=Array.prototype.slice.call(arguments);var obj=args.shift();return function(){return fn.apply(obj,args.concat(Array.prototype.slice.call(arguments)))}};
function extend(subc,superc){var subcp=subc.prototype;var F=function(){};F.prototype=superc.prototype;subc.prototype=new F;subc.superclass=superc.prototype;subc.prototype.constructor=subc;if(superc.prototype.constructor===Object.prototype.constructor)superc.prototype.constructor=superc;for(var method in subcp)if(subcp.hasOwnProperty(method))subc.prototype[method]=subcp[method]}
function proxy(object,preMethod,postMethod,errorMethod){if(typeof object==="function"){if(object.__isProxy)return object;return function(fn){var proxyfn=function(){if(preMethod)preMethod({fn:fn,arguments:Array.prototype.slice.call(arguments)});var retValue=null;try{retValue=fn.apply(fn,Array.prototype.slice.call(arguments));if(postMethod)postMethod({fn:fn,arguments:Array.prototype.slice.call(arguments)})}catch(e){if(errorMethod)retValue=errorMethod({fn:fn,arguments:Array.prototype.slice.call(arguments),
exception:e});else throw e;}return retValue};proxyfn.__isProxy=true;return proxyfn}(object)}if(!typeof object==="object"||object.constructor===Array||object.constructor===String||object.__isProxy)return object;var cproxy=function(){};var proxy=new cproxy;proxy.__object=object;proxy.__isProxy=true;for(var method in object)if(typeof object[method]==="function")proxy[method]=function(proxy,fn,method){return function(){if(preMethod)preMethod({object:proxy.__object,method:method,arguments:Array.prototype.slice.call(arguments)});
var retValue=null;try{retValue=fn.apply(proxy.__object,arguments);if(postMethod)postMethod({object:proxy.__object,method:method,arguments:Array.prototype.slice.call(arguments)})}catch(e){if(errorMethod)retValue=errorMethod({object:proxy.__object,method:method,arguments:Array.prototype.slice.call(arguments),exception:e});else throw e;}return retValue}}(proxy,object[method],method);return proxy}
(function(){CAAT.Matrix3=function(){this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};CAAT.Matrix3.prototype={matrix:null,fmatrix:null,transformCoord:function(point){var x=point.x;var y=point.y;var z=point.z;point.x=x*this.matrix[0][0]+y*this.matrix[0][1]+z*this.matrix[0][2]+this.matrix[0][3];point.y=x*this.matrix[1][0]+y*this.matrix[1][1]+z*this.matrix[1][2]+this.matrix[1][3];point.z=x*this.matrix[2][0]+y*this.matrix[2][1]+z*this.matrix[2][2]+
this.matrix[2][3];return point},initialize:function(x0,y0,z0,x1,y1,z1,x2,y2,z2){this.identity();this.matrix[0][0]=x0;this.matrix[0][1]=y0;this.matrix[0][2]=z0;this.matrix[1][0]=x1;this.matrix[1][1]=y1;this.matrix[1][2]=z1;this.matrix[2][0]=x2;this.matrix[2][1]=y2;this.matrix[2][2]=z2;return this},initWithMatrix:function(matrixData){this.matrix=matrixData;return this},flatten:function(){var d=this.fmatrix;var s=this.matrix;d[0]=s[0][0];d[1]=s[1][0];d[2]=s[2][0];d[3]=s[3][0];d[4]=s[0][1];d[5]=s[1][1];
d[6]=s[2][1];d[7]=s[2][1];d[8]=s[0][2];d[9]=s[1][2];d[10]=s[2][2];d[11]=s[3][2];d[12]=s[0][3];d[13]=s[1][3];d[14]=s[2][3];d[15]=s[3][3];return this.fmatrix},identity:function(){for(var i=0;i<4;i++)for(var j=0;j<4;j++)this.matrix[i][j]=i===j?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(xy){return this.rotate(xy,0,0)},rotateXZ:function(xz){return this.rotate(0,xz,0)},rotateYZ:function(yz){return this.rotate(0,0,yz)},setRotate:function(xy,xz,yz){var m=this.rotate(xy,xz,
yz);this.copy(m);return this},rotate:function(xy,xz,yz){var res=new CAAT.Matrix3;var s,c,m;if(xy!==0){m=new CAAT.Matrix3;s=Math.sin(xy);c=Math.cos(xy);m.matrix[1][1]=c;m.matrix[1][2]=-s;m.matrix[2][1]=s;m.matrix[2][2]=c;res.multiply(m)}if(xz!==0){m=new CAAT.Matrix3;s=Math.sin(xz);c=Math.cos(xz);m.matrix[0][0]=c;m.matrix[0][2]=-s;m.matrix[2][0]=s;m.matrix[2][2]=c;res.multiply(m)}if(yz!==0){m=new CAAT.Matrix3;s=Math.sin(yz);c=Math.cos(yz);m.matrix[0][0]=c;m.matrix[0][1]=-s;m.matrix[1][0]=s;m.matrix[1][1]=
c;res.multiply(m)}return res},getClone:function(){var m=new CAAT.Matrix3;m.copy(this);return m},multiply:function(m){var n=this.getClone();var nm=n.matrix;var n00=nm[0][0];var n01=nm[0][1];var n02=nm[0][2];var n03=nm[0][3];var n10=nm[1][0];var n11=nm[1][1];var n12=nm[1][2];var n13=nm[1][3];var n20=nm[2][0];var n21=nm[2][1];var n22=nm[2][2];var n23=nm[2][3];var n30=nm[3][0];var n31=nm[3][1];var n32=nm[3][2];var n33=nm[3][3];var mm=m.matrix;var m00=mm[0][0];var m01=mm[0][1];var m02=mm[0][2];var m03=
mm[0][3];var m10=mm[1][0];var m11=mm[1][1];var m12=mm[1][2];var m13=mm[1][3];var m20=mm[2][0];var m21=mm[2][1];var m22=mm[2][2];var m23=mm[2][3];var m30=mm[3][0];var m31=mm[3][1];var m32=mm[3][2];var m33=mm[3][3];this.matrix[0][0]=n00*m00+n01*m10+n02*m20+n03*m30;this.matrix[0][1]=n00*m01+n01*m11+n02*m21+n03*m31;this.matrix[0][2]=n00*m02+n01*m12+n02*m22+n03*m32;this.matrix[0][3]=n00*m03+n01*m13+n02*m23+n03*m33;this.matrix[1][0]=n10*m00+n11*m10+n12*m20+n13*m30;this.matrix[1][1]=n10*m01+n11*m11+n12*
m21+n13*m31;this.matrix[1][2]=n10*m02+n11*m12+n12*m22+n13*m32;this.matrix[1][3]=n10*m03+n11*m13+n12*m23+n13*m33;this.matrix[2][0]=n20*m00+n21*m10+n22*m20+n23*m30;this.matrix[2][1]=n20*m01+n21*m11+n22*m21+n23*m31;this.matrix[2][2]=n20*m02+n21*m12+n22*m22+n23*m32;this.matrix[2][3]=n20*m03+n21*m13+n22*m23+n23*m33;return this},premultiply:function(m){var n=this.getClone();var nm=n.matrix;var n00=nm[0][0];var n01=nm[0][1];var n02=nm[0][2];var n03=nm[0][3];var n10=nm[1][0];var n11=nm[1][1];var n12=nm[1][2];
var n13=nm[1][3];var n20=nm[2][0];var n21=nm[2][1];var n22=nm[2][2];var n23=nm[2][3];var n30=nm[3][0];var n31=nm[3][1];var n32=nm[3][2];var n33=nm[3][3];var mm=m.matrix;var m00=mm[0][0];var m01=mm[0][1];var m02=mm[0][2];var m03=mm[0][3];var m10=mm[1][0];var m11=mm[1][1];var m12=mm[1][2];var m13=mm[1][3];var m20=mm[2][0];var m21=mm[2][1];var m22=mm[2][2];var m23=mm[2][3];var m30=mm[3][0];var m31=mm[3][1];var m32=mm[3][2];var m33=mm[3][3];this.matrix[0][0]=n00*m00+n01*m10+n02*m20;this.matrix[0][1]=
n00*m01+n01*m11+n02*m21;this.matrix[0][2]=n00*m02+n01*m12+n02*m22;this.matrix[0][3]=n00*m03+n01*m13+n02*m23+n03;this.matrix[1][0]=n10*m00+n11*m10+n12*m20;this.matrix[1][1]=n10*m01+n11*m11+n12*m21;this.matrix[1][2]=n10*m02+n11*m12+n12*m22;this.matrix[1][3]=n10*m03+n11*m13+n12*m23+n13;this.matrix[2][0]=n20*m00+n21*m10+n22*m20;this.matrix[2][1]=n20*m01+n21*m11+n22*m21;this.matrix[2][2]=n20*m02+n21*m12+n22*m22;this.matrix[2][3]=n20*m03+n21*m13+n22*m23+n23;return this},setTranslate:function(x,y,z){this.identity();
this.matrix[0][3]=x;this.matrix[1][3]=y;this.matrix[2][3]=z;return this},translate:function(x,y,z){var m=new CAAT.Matrix3;m.setTranslate(x,y,z);return m},setScale:function(sx,sy,sz){this.identity();this.matrix[0][0]=sx;this.matrix[1][1]=sy;this.matrix[2][2]=sz;return this},scale:function(sx,sy,sz){var m=new CAAT.Matrix3;m.setScale(sx,sy,sz);return m},rotateModelView:function(xy,xz,yz){var sxy=Math.sin(xy);var sxz=Math.sin(xz);var syz=Math.sin(yz);var cxy=Math.cos(xy);var cxz=Math.cos(xz);var cyz=
Math.cos(yz);this.matrix[0][0]=cxz*cxy;this.matrix[0][1]=-cxz*sxy;this.matrix[0][2]=sxz;this.matrix[0][3]=0;this.matrix[1][0]=syz*sxz*cxy+sxy*cyz;this.matrix[1][1]=cyz*cxy-syz*sxz*sxy;this.matrix[1][2]=-syz*cxz;this.matrix[1][3]=0;this.matrix[2][0]=syz*sxy-cyz*sxz*cxy;this.matrix[2][1]=cyz*sxz*sxy+syz*cxy;this.matrix[2][2]=cyz*cxz;this.matrix[2][3]=0;this.matrix[3][0]=0;this.matrix[3][1]=0;this.matrix[3][2]=0;this.matrix[3][3]=1;return this},copy:function(m){for(var i=0;i<4;i++)for(var j=0;j<4;j++)this.matrix[i][j]=
m.matrix[i][j];return this},calculateDeterminant:function(){var mm=this.matrix;var m11=mm[0][0],m12=mm[0][1],m13=mm[0][2],m14=mm[0][3],m21=mm[1][0],m22=mm[1][1],m23=mm[1][2],m24=mm[1][3],m31=mm[2][0],m32=mm[2][1],m33=mm[2][2],m34=mm[2][3],m41=mm[3][0],m42=mm[3][1],m43=mm[3][2],m44=mm[3][3];return m14*m22*m33*m41+m12*m24*m33*m41+m14*m23*m31*m42+m13*m24*m31*m42+m13*m21*m34*m42+m11*m23*m34*m42+m14*m21*m32*m43+m11*m24*m32*m43+m13*m22*m31*m44+m12*m23*m31*m44+m12*m21*m33*m44+m11*m22*m33*m44+m14*m23*m32*
m41-m13*m24*m32*m41-m13*m22*m34*m41-m12*m23*m34*m41-m14*m21*m33*m42-m11*m24*m33*m42-m14*m22*m31*m43-m12*m24*m31*m43-m12*m21*m34*m43-m11*m22*m34*m43-m13*m21*m32*m44-m11*m23*m32*m44},getInverse:function(){var mm=this.matrix;var m11=mm[0][0],m12=mm[0][1],m13=mm[0][2],m14=mm[0][3],m21=mm[1][0],m22=mm[1][1],m23=mm[1][2],m24=mm[1][3],m31=mm[2][0],m32=mm[2][1],m33=mm[2][2],m34=mm[2][3],m41=mm[3][0],m42=mm[3][1],m43=mm[3][2],m44=mm[3][3];var m2=new CAAT.Matrix3;m2.matrix[0][0]=m23*m34*m42+m24*m32*m43+m22*
m33*m44-m24*m33*m42-m22*m34*m43-m23*m32*m44;m2.matrix[0][1]=m14*m33*m42+m12*m34*m43+m13*m32*m44-m12*m33*m44-m13*m34*m42-m14*m32*m43;m2.matrix[0][2]=m13*m24*m42+m12*m23*m44+m14*m22*m43-m12*m24*m43-m13*m22*m44-m14*m23*m42;m2.matrix[0][3]=m14*m23*m32+m12*m24*m33+m13*m22*m34-m13*m24*m32-m14*m22*m33-m12*m23*m34;m2.matrix[1][0]=m24*m33*m41+m21*m34*m43+m23*m31*m44-m23*m34*m41-m24*m31*m43-m21*m33*m44;m2.matrix[1][1]=m13*m34*m41+m14*m31*m43+m11*m33*m44-m14*m33*m41-m11*m34*m43-m13*m31*m44;m2.matrix[1][2]=m14*
m23*m41+m11*m24*m43+m13*m21*m44-m13*m24*m41-m14*m21*m43-m11*m23*m44;m2.matrix[1][3]=m13*m24*m31+m14*m21*m33+m11*m23*m34-m14*m23*m31-m11*m24*m33-m13*m21*m34;m2.matrix[2][0]=m22*m34*m41+m24*m31*m42+m21*m32*m44-m24*m32*m41-m21*m34*m42-m22*m31*m44;m2.matrix[2][1]=m14*m32*m41+m11*m34*m42+m12*m31*m44-m11*m32*m44-m12*m34*m41-m14*m31*m42;m2.matrix[2][2]=m13*m24*m41+m14*m21*m42+m11*m22*m44-m14*m22*m41-m11*m24*m42-m12*m21*m44;m2.matrix[2][3]=m14*m22*m31+m11*m24*m32+m12*m21*m34-m11*m22*m34-m12*m24*m31-m14*m21*
m32;m2.matrix[3][0]=m23*m32*m41+m21*m33*m42+m22*m31*m43-m22*m33*m41-m23*m31*m42-m21*m32*m43;m2.matrix[3][1]=m12*m33*m41+m13*m31*m42+m11*m32*m43-m13*m32*m41-m11*m33*m42-m12*m31*m43;m2.matrix[3][2]=m13*m22*m41+m11*m23*m42+m12*m21*m43-m11*m22*m43-m12*m23*m41-m13*m21*m42;m2.matrix[3][3]=m12*m23*m31+m13*m21*m32+m11*m22*m33-m13*m22*m31-m11*m23*m32-m12*m21*m33;return m2.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(scalar){var i,j;for(i=0;i<4;i++)for(j=0;j<4;j++)this.matrix[i][j]*=
scalar;return this}}})();
(function(){CAAT.Matrix=function(){this.matrix=[1,0,0,0,1,0,0,0,1];return this};CAAT.Matrix.prototype={matrix:null,transformCoord:function(point){var x=point.x;var y=point.y;var tm=this.matrix;point.x=x*tm[0]+y*tm[1]+tm[2];point.y=x*tm[3]+y*tm[4]+tm[5];return point},rotate:function(angle){var m=new CAAT.Matrix;m.setRotation(angle);return m},setRotation:function(angle){this.identity();var tm=this.matrix;var c=Math.cos(angle);var s=Math.sin(angle);tm[0]=c;tm[1]=-s;tm[3]=s;tm[4]=c;return this},scale:function(scalex,
scaley){var m=new CAAT.Matrix;m.matrix[0]=scalex;m.matrix[4]=scaley;return m},setScale:function(scalex,scaley){this.identity();this.matrix[0]=scalex;this.matrix[4]=scaley;return this},translate:function(x,y){var m=new CAAT.Matrix;m.matrix[2]=x;m.matrix[5]=y;return m},setTranslate:function(x,y){this.identity();this.matrix[2]=x;this.matrix[5]=y;return this},copy:function(matrix){matrix=matrix.matrix;var tmatrix=this.matrix;tmatrix[0]=matrix[0];tmatrix[1]=matrix[1];tmatrix[2]=matrix[2];tmatrix[3]=matrix[3];
tmatrix[4]=matrix[4];tmatrix[5]=matrix[5];tmatrix[6]=matrix[6];tmatrix[7]=matrix[7];tmatrix[8]=matrix[8];return this},identity:function(){var m=this.matrix;m[0]=1;m[1]=0;m[2]=0;m[3]=0;m[4]=1;m[5]=0;m[6]=0;m[7]=0;m[8]=1;return this},multiply:function(m){var tm=this.matrix;var mm=m.matrix;var tm0=tm[0];var tm1=tm[1];var tm2=tm[2];var tm3=tm[3];var tm4=tm[4];var tm5=tm[5];var tm6=tm[6];var tm7=tm[7];var tm8=tm[8];var mm0=mm[0];var mm1=mm[1];var mm2=mm[2];var mm3=mm[3];var mm4=mm[4];var mm5=mm[5];var mm6=
mm[6];var mm7=mm[7];var mm8=mm[8];tm[0]=tm0*mm0+tm1*mm3+tm2*mm6;tm[1]=tm0*mm1+tm1*mm4+tm2*mm7;tm[2]=tm0*mm2+tm1*mm5+tm2*mm8;tm[3]=tm3*mm0+tm4*mm3+tm5*mm6;tm[4]=tm3*mm1+tm4*mm4+tm5*mm7;tm[5]=tm3*mm2+tm4*mm5+tm5*mm8;tm[6]=tm6*mm0+tm7*mm3+tm8*mm6;tm[7]=tm6*mm1+tm7*mm4+tm8*mm7;tm[8]=tm6*mm2+tm7*mm5+tm8*mm8;return this},premultiply:function(m){var m00=m.matrix[0]*this.matrix[0]+m.matrix[1]*this.matrix[3]+m.matrix[2]*this.matrix[6];var m01=m.matrix[0]*this.matrix[1]+m.matrix[1]*this.matrix[4]+m.matrix[2]*
this.matrix[7];var m02=m.matrix[0]*this.matrix[2]+m.matrix[1]*this.matrix[5]+m.matrix[2]*this.matrix[8];var m10=m.matrix[3]*this.matrix[0]+m.matrix[4]*this.matrix[3]+m.matrix[5]*this.matrix[6];var m11=m.matrix[3]*this.matrix[1]+m.matrix[4]*this.matrix[4]+m.matrix[5]*this.matrix[7];var m12=m.matrix[3]*this.matrix[2]+m.matrix[4]*this.matrix[5]+m.matrix[5]*this.matrix[8];var m20=m.matrix[6]*this.matrix[0]+m.matrix[7]*this.matrix[3]+m.matrix[8]*this.matrix[6];var m21=m.matrix[6]*this.matrix[1]+m.matrix[7]*
this.matrix[4]+m.matrix[8]*this.matrix[7];var m22=m.matrix[6]*this.matrix[2]+m.matrix[7]*this.matrix[5]+m.matrix[8]*this.matrix[8];this.matrix[0]=m00;this.matrix[1]=m01;this.matrix[2]=m02;this.matrix[3]=m10;this.matrix[4]=m11;this.matrix[5]=m12;this.matrix[6]=m20;this.matrix[7]=m21;this.matrix[8]=m22;return this},getInverse:function(){var tm=this.matrix;var m00=tm[0];var m01=tm[1];var m02=tm[2];var m10=tm[3];var m11=tm[4];var m12=tm[5];var m20=tm[6];var m21=tm[7];var m22=tm[8];var newMatrix=new CAAT.Matrix;
var determinant=m00*(m11*m22-m21*m12)-m10*(m01*m22-m21*m02)+m20*(m01*m12-m11*m02);if(determinant===0)return null;var m=newMatrix.matrix;m[0]=m11*m22-m12*m21;m[1]=m02*m21-m01*m22;m[2]=m01*m12-m02*m11;m[3]=m12*m20-m10*m22;m[4]=m00*m22-m02*m20;m[5]=m02*m10-m00*m12;m[6]=m10*m21-m11*m20;m[7]=m01*m20-m00*m21;m[8]=m00*m11-m01*m10;newMatrix.multiplyScalar(1/determinant);return newMatrix},multiplyScalar:function(scalar){var i;for(i=0;i<9;i++)this.matrix[i]*=scalar;return this},transformRenderingContextSet:null,
transformRenderingContext:null,transformRenderingContextSet_NoClamp:function(ctx){var m=this.matrix;ctx.setTransform(m[0],m[3],m[1],m[4],m[2],m[5]);return this},transformRenderingContext_NoClamp:function(ctx){var m=this.matrix;ctx.transform(m[0],m[3],m[1],m[4],m[2],m[5]);return this},transformRenderingContextSet_Clamp:function(ctx){var m=this.matrix;ctx.setTransform(m[0],m[3],m[1],m[4],m[2]>>0,m[5]>>0);return this},transformRenderingContext_Clamp:function(ctx){var m=this.matrix;ctx.transform(m[0],
m[3],m[1],m[4],m[2]>>0,m[5]>>0);return this}};CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp;CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp})();
(function(){CAAT.MatrixStack=function(){this.stack=[];this.saved=[];return this};CAAT.MatrixStack.prototype={stack:null,saved:null,pushMatrix:function(matrix){this.stack.push(matrix);return this},popMatrix:function(){return this.stack.pop()},save:function(){this.saved.push(this.stack.length);return this},restore:function(){var pos=this.saved.pop();while(this.stack.length!==pos)this.popMatrix();return this},getMatrix:function(){var matrix=new CAAT.Matrix;for(var i=0;i<this.stack.length;i++){var matrixStack=
this.stack[i];matrix.multiply(matrixStack)}return matrix}}})();
(function(){CAAT.Color=function(){return this};CAAT.Color.prototype={hsvToRgb:function(h,s,v){var r,g,b;var i;var f,p,q,t;h=Math.max(0,Math.min(360,h));s=Math.max(0,Math.min(100,s));v=Math.max(0,Math.min(100,v));s/=100;v/=100;if(s===0){r=g=b=v;return[Math.round(r*255),Math.round(g*255),Math.round(b*255)]}h/=60;i=Math.floor(h);f=h-i;p=v*(1-s);q=v*(1-s*f);t=v*(1-s*(1-f));switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;
break;default:r=v;g=p;b=q}return new CAAT.Color.RGB(Math.round(r*255),Math.round(g*255),Math.round(b*255))},RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},interpolate:function(r0,g0,b0,r1,g1,b1,nsteps,step){if(step<=0)return{r:r0,g:g0,b:b0};else if(step>=nsteps)return{r:r1,g:g1,b:b1};var r=r0+(r1-r0)/nsteps*step>>0;var g=g0+(g1-g0)/nsteps*step>>0;var b=b0+(b1-b0)/nsteps*step>>0;if(r>255)r=255;else if(r<0)r=0;if(g>
255)g=255;else if(g<0)g=0;if(b>255)b=255;else if(b<0)b=0;return{r:r,g:g,b:b}},makeRGBColorRamp:function(fromColorsArray,rampSize,returnType){var ramp=[];var nc=fromColorsArray.length-1;var chunk=rampSize/nc;for(var i=0;i<nc;i++){var c=fromColorsArray[i];var a0=c>>24&255;var r0=(c&16711680)>>16;var g0=(c&65280)>>8;var b0=c&255;var c1=fromColorsArray[i+1];var a1=c1>>24&255;var r1=(c1&16711680)>>16;var g1=(c1&65280)>>8;var b1=c1&255;var da=(a1-a0)/chunk;var dr=(r1-r0)/chunk;var dg=(g1-g0)/chunk;var db=
(b1-b0)/chunk;for(var j=0;j<chunk;j++){var na=a0+da*j>>0;var nr=r0+dr*j>>0;var ng=g0+dg*j>>0;var nb=b0+db*j>>0;switch(returnType){case this.RampEnumeration.RAMP_RGBA:ramp.push("argb("+na+","+nr+","+ng+","+nb+")");break;case this.RampEnumeration.RAMP_RGB:ramp.push("rgb("+nr+","+ng+","+nb+")");break;case this.RampEnumeration.RAMP_CHANNEL_RGB:ramp.push(4278190080|nr<<16|ng<<8|nb);break;case this.RampEnumeration.RAMP_CHANNEL_RGBA:ramp.push(na<<24|nr<<16|ng<<8|nb);break;case this.RampEnumeration.RAMP_CHANNEL_RGBA_ARRAY:ramp.push([nr,
ng,nb,na]);break;case this.RampEnumeration.RAMP_CHANNEL_RGB_ARRAY:ramp.push([nr,ng,nb]);break}}}return ramp}}})();(function(){CAAT.Color.RGB=function(r,g,b){this.r=r||255;this.g=g||255;this.b=b||255;return this};CAAT.Color.RGB.prototype={r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}})();
(function(){CAAT.Rectangle=function(){return this};CAAT.Rectangle.prototype={x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){this.width=-1;this.height=-1;this.x=0;this.y=0;this.x1=0;this.y1=0;return this},setLocation:function(x,y){this.x=x;this.y=y;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setDimension:function(w,h){this.width=w;this.height=h;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setBounds:function(x,y,w,h){this.setLocation(x,y);this.setDimension(w,
h);return this},contains:function(px,py){return px>=0&&px<this.width&&py>=0&&py<this.height},isEmpty:function(){return this.width===-1&&this.height===-1},union:function(px,py){if(this.isEmpty()){this.x=px;this.x1=px;this.y=py;this.y1=py;this.width=0;this.height=0;return}this.x1=this.x+this.width;this.y1=this.y+this.height;if(py<this.y)this.y=py;if(px<this.x)this.x=px;if(py>this.y1)this.y1=py;if(px>this.x1)this.x1=px;this.width=this.x1-this.x;this.height=this.y1-this.y},unionRectangle:function(rectangle){this.union(rectangle.x,
rectangle.y);this.union(rectangle.x1,rectangle.y);this.union(rectangle.x,rectangle.y1);this.union(rectangle.x1,rectangle.y1);return this},intersects:function(r){if(r.isEmpty()||this.isEmpty())return false;if(r.x1<this.x)return false;if(r.x>this.x1)return false;if(r.y1<this.y)return false;if(r.y>this.y1)return false;return true},intersectsRect:function(x,y,w,h){if(-1===w||-1===h)return false;var x1=x+w-1;var y1=y+h-1;if(x1<this.x)return false;if(x>this.x1)return false;if(y1<this.y)return false;if(y>
this.y1)return false;return true},intersect:function(i,r){if(typeof r==="undefined")r=new CAAT.Rectangle;r.x=Math.max(this.x,i.x);r.y=Math.max(this.y,i.y);r.x1=Math.min(this.x1,i.x1);r.y1=Math.min(this.y1,i.y1);r.width=r.x1-r.x;r.height=r.y1-r.y;return r}}})();
(function(){CAAT.Curve=function(){return this};CAAT.Curve.prototype={coordlist:null,k:0.05,length:-1,interpolator:false,HANDLE_SIZE:20,drawHandles:true,paint:function(director){if(false===this.drawHandles)return;var cl=this.coordlist;var ctx=director.ctx;ctx.save();ctx.beginPath();ctx.strokeStyle="#a0a0a0";ctx.moveTo(cl[0].x,cl[0].y);ctx.lineTo(cl[1].x,cl[1].y);ctx.stroke();if(this.cubic){ctx.moveTo(cl[2].x,cl[2].y);ctx.lineTo(cl[3].x,cl[3].y);ctx.stroke()}ctx.globalAlpha=0.5;for(var i=0;i<this.coordlist.length;i++){ctx.fillStyle=
"#7f7f00";var w=CAAT.Curve.prototype.HANDLE_SIZE/2;ctx.fillRect(cl[i].x-w,cl[i].y-w,w*2,w*2)}ctx.restore()},update:function(){this.calcLength()},solve:function(point,t){},getContour:function(numSamples){var contour=[],i;for(i=0;i<=numSamples;i++){var point=new CAAT.Point;this.solve(point,i/numSamples);contour.push(point)}return contour},getBoundingBox:function(rectangle){if(!rectangle)rectangle=new CAAT.Rectangle;rectangle.setEmpty();rectangle.union(this.coordlist[0].x,this.coordlist[0].y);var pt=
new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(pt,t);rectangle.union(pt.x,pt.y)}return rectangle},calcLength:function(){var x1,y1;x1=this.coordlist[0].x;y1=this.coordlist[0].y;var llength=0;var pt=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(pt,t);llength+=Math.sqrt((pt.x-x1)*(pt.x-x1)+(pt.y-y1)*(pt.y-y1));x1=pt.x;y1=pt.y}this.length=llength;return llength},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-
1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(points){},setPoint:function(point,index){if(index>=0&&index<this.coordlist.length)this.coordlist[index]=point},applyAsPath:function(director){}}})();
(function(){CAAT.Bezier=function(){CAAT.Bezier.superclass.constructor.call(this);return this};CAAT.Bezier.prototype={cubic:false,applyAsPath:function(director){var cc=this.coordlist;if(this.cubic)director.ctx.bezierCurveTo(cc[1].x,cc[1].y,cc[2].x,cc[2].y,cc[3].x,cc[3].y);else director.ctx.quadraticCurveTo(cc[1].x,cc[1].y,cc[2].x,cc[2].y);return this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(cp0x,cp0y,cp1x,cp1y,cp2x,cp2y,cp3x,cp3y){this.coordlist=
[];this.coordlist.push((new CAAT.Point).set(cp0x,cp0y));this.coordlist.push((new CAAT.Point).set(cp1x,cp1y));this.coordlist.push((new CAAT.Point).set(cp2x,cp2y));this.coordlist.push((new CAAT.Point).set(cp3x,cp3y));this.cubic=true;this.update();return this},setQuadric:function(cp0x,cp0y,cp1x,cp1y,cp2x,cp2y){this.coordlist=[];this.coordlist.push((new CAAT.Point).set(cp0x,cp0y));this.coordlist.push((new CAAT.Point).set(cp1x,cp1y));this.coordlist.push((new CAAT.Point).set(cp2x,cp2y));this.cubic=false;
this.update();return this},setPoints:function(points){if(points.length===3){this.coordlist=points;this.cubic=false;this.update()}else if(points.length===4){this.coordlist=points;this.cubic=true;this.update()}else throw"points must be an array of 3 or 4 CAAT.Point instances.";return this},paint:function(director){if(this.cubic)this.paintCubic(director);else this.paintCuadric(director);CAAT.Bezier.superclass.paint.call(this,director)},paintCuadric:function(director){var x1,y1;x1=this.coordlist[0].x;
y1=this.coordlist[0].y;var ctx=director.ctx;ctx.save();ctx.beginPath();ctx.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(point,t);ctx.lineTo(point.x,point.y)}ctx.stroke();ctx.restore()},paintCubic:function(director){var x1,y1;x1=this.coordlist[0].x;y1=this.coordlist[0].y;var ctx=director.ctx;ctx.save();ctx.beginPath();ctx.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=this.k){this.solve(point,t);ctx.lineTo(point.x,point.y)}ctx.stroke();
ctx.restore()},solve:function(point,t){if(this.cubic)return this.solveCubic(point,t);else return this.solveQuadric(point,t)},solveCubic:function(point,t){var t2=t*t;var t3=t*t2;var cl=this.coordlist;var cl0=cl[0];var cl1=cl[1];var cl2=cl[2];var cl3=cl[3];point.x=cl0.x+t*(-cl0.x*3+t*(3*cl0.x-cl0.x*t))+t*(3*cl1.x+t*(-6*cl1.x+cl1.x*3*t))+t2*(cl2.x*3-cl2.x*3*t)+cl3.x*t3;point.y=cl0.y+t*(-cl0.y*3+t*(3*cl0.y-cl0.y*t))+t*(3*cl1.y+t*(-6*cl1.y+cl1.y*3*t))+t2*(cl2.y*3-cl2.y*3*t)+cl3.y*t3;return point},solveQuadric:function(point,
t){var cl=this.coordlist;var cl0=cl[0];var cl1=cl[1];var cl2=cl[2];var t1=1-t;point.x=t1*t1*cl0.x+2*t1*t*cl1.x+t*t*cl2.x;point.y=t1*t1*cl0.y+2*t1*t*cl1.y+t*t*cl2.y;return point}};extend(CAAT.Bezier,CAAT.Curve,null)})();
(function(){CAAT.CatmullRom=function(){CAAT.CatmullRom.superclass.constructor.call(this);return this};CAAT.CatmullRom.prototype={setCurve:function(p0,p1,p2,p3){this.coordlist=[];this.coordlist.push(p0);this.coordlist.push(p1);this.coordlist.push(p2);this.coordlist.push(p3);this.update();return this},paint:function(director){var x1,y1;x1=this.coordlist[1].x;y1=this.coordlist[1].y;var ctx=director.ctx;ctx.save();ctx.beginPath();ctx.moveTo(x1,y1);var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=
this.k){this.solve(point,t);ctx.lineTo(point.x,point.y)}ctx.stroke();ctx.restore();CAAT.CatmullRom.superclass.paint.call(this,director)},solve:function(point,t){var c=this.coordlist;var af=((-t+2)*t-1)*t*0.5;var bf=((3*t-5)*t*t+2)*0.5;var cf=((-3*t+4)*t+1)*t*0.5;var df=(t-1)*t*t*0.5;point.x=c[0].x*af+c[1].x*bf+c[2].x*cf+c[3].x*df;point.y=c[0].y*af+c[1].y*bf+c[2].y*cf+c[3].y*df;return point},applyAsPath:function(director){var ctx=director.ctx;var point=new CAAT.Point;for(var t=this.k;t<=1+this.k;t+=
this.k){this.solve(point,t);ctx.lineTo(point.x,point.y)}return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}};extend(CAAT.CatmullRom,CAAT.Curve,null)})();
(function(){CAAT.Point=function(xpos,ypos,zpos){this.x=xpos;this.y=ypos;this.z=zpos||0;return this};CAAT.Point.prototype={x:0,y:0,z:0,set:function(x,y,z){this.x=x;this.y=y;this.z=z||0;return this},clone:function(){var p=new CAAT.Point(this.x,this.y,this.z);return p},translate:function(x,y,z){this.x+=x;this.y+=y;this.z+=z;return this},translatePoint:function(aPoint){this.x+=aPoint.x;this.y+=aPoint.y;this.z+=aPoint.z;return this},subtract:function(aPoint){this.x-=aPoint.x;this.y-=aPoint.y;this.z-=aPoint.z;
return this},multiply:function(factor){this.x*=factor;this.y*=factor;this.z*=factor;return this},rotate:function(angle){var x=this.x,y=this.y;this.x=x*Math.cos(angle)-Math.sin(angle)*y;this.y=x*Math.sin(angle)+Math.cos(angle)*y;this.z=0;return this},setAngle:function(angle){var len=this.getLength();this.x=Math.cos(angle)*len;this.y=Math.sin(angle)*len;this.z=0;return this},setLength:function(length){var len=this.getLength();if(len)this.multiply(length/len);else this.x=this.y=this.z=length;return this},
normalize:function(){var len=this.getLength();this.x/=len;this.y/=len;this.z/=len;return this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(max){var aLenthSquared=this.getLengthSquared();if(aLenthSquared+0.01>max*max){var aLength=Math.sqrt(aLenthSquared);this.x=this.x/aLength*max;this.y=this.y/aLength*max;this.z=this.z/aLength*max}return this},getLength:function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(length<0.0050&&length>-0.0050)return 1.0E-6;
return length},getLengthSquared:function(){var lengthSquared=this.x*this.x+this.y*this.y+this.z*this.z;if(lengthSquared<0.0050&&lengthSquared>-0.0050)return 0;return lengthSquared},getDistance:function(point){var deltaX=this.x-point.x;var deltaY=this.y-point.y;var deltaZ=this.z-point.z;return Math.sqrt(deltaX*deltaX+deltaY*deltaY+deltaZ*deltaZ)},getDistanceSquared:function(point){var deltaX=this.x-point.x;var deltaY=this.y-point.y;var deltaZ=this.z-point.z;return deltaX*deltaX+deltaY*deltaY+deltaZ*
deltaZ},toString:function(){return"(CAAT.Point)"+" x:"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)+" z:"+String(Math.round(Math.floor(this.z*10))/10)}}})();
(function(){CAAT.QuadTree=function(){return this};var QT_MAX_ELEMENTS=1;var QT_MIN_WIDTH=32;CAAT.QuadTree.prototype={bgActors:null,quadData:null,create:function(l,t,r,b,backgroundElements,minWidth,maxElements){if(typeof minWidth==="undefined")minWidth=QT_MIN_WIDTH;if(typeof maxElements==="undefined")maxElements=QT_MAX_ELEMENTS;var cx=(l+r)/2;var cy=(t+b)/2;this.x=l;this.y=t;this.x1=r;this.y1=b;this.width=r-l;this.height=b-t;this.bgActors=this.__getOverlappingActorList(backgroundElements);if(this.bgActors.length<=
maxElements||this.width<=minWidth)return this;this.quadData=new Array(4);this.quadData[0]=(new CAAT.QuadTree).create(l,t,cx,cy,this.bgActors);this.quadData[1]=(new CAAT.QuadTree).create(cx,t,r,cy,this.bgActors);this.quadData[2]=(new CAAT.QuadTree).create(l,cy,cx,b,this.bgActors);this.quadData[3]=(new CAAT.QuadTree).create(cx,cy,r,b,this.bgActors);return this},__getOverlappingActorList:function(actorList){var tmpList=[];for(var i=0,l=actorList.length;i<l;i++){var actor=actorList[i];if(this.intersects(actor.AABB))tmpList.push(actor)}return tmpList},
getOverlappingActors:function(rectangle){var i,j,l;var overlappingActors=[];var qoverlappingActors;var actors=this.bgActors;var actor;if(this.quadData)for(i=0;i<4;i++){if(this.quadData[i].intersects(rectangle)){qoverlappingActors=this.quadData[i].getOverlappingActors(rectangle);for(j=0,l=qoverlappingActors.length;j<l;j++)overlappingActors.push(qoverlappingActors[j])}}else for(i=0,l=actors.length;i<l;i++){actor=actors[i];if(rectangle.intersects(actor.AABB))overlappingActors.push(actor)}return overlappingActors}};
extend(CAAT.QuadTree,CAAT.Rectangle)})();
(function(){CAAT.SpatialHash=function(){return this};CAAT.SpatialHash.prototype={elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(w,h,rows,columns){var i,j;this.elements=[];for(i=0;i<rows*columns;i++)this.elements.push([]);this.width=w;this.height=h;this.rows=rows;this.columns=columns;this.xcache=[];for(i=0;i<w;i++)this.xcache.push(i/(w/columns)>>0);this.ycache=[];for(i=0;i<h;i++)this.ycache.push(i/
(h/rows)>>0);this.xycache=[];for(i=0;i<this.rows;i++){this.xycache.push([]);for(j=0;j<this.columns;j++)this.xycache[i].push(j+i*columns)}this.rectangle=(new CAAT.Rectangle).setBounds(0,0,w,h);this.r0=new CAAT.Rectangle;this.r1=new CAAT.Rectangle;return this},clearObject:function(){var i;for(i=0;i<this.rows*this.columns;i++)this.elements[i]=[];return this},addObject:function(obj){var x=obj.x|0;var y=obj.y|0;var width=obj.width|0;var height=obj.height|0;var cells=this.__getCells(x,y,width,height);for(var i=
0;i<cells.length;i++)this.elements[cells[i]].push(obj)},__getCells:function(x,y,width,height){var cells=[];var i;if(this.rectangle.contains(x,y))cells.push(this.xycache[this.ycache[y]][this.xcache[x]]);if(this.rectangle.contains(x+width-1,y+height-1)){var c=this.xycache[this.ycache[y+height-1]][this.xcache[x+width-1]];if(c===cells[0])return cells;cells.push(c)}if(this.rectangle.contains(x+width-1,y)){var c=this.xycache[this.ycache[y]][this.xcache[x+width-1]];if(c===cells[0]||c===cells[1])return cells;
cells.push(c)}if(this.rectangle.contains(x+width-1,y+height-1)){var c=this.xycache[this.ycache[y+height-1]][this.xcache[x]];cells.push(c)}return cells},collide:function(x,y,w,h,oncollide){x|=0;y|=0;w|=0;h|=0;var cells=this.__getCells(x,y,w,h);var i,j,l;var el=this.elements;this.r0.setBounds(x,y,w,h);for(i=0;i<cells.length;i++){var cell=cells[i];var elcell=el[cell];for(j=0,l=elcell.length;j<l;j++){var obj=elcell[j];this.r1.setBounds(obj.x,obj.y,obj.width,obj.height);if(this.r0.intersects(this.r1))if(oncollide(obj))return}}}}})();
(function(){CAAT.Interpolator=function(){this.interpolated=new CAAT.Point(0,0,0);return this};CAAT.Interpolator.prototype={interpolated:null,paintScale:90,createLinearInterpolator:function(bPingPong,bInverse){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(bInverse!==null&&bInverse)time=1-time;return this.interpolated.set(orgTime,time)};return this},createBackOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){var orgTime=
time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;time=time-1;var overshoot=1.70158;return this.interpolated.set(orgTime,time*time*((overshoot+1)*time+overshoot)+1)};return this},createExponentialInInterpolator:function(exponent,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.interpolated.set(orgTime,Math.pow(time,exponent))};return this},createExponentialOutInterpolator:function(exponent,bPingPong){this.getPosition=
function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.interpolated.set(orgTime,1-Math.pow(1-time,exponent))};return this},createExponentialInOutInterpolator:function(exponent,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time*2<1)return this.interpolated.set(orgTime,Math.pow(time*2,exponent)/2);return this.interpolated.set(orgTime,1-Math.abs(Math.pow(time*
2-2,exponent))/2)};return this},createQuadricBezierInterpolator:function(p0,p1,p2,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;time=(1-time)*(1-time)*p0.y+2*(1-time)*time*p1.y+time*time*p2.y;return this.interpolated.set(orgTime,time)};return this},createCubicBezierInterpolator:function(p0,p1,p2,p3,bPingPong){this.getPosition=function getPosition(time){var orgTime=time;if(bPingPong)if(time<0.5)time*=2;else time=1-
(time-0.5)*2;var t2=time*time;var t3=time*t2;time=p0.y+time*(-p0.y*3+time*(3*p0.y-p0.y*time))+time*(3*p1.y+time*(-6*p1.y+p1.y*3*time))+t2*(p2.y*3-p2.y*3*time)+p3.y*t3;return this.interpolated.set(orgTime,time)};return this},createElasticOutInterpolator:function(amplitude,p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time===0)return{x:0,y:0};if(time===1)return{x:1,y:1};var s=p/(2*Math.PI)*Math.asin(1/amplitude);return this.interpolated.set(time,
amplitude*Math.pow(2,-10*time)*Math.sin((time-s)*2*Math.PI/p)+1)};return this},createElasticInInterpolator:function(amplitude,p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;if(time===0)return{x:0,y:0};if(time===1)return{x:1,y:1};var s=p/(2*Math.PI)*Math.asin(1/amplitude);return this.interpolated.set(time,-(amplitude*Math.pow(2,10*(time-=1))*Math.sin((time-s)*2*Math.PI/p)))};return this},createElasticInOutInterpolator:function(amplitude,
p,bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;var s=p/(2*Math.PI)*Math.asin(1/amplitude);time*=2;if(time<=1)return this.interpolated.set(time,-0.5*amplitude*Math.pow(2,10*(time-=1))*Math.sin((time-s)*2*Math.PI/p));return this.interpolated.set(time,1+0.5*amplitude*Math.pow(2,-10*(time-=1))*Math.sin((time-s)*2*Math.PI/p))};return this},bounce:function(time){if((time/=1)<1/2.75)return{x:time,y:7.5625*time*time};else if(time<2/2.75)return{x:time,
y:7.5625*(time-=1.5/2.75)*time+0.75};else if(time<2.5/2.75)return{x:time,y:7.5625*(time-=2.25/2.75)*time+0.9375};else return{x:time,y:7.5625*(time-=2.625/2.75)*time+0.984375}},createBounceOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;return this.bounce(time)};return this},createBounceInInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-
(time-0.5)*2;var r=this.bounce(1-time);r.y=1-r.y;return r};return this},createBounceInOutInterpolator:function(bPingPong){this.getPosition=function getPosition(time){if(bPingPong)if(time<0.5)time*=2;else time=1-(time-0.5)*2;var r;if(time<0.5){r=this.bounce(1-time*2);r.y=(1-r.y)*0.5;return r}r=this.bounce(time*2-1,bPingPong);r.y=r.y*0.5+0.5;return r};return this},paint:function(director,time){var canvas=director.crc;canvas.save();canvas.beginPath();canvas.moveTo(0,this.getPosition(0).y*this.paintScale);
for(var i=0;i<=this.paintScale;i++)canvas.lineTo(i,this.getPosition(i/this.paintScale).y*this.paintScale);canvas.strokeStyle="black";canvas.stroke();canvas.restore()},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push({x:i/iSize,y:this.getPosition(i/iSize).y});return contour},enumerateInterpolators:function(){return[(new CAAT.Interpolator).createLinearInterpolator(false,false),"Linear pingpong=false, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(true,
false),"Linear pingpong=true, inverse=false",(new CAAT.Interpolator).createLinearInterpolator(false,true),"Linear pingpong=false, inverse=true",(new CAAT.Interpolator).createLinearInterpolator(true,true),"Linear pingpong=true, inverse=true",(new CAAT.Interpolator).createExponentialInInterpolator(2,false),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,false),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialInOutInterpolator(2,
false),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(2,true),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialOutInterpolator(2,true),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInOutInterpolator(2,true),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Interpolator).createExponentialInInterpolator(4,false),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialOutInterpolator(4,
false),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,false),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Interpolator).createExponentialInInterpolator(4,true),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialOutInterpolator(4,true),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialInOutInterpolator(4,true),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Interpolator).createExponentialInInterpolator(6,
false),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,false),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInOutInterpolator(6,false),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Interpolator).createExponentialInInterpolator(6,true),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Interpolator).createExponentialOutInterpolator(6,true),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Interpolator).createExponentialInOutInterpolator(6,
true),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Interpolator).createBounceInInterpolator(false),"BounceIn pingpong=false",(new CAAT.Interpolator).createBounceOutInterpolator(false),"BounceOut pingpong=false",(new CAAT.Interpolator).createBounceInOutInterpolator(false),"BounceInOut pingpong=false",(new CAAT.Interpolator).createBounceInInterpolator(true),"BounceIn pingpong=true",(new CAAT.Interpolator).createBounceOutInterpolator(true),"BounceOut pingpong=true",(new CAAT.Interpolator).createBounceInOutInterpolator(true),
"BounceInOut pingpong=true",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,false),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4,false),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,false),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1.1,0.4,true),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticOutInterpolator(1.1,
0.4,true),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInOutInterpolator(1.1,0.4,true),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Interpolator).createElasticInInterpolator(1,0.2,false),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,false),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,false),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInInterpolator(1,
0.2,true),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticOutInterpolator(1,0.2,true),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Interpolator).createElasticInOutInterpolator(1,0.2,true),"ElasticInOut pingpong=true, amp=1.0, d=.2"]}}})();
(function(){CAAT.Behavior=function(){this.lifecycleListenerList=[];this.setDefaultInterpolator();return this};CAAT.Behavior.Status={NOT_STARTED:0,STARTED:1,EXPIRED:2};var DefaultInterpolator=(new CAAT.Interpolator).createLinearInterpolator(false);var DefaultPPInterpolator=(new CAAT.Interpolator).createLinearInterpolator(true);CAAT.Behavior.prototype={lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:false,status:CAAT.Behavior.NOT_STARTED,interpolator:null,actor:null,
id:0,timeOffset:0,doValueApplication:true,solved:true,setValueApplication:function(apply){this.doValueApplication=apply;return this},setTimeOffset:function(offset){this.timeOffset=offset;return this},setId:function(id){this.id=id;return this},setDefaultInterpolator:function(){this.interpolator=DefaultInterpolator;return this},setPingPong:function(){this.interpolator=DefaultPPInterpolator;return this},setStatus:function(status){this.status=status},setFrameTime:function(startTime,duration){this.behaviorStartTime=
startTime;this.behaviorDuration=duration;this.setStatus(CAAT.Behavior.Status.NOT_STARTED);return this},setDelayTime:function(delay,duration){this.behaviorStartTime=delay;this.behaviorDuration=duration;this.setStatus(CAAT.Behavior.Status.NOT_STARTED);this.solved=false;return this},setOutOfFrameTime:function(){this.setStatus(CAAT.Behavior.Status.EXPIRED);this.behaviorStartTime=Number.MAX_VALUE;this.behaviorDuration=0;return this},setInterpolator:function(interpolator){this.interpolator=interpolator;
return this},apply:function(time,actor){if(!this.solved){this.behaviorStartTime+=time;this.solved=true}time+=this.timeOffset*this.behaviorDuration;var orgTime=time;if(this.isBehaviorInTime(time,actor)){time=this.normalizeTime(time);this.fireBehaviorAppliedEvent(actor,orgTime,time,this.setForTime(time,actor))}},setCycle:function(bool){this.cycleBehavior=bool;return this},addListener:function(behaviorListener){this.lifecycleListenerList.push(behaviorListener);return this},emptyListenerList:function(){this.lifecycleListenerList=
[];return this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(time,actor){var S=CAAT.Behavior.Status;if(this.status===S.EXPIRED||this.behaviorStartTime<0)return false;if(this.cycleBehavior)if(time>=this.behaviorStartTime)time=(time-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime;if(time>this.behaviorStartTime+this.behaviorDuration){if(this.status!==S.EXPIRED)this.setExpired(actor,time);return false}if(this.status===
S.NOT_STARTED){this.status=S.STARTED;this.fireBehaviorStartedEvent(actor,time)}return this.behaviorStartTime<=time},fireBehaviorStartedEvent:function(actor,time){for(var i=0;i<this.lifecycleListenerList.length;i++)if(this.lifecycleListenerList[i].behaviorStarted)this.lifecycleListenerList[i].behaviorStarted(this,time,actor)},fireBehaviorExpiredEvent:function(actor,time){for(var i=0;i<this.lifecycleListenerList.length;i++)this.lifecycleListenerList[i].behaviorExpired(this,time,actor)},fireBehaviorAppliedEvent:function(actor,
time,normalizedTime,value){for(var i=0;i<this.lifecycleListenerList.length;i++)if(this.lifecycleListenerList[i].behaviorApplied)this.lifecycleListenerList[i].behaviorApplied(this,time,normalizedTime,actor,value)},normalizeTime:function(time){time=time-this.behaviorStartTime;if(this.cycleBehavior)time%=this.behaviorDuration;return this.interpolator.getPosition(time/this.behaviorDuration).y},setExpired:function(actor,time){this.status=CAAT.Behavior.Status.EXPIRED;this.setForTime(this.interpolator.getPosition(1).y,
actor);this.fireBehaviorExpiredEvent(actor,time)},setForTime:function(time,actor){},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this},getPropertyName:function(){return""}}})();
(function(){CAAT.ContainerBehavior=function(){CAAT.ContainerBehavior.superclass.constructor.call(this);this.behaviors=[];return this};CAAT.ContainerBehavior.prototype={behaviors:null,conformToDuration:function(duration){this.duration=duration;var f=duration/this.duration;var bh;for(var i=0;i<this.behavior.length;i++){bh=this.behavior[i];bh.setFrameTime(bh.getStartTime()*f,bh.getDuration()*f)}return this},addBehavior:function(behavior){this.behaviors.push(behavior);behavior.addListener(this);return this},
apply:function(time,actor){time+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(time,actor)){time-=this.getStartTime();if(this.cycleBehavior)time%=this.getDuration();var bh=this.behaviors;for(var i=0;i<bh.length;i++)bh[i].apply(time,actor)}},behaviorExpired:function(behavior,time,actor){if(this.cycleBehavior)behavior.setStatus(CAAT.Behavior.Status.STARTED)},setForTime:function(time,actor){var bh=this.behaviors;for(var i=0;i<bh.length;i++)bh[i].setForTime(time,actor);return null},setExpired:function(actor,
time){CAAT.ContainerBehavior.superclass.setExpired.call(this,actor,time);var bh=this.behaviors;for(var i=0;i<bh.length;i++){var bb=bh[i];if(bb.status!==CAAT.Behavior.Status.EXPIRED)bb.setExpired(actor,time-this.behaviorStartTime)}return this},setFrameTime:function(start,duration){CAAT.ContainerBehavior.superclass.setFrameTime.call(this,start,duration);var bh=this.behaviors;for(var i=0;i<bh.length;i++)bh[i].setStatus(CAAT.Behavior.Status.NOT_STARTED);return this},calculateKeyFrameData:function(referenceTime,
prefix,prevValues){var i;var bh;var retValue={};var time;var cssRuleValue;var cssProperty;var property;for(i=0;i<this.behaviors.length;i++){bh=this.behaviors[i];if(bh.status!==CAAT.Behavior.Status.EXPIRED&&!(bh instanceof CAAT.GenericBehavior)){time=referenceTime*this.behaviorDuration;if(bh.behaviorStartTime<=time&&bh.behaviorStartTime+bh.behaviorDuration>=time){time=(time-bh.behaviorStartTime)/bh.behaviorDuration;cssRuleValue=bh.calculateKeyFrameData(time);cssProperty=bh.getPropertyName(prefix);
if(typeof retValue[cssProperty]==="undefined")retValue[cssProperty]="";retValue[cssProperty]+=cssRuleValue+" "}}}var tr="";var pv;function xx(pr){if(retValue[pr])tr+=retValue[pr];else if(prevValues){pv=prevValues[pr];if(pv){tr+=pv;retValue[pr]=pv}}}xx("translate");xx("rotate");xx("scale");var keyFrameRule="";if(tr)keyFrameRule="-"+prefix+"-transform: "+tr+";";tr="";xx("opacity");if(tr)keyFrameRule+=" opacity: "+tr+";";return{rules:keyFrameRule,ret:retValue}},calculateKeyFramesData:function(prefix,
name,keyframessize){if(this.duration===Number.MAX_VALUE)return"";if(typeof keyframessize==="undefined")keyframessize=100;var i;var prevValues=null;var kfd="@-"+prefix+"-keyframes "+name+" {";var ret;var time;var kfr;for(i=0;i<=keyframessize;i++){time=this.interpolator.getPosition(i/keyframessize).y;ret=this.calculateKeyFrameData(time,prefix,prevValues);kfr=""+i/keyframessize*100+"%"+"{"+ret.rules+"}\n";prevValues=ret.ret;kfd+=kfr}kfd+="}";return kfd}};extend(CAAT.ContainerBehavior,CAAT.Behavior,null)})();
(function(){CAAT.RotateBehavior=function(){CAAT.RotateBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.RotateBehavior.prototype={startAngle:0,endAngle:0,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"rotate"},setForTime:function(time,actor){var angle=this.startAngle+time*(this.endAngle-this.startAngle);if(this.doValueApplication)actor.setRotationAnchored(angle,this.anchorX,this.anchorY);return angle},setValues:function(startAngle,
endAngle,anchorx,anchory){this.startAngle=startAngle;this.endAngle=endAngle;if(typeof anchorx!=="undefined"&&typeof anchory!=="undefined"){this.anchorX=anchorx;this.anchorY=anchory}return this},setAngles:function(start,end){return this.setValues(start,end)},setAnchor:function(actor,rx,ry){this.anchorX=rx/actor.width;this.anchorY=ry/actor.height;return this},calculateKeyFrameData:function(time){time=this.interpolator.getPosition(time).y;return"rotate("+(this.startAngle+time*(this.endAngle-this.startAngle))+
"rad)"},calculateKeyFramesData:function(prefix,name,keyframessize){if(typeof keyframessize==="undefined")keyframessize=100;keyframessize>>=0;var i;var kfr;var kfd="@-"+prefix+"-keyframes "+name+" {";for(i=0;i<=keyframessize;i++){kfr=""+i/keyframessize*100+"%"+"{"+"-"+prefix+"-transform:"+this.calculateKeyFrameData(i/keyframessize)+"}\n";kfd+=kfr}kfd+="}";return kfd}};extend(CAAT.RotateBehavior,CAAT.Behavior,null)})();
(function(){CAAT.GenericBehavior=function(){CAAT.GenericBehavior.superclass.constructor.call(this);return this};CAAT.GenericBehavior.prototype={start:0,end:0,target:null,property:null,callback:null,setForTime:function(time,actor){var value=this.start+time*(this.end-this.start);if(this.callback)this.callback(value,this.target,actor);if(this.property)this.target[this.property]=value},setValues:function(start,end,target,property,callback){this.start=start;this.end=end;this.target=target;this.property=
property;this.callback=callback;return this}};extend(CAAT.GenericBehavior,CAAT.Behavior,null)})();
(function(){CAAT.ScaleBehavior=function(){CAAT.ScaleBehavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.ScaleBehavior.prototype={startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"scale"},setForTime:function(time,actor){var scaleX=this.startScaleX+time*(this.endScaleX-this.startScaleX);var scaleY=this.startScaleY+time*(this.endScaleY-this.startScaleY);if(0===scaleX)scaleX=0.01;if(0===
scaleY)scaleY=0.01;if(this.doValueApplication)actor.setScaleAnchored(scaleX,scaleY,this.anchorX,this.anchorY);return{scaleX:scaleX,scaleY:scaleY}},setValues:function(startX,endX,startY,endY,anchorx,anchory){this.startScaleX=startX;this.endScaleX=endX;this.startScaleY=startY;this.endScaleY=endY;if(typeof anchorx!=="undefined"&&typeof anchory!=="undefined"){this.anchorX=anchorx;this.anchorY=anchory}return this},setAnchor:function(actor,x,y){this.anchorX=x/actor.width;this.anchorY=y/actor.height;return this},
calculateKeyFrameData:function(time){var scaleX;var scaleY;time=this.interpolator.getPosition(time).y;scaleX=this.startScaleX+time*(this.endScaleX-this.startScaleX);scaleY=this.startScaleY+time*(this.endScaleY-this.startScaleY);return"scaleX("+scaleX+") scaleY("+scaleY+")"},calculateKeyFramesData:function(prefix,name,keyframessize){if(typeof keyframessize==="undefined")keyframessize=100;keyframessize>>=0;var i;var kfr;var kfd="@-"+prefix+"-keyframes "+name+" {";for(i=0;i<=keyframessize;i++){kfr=""+
i/keyframessize*100+"%"+"{"+"-"+prefix+"-transform:"+this.calculateKeyFrameData(i/keyframessize)+"}";kfd+=kfr}kfd+="}";return kfd}};extend(CAAT.ScaleBehavior,CAAT.Behavior,null)})();
(function(){CAAT.AlphaBehavior=function(){CAAT.AlphaBehavior.superclass.constructor.call(this);return this};CAAT.AlphaBehavior.prototype={startAlpha:0,endAlpha:0,getPropertyName:function(){return"opacity"},setForTime:function(time,actor){var alpha=this.startAlpha+time*(this.endAlpha-this.startAlpha);if(this.doValueApplication)actor.setAlpha(alpha);return alpha},setValues:function(start,end){this.startAlpha=start;this.endAlpha=end;return this},calculateKeyFrameData:function(time){time=this.interpolator.getPosition(time).y;
return this.startAlpha+time*(this.endAlpha-this.startAlpha)},calculateKeyFramesData:function(prefix,name,keyframessize){if(typeof keyframessize==="undefined")keyframessize=100;keyframessize>>=0;var i;var kfr;var kfd="@-"+prefix+"-keyframes "+name+" {";for(i=0;i<=keyframessize;i++){kfr=""+i/keyframessize*100+"%"+"{"+"opacity: "+this.calculateKeyFrameData(i/keyframessize)+"}";kfd+=kfr}kfd+="}";return kfd}};extend(CAAT.AlphaBehavior,CAAT.Behavior,null)})();
(function(){CAAT.PathBehavior=function(){CAAT.PathBehavior.superclass.constructor.call(this);return this};CAAT.PathBehavior.autorotate={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2};CAAT.PathBehavior.prototype={path:null,autoRotate:false,prevX:-1,prevY:-1,autoRotateOp:CAAT.PathBehavior.autorotate.FREE,getPropertyName:function(){return"translate"},setAutoRotate:function(autorotate,autorotateOp){this.autoRotate=autorotate;if(autorotateOp!==undefined)this.autoRotateOp=autorotateOp;return this},setPath:function(path){this.path=
path;return this},setValues:function(path){return this.setPath(path)},setTranslation:function(tx,ty){return this},calculateKeyFrameData:function(time){time=this.interpolator.getPosition(time).y;var point=this.path.getPosition(time);return"translateX("+point.x+"px) translateY("+point.y+"px)"},calculateKeyFramesData:function(prefix,name,keyframessize){if(typeof keyframessize==="undefined")keyframessize=100;keyframessize>>=0;var i;var kfr;var time;var kfd="@-"+prefix+"-keyframes "+name+" {";for(i=0;i<=
keyframessize;i++){kfr=""+i/keyframessize*100+"%"+"{"+"-"+prefix+"-transform:"+this.calculateKeyFrameData(i/keyframessize)+"}";kfd+=kfr}kfd+="}";return kfd},setForTime:function(time,actor){if(!this.path)return{x:actor.x,y:actor.y};var point=this.path.getPosition(time);if(this.autoRotate){if(-1===this.prevX&&-1===this.prevY){this.prevX=point.x;this.prevY=point.y}var ax=point.x-this.prevX;var ay=point.y-this.prevY;if(ax===0&&ay===0){actor.setLocation(point.x,point.y);return{x:actor.x,y:actor.y}}var angle=
Math.atan2(ay,ax);var si=CAAT.SpriteImage.prototype;var pba=CAAT.PathBehavior.autorotate;if(this.autoRotateOp===pba.LEFT_TO_RIGHT)if(this.prevX<=point.x)actor.setImageTransformation(si.TR_NONE);else{actor.setImageTransformation(si.TR_FLIP_HORIZONTAL);angle+=Math.PI}else if(this.autoRotateOp===pba.RIGHT_TO_LEFT)if(this.prevX<=point.x)actor.setImageTransformation(si.TR_FLIP_HORIZONTAL);else{actor.setImageTransformation(si.TR_NONE);angle-=Math.PI}actor.setRotation(angle);this.prevX=point.x;this.prevY=
point.y;var modulo=Math.sqrt(ax*ax+ay*ay);ax/=modulo;ay/=modulo}if(this.doValueApplication){actor.setLocation(point.x,point.y);return{x:actor.x,y:actor.y}}else return{x:point.x,y:point.y}},positionOnTime:function(time){if(this.isBehaviorInTime(time,null)){time=this.normalizeTime(time);return this.path.getPosition(time)}return{x:-1,y:-1}}};extend(CAAT.PathBehavior,CAAT.Behavior)})();(function(){CAAT.ColorBehavior=function(){return this};CAAT.ColorBehavior.prototype={};extend(CAAT.ColorBehavior,CAAT.Behavior)})();
(function(){CAAT.Scale1Behavior=function(){CAAT.Scale1Behavior.superclass.constructor.call(this);this.anchor=CAAT.Actor.prototype.ANCHOR_CENTER;return this};CAAT.Scale1Behavior.prototype={startScale:1,endScale:1,anchorX:0.5,anchorY:0.5,sx:1,sy:1,applyOnX:true,getPropertyName:function(){return"scale"},setForTime:function(time,actor){var scale=this.startScale+time*(this.endScale-this.startScale);if(0===scale)scale=0.01;if(this.doValueApplication)if(this.applyOnX)actor.setScaleAnchored(scale,actor.scaleY,
this.anchorX,this.anchorY);else actor.setScaleAnchored(actor.scaleX,scale,this.anchorX,this.anchorY);return scale},setValues:function(start,end,applyOnX,anchorx,anchory){this.startScale=start;this.endScale=end;this.applyOnX=!!applyOnX;if(typeof anchorx!=="undefined"&&typeof anchory!=="undefined"){this.anchorX=anchorx;this.anchorY=anchory}return this},setAnchor:function(actor,x,y){this.anchorX=x/actor.width;this.anchorY=y/actor.height;return this},calculateKeyFrameData:function(time){var scale;time=
this.interpolator.getPosition(time).y;scale=this.startScale+time*(this.endScale-this.startScale);return this.applyOnX?"scaleX("+scale+")":"scaleY("+scale+")"},calculateKeyFramesData:function(prefix,name,keyframessize){if(typeof keyframessize==="undefined")keyframessize=100;keyframessize>>=0;var i;var kfr;var kfd="@-"+prefix+"-keyframes "+name+" {";for(i=0;i<=keyframessize;i++){kfr=""+i/keyframessize*100+"%"+"{"+"-"+prefix+"-transform:"+this.calculateKeyFrameData(i/keyframessize)+"}";kfd+=kfr}kfd+=
"}";return kfd}};extend(CAAT.Scale1Behavior,CAAT.Behavior)})();
(function(){CAAT.CSS={};CAAT.CSS.PREFIX=function(){var prefix="";var prefixes=["WebKit","Moz","O"];var keyframes="";for(var i=0;i<prefixes.length;i++)if(window[prefixes[i]+"CSSKeyframeRule"]){prefix=prefixes[i].toLowerCase();break}CAAT.CSS.PROP_ANIMATION="-"+prefix+"-animation";return prefix}();CAAT.CSS.applyKeyframe=function(domElement,name,secs,forever){domElement.style[CAAT.CSS.PROP_ANIMATION]=name+" "+secs/1E3+"s linear both "+(forever?"infinite":"")};CAAT.CSS.unregisterKeyframes=function(name){var index=
CAAT.CSS.getCSSKeyframesIndex(name);if(-1!==index)document.styleSheets[0].deleteRule(index)};CAAT.CSS.registerKeyframes=function(kfDescriptor){var name=kfDescriptor.name;var behavior=kfDescriptor.behavior;var size=kfDescriptor.size;var overwrite=kfDescriptor.overwrite;if(typeof name==="undefined"||typeof behavior==="undefined")throw"Keyframes must be defined by a name and a CAAT.Behavior instance.";if(typeof size==="undefined")size=100;if(typeof overwrite==="undefined")overwrite=false;var cssRulesIndex=
CAAT.CSS.getCSSKeyframesIndex(name);if(-1!==cssRulesIndex&&!overwrite)return;var keyframesRule=behavior.calculateKeyframesData(CAAT.CSS.PREFIX,name,size);if(document.styleSheets){if(!document.styleSheets.length){var s=document.createElement("style");s.type="text/css";document.getElementsByTagName("head")[0].appendChild(s)}if(-1!==cssRulesIndex)document.styleSheets[0].deleteRule(cssRulesIndex);document.styleSheets[0].insertRule(keyframesRule,0)}};CAAT.CSS.getCSSKeyframesIndex=function(name){var ss=
document.styleSheets;for(var i=ss.length-1;i>=0;i--)try{var s=ss[i],rs=s.cssRules?s.cssRules:s.rules?s.rules:[];for(var j=rs.length-1;j>=0;j--)if((rs[j].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||rs[j].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&rs[j].name===name)return j}catch(e){}return-1};CAAT.CSS.getCSSKeyframes=function(name){var ss=document.styleSheets;for(var i=ss.length-1;i>=0;i--)try{var s=ss[i],rs=s.cssRules?s.cssRules:s.rules?s.rules:[];for(var j=rs.length-1;j>=0;j--)if((rs[j].type===
window.CSSRule.WEBKIT_KEYFRAMES_RULE||rs[j].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&rs[j].name===name)return rs[j]}catch(e){}return null}})();
(function(){CAAT.BrowserDetect=function(){this.init();return this};CAAT.BrowserDetect.prototype={browser:"",version:0,OS:"",init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=
data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!==-1)return data[i].identity}else if(dataProp)return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index===-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",
identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",
identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},
{string:navigator.platform,subString:"Linux",identity:"Linux"}]}})();
(function(){CAAT.Debug=function(){return this};CAAT.Debug.prototype={width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:false,SCALE:60,debugTpl:'    <style type="text/css">'+"        #caat-debug {"+"            z-index: 10000;"+"            position:fixed;"+"            bottom:0;"+"            left:0;"+
"            width:100%;"+"            background-color: rgba(0,0,0,0.8);"+"        }"+"        #caat-debug.caat_debug_max {"+"            margin-bottom: 0px;"+"        }"+"        .caat_debug_bullet {"+"            display:inline-block;"+"            background-color:#f00;"+"            width:8px;"+"            height:8px;"+"            border-radius: 4px;"+"            margin-left:10px;"+"            margin-right:2px;"+"        }"+"        .caat_debug_description {"+"            font-size:11px;"+
"            font-family: helvetica, arial;"+"            color: #aaa;"+"            display: inline-block;"+"        }"+"        .caat_debug_value {"+"            font-size:11px;"+"            font-family: helvetica, arial;"+"            color: #fff;"+"            width:25px;"+"            text-align: right;"+"            display: inline-block;"+"            margin-right: .3em;"+"        }"+"        .caat_debug_indicator {"+"            float: right;"+"        }"+"        #debug_tabs {"+"            border-top: 1px solid #888;"+
"            height:25px;"+"        }"+"        .tab_max_min {"+"            font-family: helvetica, arial;"+"            font-size: 12px;"+"            font-weight: bold;"+"            color: #888;"+"            border-right: 1px solid #888;"+"            float: left;"+"            cursor: pointer;"+"            padding-left: 5px;"+"            padding-right: 5px;"+"            padding-top: 5px;"+"            height: 20px;"+"        }"+"        .debug_tabs_content_hidden {"+"            display: none;"+
"            width: 100%;"+"        }"+"        .debug_tabs_content_visible {"+"            display: block;"+"            width: 100%;"+"        }"+"        .checkbox_enabled {"+"            display:inline-block;"+"            background-color:#eee;"+"            border: 1px solid #eee;"+"            width:6px;"+"            height:8px;"+"            margin-left:12px;"+"            margin-right:2px;"+"            cursor: pointer;"+"        }"+"        .checkbox_disabled {"+"            display:inline-block;"+
"            width:6px;"+"            height:8px;"+"            background-color: #333;"+"            border: 1px solid #eee;"+"            margin-left:12px;"+"            margin-right:2px;"+"            cursor: pointer;"+"        }"+"        .checkbox_description {"+"            font-size:11px;"+"            font-family: helvetica, arial;"+"            color: #fff;"+"        }"+"        .debug_tab {"+"            font-family: helvetica, arial;"+"            font-size: 12px;"+"            color: #fff;"+
"            border-right: 1px solid #888;"+"            float: left;"+"            padding-left: 5px;"+"            padding-right: 5px;"+"            height: 20px;"+"            padding-top: 5px;"+"            cursor: default;"+"        }"+"        .debug_tab_selected {"+"            background-color: #444;"+"            cursor: default;"+"        }"+"        .debug_tab_not_selected {"+"            background-color: #000;"+"            cursor: pointer;"+"        }"+"    </style>"+'    <div id="caat-debug">'+
'        <div id="debug_tabs">'+"            <span class=\"tab_max_min\" onCLick=\"javascript: var debug = document.getElementById('debug_tabs_content');if (debug.className === 'debug_tabs_content_visible') {debug.className = 'debug_tabs_content_hidden'} else {debug.className = 'debug_tabs_content_visible'}\"> CAAT Debug panel </span>"+'            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>'+'            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>'+
'            <span class="caat_debug_indicator">'+'                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>'+'                <span class="caat_debug_description">Draw Time: </span>'+'                <span class="caat_debug_value" id="textDrawTime">5.46</span>'+'                <span class="caat_debug_description">ms.</span>'+"            </span>"+'            <span class="caat_debug_indicator">'+'                <span class="caat_debug_bullet" style="background-color:#f00;"></span>'+
'                <span class="caat_debug_description">FPS: </span>'+'                <span class="caat_debug_value" id="textFPS">48</span>'+"            </span>"+"        </div>"+'        <div id="debug_tabs_content" class="debug_tabs_content_hidden">'+'            <div id="caat-debug-tab0-content">'+'                <canvas id="caat-debug-canvas" height="60"></canvas>'+"                <div>"+"                    <span>"+'                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>'+
'                        <span class="caat_debug_description">RAF Time:</span>'+'                        <span class="caat_debug_value" id="textRAFTime">20.76</span>'+'                        <span class="caat_debug_description">ms.</span>'+"                    </span>"+"                    <span>"+'                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>'+'                        <span class="caat_debug_description">Entities Total: </span>'+'                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>'+
"                    </span>"+"                    <span>"+'                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>'+'                        <span class="caat_debug_description">Entities Active: </span>'+'                        <span class="caat_debug_value" id="textEntitiesActive">37</span>'+"                    </span>"+"                    <span>"+'                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>'+'                        <span class="caat_debug_description">Draws: </span>'+
'                        <span class="caat_debug_value" id="textDraws">0</span>'+"                    </span>"+"                    <span>"+'                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>'+'                        <span class="caat_debug_description">DirtyRects: </span>'+'                        <span class="caat_debug_value" id="textDirtyRects">0</span>'+"                    </span>"+"                </div>"+"            </div>"+'            <div id="caat-debug-tab1-content">'+
"                <div>"+"                    <div>"+'                        <span id="control-sound"></span>'+'                        <span class="checkbox_description">Sound</span>'+"                    </div>"+"                    <div>"+'                        <span id="control-music"></span>'+'                        <span class="checkbox_description">Music</span>'+"                    </div>"+"                    <div>"+'                        <span id="control-aabb"></span>'+'                        <span class="checkbox_description">AA Bounding Boxes</span>'+
"                    </div>"+"                    <div>"+'                        <span id="control-bb"></span>'+'                        <span class="checkbox_description">Bounding Boxes</span>'+"                    </div>"+"                    <div>"+'                        <span id="control-dr"></span>'+'                        <span class="checkbox_description">Dirty Rects</span>'+"                    </div>"+"                </div>"+"            </div>"+"        </div>"+"    </div>",setScale:function(s){this.scale=
s;return this},initialize:function(w,h){w=window.innerWidth;this.width=w;this.height=h;this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1E3,fpsMax:0};var debugContainer=document.getElementById("caat-debug");if(!debugContainer){var wrap=document.createElement("div");wrap.innerHTML=this.debugTpl;document.body.appendChild(wrap);eval(""+"        function initCheck( name, bool, callback ) {"+"            var elem= document.getElementById(name);"+
"            if ( elem ) {"+'                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";'+"                if ( callback ) {"+'                    elem.addEventListener( "click", (function(elem, callback) {'+"                        return function(e) {"+"                            elem.__value= !elem.__value;"+'                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";'+"                            callback(e,elem.__value);"+"                        }"+
"                    })(elem, callback), false );"+"                }"+"                elem.__value= bool;"+"            }"+"        }"+"        function setupTabs() {"+"            var numTabs=0;"+"            var elem;"+"            var elemContent;"+"            do {"+'                elem= document.getElementById("caat-debug-tab"+numTabs);'+"                if ( elem ) {"+'                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");'+"                    if ( elemContent ) {"+
"                        elemContent.style.display= numTabs===0 ? 'block' : 'none';"+'                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";'+'                        elem.addEventListener( "click", (function(tabIndex) {'+"                            return function(e) {"+"                                for( var i=0; i<numTabs; i++ ) {"+'                                    var _elem= document.getElementById("caat-debug-tab"+i);'+
'                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");'+"                                    _elemContent.style.display= i===tabIndex ? 'block' : 'none';"+'                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";'+"                                }"+"                            }"+"                        })(numTabs), false );"+"                    }"+"                    numTabs++;"+
"                }"+"            } while( elem );"+"        }"+'        initCheck( "control-sound", CAAT.director[0].isSoundEffectsEnabled(), function(e, bool) {'+"            CAAT.director[0].setSoundEffectsEnabled(bool);"+"        } );"+'        initCheck( "control-music", CAAT.director[0].isMusicEnabled(), function(e, bool) {'+"            CAAT.director[0].setMusicEnabled(bool);"+"        } );"+'        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {'+"            CAAT.DEBUGAABB= bool;"+
"            CAAT.director[0].currentScene.dirty= true;"+"        } );"+'        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {'+"            CAAT.DEBUGBB= bool;"+"            if ( bool ) {"+"                CAAT.DEBUGAABB= true;"+"            }"+"            CAAT.director[0].currentScene.dirty= true;"+"        } );"+'        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {'+"            CAAT.DEBUG_DIRTYRECTS= bool;"+"        });"+"        setupTabs();")}this.canvas=
document.getElementById("caat-debug-canvas");if(null===this.canvas){this.canDebug=false;return}this.canvas.width=w;this.canvas.height=h;this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,this.width,this.height);this.textFPS=document.getElementById("textFPS");this.textDrawTime=document.getElementById("textDrawTime");this.textRAFTime=document.getElementById("textRAFTime");this.textEntitiesTotal=document.getElementById("textEntitiesTotal");this.textEntitiesActive=document.getElementById("textEntitiesActive");
this.textDraws=document.getElementById("textDraws");this.textDirtyRects=document.getElementById("textDirtyRects");this.canDebug=true;return this},debugInfo:function(statistics){this.statistics=statistics;this.frameTimeAcc+=CAAT.FRAME_TIME;this.frameRAFAcc+=CAAT.REQUEST_ANIMATION_FRAME_TIME;this.framerate.frames++;if(CAAT.RAF>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=this.framerate.frames*1E3/(CAAT.RAF-this.framerate.timeLastRefresh)|0;this.framerate.fpsMin=
this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin;this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps);this.textFPS.innerHTML=this.framerate.fps;var value=(this.frameTimeAcc*100/this.framerate.frames|0)/100;this.frameTimeAcc=0;this.textDrawTime.innerHTML=value;var value2=(this.frameRAFAcc*100/this.framerate.frames|0)/100;this.frameRAFAcc=0;this.textRAFTime.innerHTML=value2;this.framerate.timeLastRefresh=CAAT.RAF;this.framerate.frames=
0;this.paint(value2)}this.textEntitiesTotal.innerHTML=this.statistics.size_total;this.textEntitiesActive.innerHTML=this.statistics.size_active;this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects;this.textDraws.innerHTML=this.statistics.draws},paint:function(rafValue){var ctx=this.ctx;var t=0;ctx.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height);ctx.strokeStyle="black";ctx.beginPath();ctx.moveTo(this.width-0.5,0);ctx.lineTo(this.width-0.5,this.height);ctx.stroke();
ctx.strokeStyle="#a22";ctx.beginPath();t=this.height-(20/this.SCALE*this.height>>0)-0.5;ctx.moveTo(0.5,t);ctx.lineTo(this.width+0.5,t);ctx.stroke();ctx.strokeStyle="#aa2";ctx.beginPath();t=this.height-(30/this.SCALE*this.height>>0)-0.5;ctx.moveTo(0.5,t);ctx.lineTo(this.width+0.5,t);ctx.stroke();var fps=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);if(-1===this.framerate.prevFps)this.framerate.prevFps=fps|0;ctx.strokeStyle="#0ff";ctx.beginPath();ctx.moveTo(this.width,(fps|0)-0.5);
ctx.lineTo(this.width,this.framerate.prevFps-0.5);ctx.stroke();this.framerate.prevFps=fps;var t1=(this.height-rafValue/this.SCALE*this.height>>0)-0.5;ctx.strokeStyle="#ff0";ctx.beginPath();ctx.moveTo(this.width,t1);ctx.lineTo(this.width,t1);ctx.stroke()}}})();
(function(){CAAT.Actor=function(){this.behaviorList=[];this.lifecycleListenerList=[];this.AABB=new CAAT.Rectangle;this.viewVertices=[new CAAT.Point(0,0,0),new CAAT.Point(0,0,0),new CAAT.Point(0,0,0),new CAAT.Point(0,0,0)];this.scaleAnchor=this.ANCHOR_CENTER;this.modelViewMatrix=new CAAT.Matrix;this.worldModelViewMatrix=new CAAT.Matrix;this.resetTransform();this.setScale(1,1);this.setRotation(0);return this};CAAT.Actor.ANCHOR_CENTER=0;CAAT.Actor.ANCHOR_TOP=1;CAAT.Actor.ANCHOR_BOTTOM=2;CAAT.Actor.ANCHOR_LEFT=
3;CAAT.Actor.ANCHOR_RIGHT=4;CAAT.Actor.ANCHOR_TOP_LEFT=5;CAAT.Actor.ANCHOR_TOP_RIGHT=6;CAAT.Actor.ANCHOR_BOTTOM_LEFT=7;CAAT.Actor.ANCHOR_BOTTOM_RIGHT=8;CAAT.Actor.ANCHOR_CUSTOM=9;CAAT.Actor.CACHE_SIMPLE=1;CAAT.Actor.CACHE_DEEP=2;CAAT.Actor.prototype={lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,start_time:0,duration:Number.MAX_VALUE,clip:false,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:0,scaleY:0,scaleTX:0.5,scaleTY:0.5,scaleAnchor:0,rotationAngle:0,rotationY:0.5,
alpha:1,rotationX:0.5,isGlobalAlpha:false,frameAlpha:1,expired:false,discardable:false,pointed:false,mouseEnabled:true,visible:true,ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:false,dirty:true,wdirty:true,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,
glEnabled:false,backgroundImage:null,id:null,size_active:1,size_total:1,__next:null,__d_ax:-1,__d_ay:-1,gestureEnabled:false,invalid:true,cached:0,collides:false,collidesAsRect:true,isAA:true,setupCollission:function(collides,isCircular){this.collides=collides;this.collidesAsRect=!isCircular},invalidate:function(){this.invalid=true},setGestureEnabled:function(enable){this.gestureEnabled=!!enable},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(id){this.id=
id;return this},setParent:function(parent){this.parent=parent;return this},setBackgroundImage:function(image,adjust_size_to_image){if(image){if(!(image instanceof CAAT.SpriteImage))image=(new CAAT.SpriteImage).initialize(image,1,1);image.setOwner(this);this.backgroundImage=image;if(typeof adjust_size_to_image==="undefined"||adjust_size_to_image){this.width=image.getWidth();this.height=image.getHeight()}this.glEnabled=true}else this.backgroundImage=null;return this},setSpriteIndex:function(index){if(this.backgroundImage){this.backgroundImage.setSpriteIndex(index);
this.invalidate()}return this},setBackgroundImageOffset:function(ox,oy){if(this.backgroundImage)this.backgroundImage.setOffset(ox,oy);return this},setAnimationImageIndex:function(ii){if(this.backgroundImage)this.backgroundImage.setAnimationImageIndex(ii);return this},setChangeFPS:function(time){if(this.backgroundImage)this.backgroundImage.setChangeFPS(time);return this},setImageTransformation:function(it){if(this.backgroundImage)this.backgroundImage.setSpriteTransformation(it);return this},centerOn:function(x,
y){this.setLocation(x-this.width/2,y-this.height/2);return this},centerAt:function(x,y){return this.centerOn(x,y)},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(visible){this.visible=visible;return this},setOutOfFrameTime:function(){this.setFrameTime(-1,0);return this},addListener:function(actorListener){this.lifecycleListenerList.push(actorListener);return this},removeListener:function(actorListener){var n=this.lifecycleListenerList.length;while(n--)if(this.lifecycleListenerList[n]===
actorListener){this.lifecycleListenerList.splice(n,1);return}},setGlobalAlpha:function(global){this.isGlobalAlpha=global;return this},fireEvent:function(sEventType,time){for(var i=0;i<this.lifecycleListenerList.length;i++)this.lifecycleListenerList[i].actorLifeCycleEvent(this,sEventType,time)},setExpired:function(time){this.expired=true;this.fireEvent("expired",time);return this},enableEvents:function(enable){this.mouseEnabled=enable;return this},emptyBehaviorList:function(){this.behaviorList=[];
return this},setFillStyle:function(style){this.fillStyle=style;return this},setStrokeStyle:function(style){this.strokeStyle=style;return this},setPaint:function(paint){return this.setFillStyle(paint)},setAlpha:function(alpha){this.alpha=alpha;this.invalidate();return this},resetTransform:function(){this.rotationAngle=0;this.rotationX=0.5;this.rotationY=0.5;this.scaleX=1;this.scaleY=1;this.scaleTX=0.5;this.scaleTY=0.5;this.scaleAnchor=0;this.oldX=-1;this.oldY=-1;this.dirty=true;return this},setFrameTime:function(startTime,
duration){this.start_time=startTime;this.duration=duration;this.expired=false;this.dirty=true;return this},paint:function(director,time){if(this.backgroundImage)this.backgroundImage.paint(director,time,0,0);else if(this.fillStyle){var ctx=director.crc;ctx.fillStyle=this.fillStyle;ctx.fillRect(0,0,this.width,this.height)}},setScale:function(sx,sy){this.scaleX=sx;this.scaleY=sy;this.dirty=true;return this},getAnchorPercent:function(anchor){var anchors=[0.5,0.5,0.5,0,0.5,1,0,0.5,1,0.5,0,0,1,0,0,1,1,
1];return{x:anchors[anchor*2],y:anchors[anchor*2+1]}},getAnchor:function(anchor){var tx=0,ty=0;switch(anchor){case this.ANCHOR_CENTER:tx=0.5;ty=0.5;break;case this.ANCHOR_TOP:tx=0.5;ty=0;break;case this.ANCHOR_BOTTOM:tx=0.5;ty=1;break;case this.ANCHOR_LEFT:tx=0;ty=0.5;break;case this.ANCHOR_RIGHT:tx=1;ty=0.5;break;case this.ANCHOR_TOP_RIGHT:tx=1;ty=0;break;case this.ANCHOR_BOTTOM_LEFT:tx=0;ty=1;break;case this.ANCHOR_BOTTOM_RIGHT:tx=1;ty=1;break;case this.ANCHOR_TOP_LEFT:tx=0;ty=0;break}return{x:tx,
y:ty}},setGlobalAnchor:function(ax,ay){this.tAnchorX=ax;this.rotationX=ax;this.scaleTX=ax;this.tAnchorY=ay;this.rotationY=ay;this.scaleTY=ay;this.dirty=true;return this},setScaleAnchor:function(sax,say){this.scaleTX=sax;this.scaleTY=say;this.dirty=true;return this},setScaleAnchored:function(sx,sy,anchorx,anchory){this.scaleTX=anchorx;this.scaleTY=anchory;this.scaleX=sx;this.scaleY=sy;this.dirty=true;return this},setRotationAnchor:function(rax,ray){this.rotationX=ray;this.rotationY=rax;this.dirty=
true;return this},setRotation:function(angle){this.rotationAngle=angle;this.dirty=true;return this},setRotationAnchored:function(angle,rx,ry){this.rotationAngle=angle;this.rotationX=rx;this.rotationY=ry;this.dirty=true;return this},setSize:function(w,h){this.width=w|0;this.height=h|0;this.dirty=true;return this},setBounds:function(x,y,w,h){this.x=x;this.y=y;this.width=w;this.height=h;this.dirty=true;return this},setLocation:function(x,y){this.x=x;this.y=y;this.oldX=x;this.oldY=y;this.dirty=true;return this},
setPosition:function(x,y){return this.setLocation(x,y)},setPositionAnchor:function(pax,pay){this.tAnchorX=pax;this.tAnchorY=pay;return this},setPositionAnchored:function(x,y,pax,pay){this.setLocation(x,y);this.tAnchorX=pax;this.tAnchorY=pay;return this},isInAnimationFrame:function(time){if(this.expired)return false;if(this.duration===Number.MAX_VALUE)return this.start_time<=time;if(time>=this.start_time+this.duration){if(!this.expired)this.setExpired(time);return false}return this.start_time<=time&&
time<this.start_time+this.duration},contains:function(x,y){return x>=0&&y>=0&&x<this.width&&y<this.height},create:function(){return this},addBehavior:function(behavior){this.behaviorList.push(behavior);return this},removeBehaviour:function(behavior){var c=this.behaviorList;var n=c.length-1;while(n)if(c[n]===behavior){c.splice(n,1);return this}return this},removeBehaviorById:function(id){var c=this.behaviorList;for(var n=0;n<c.length;n++)if(c[n].id===id)c.splice(n,1);return this},getBehavior:function(id){var c=
this.behaviorList;for(var n=0;n<c.length;n++){var cc=c[n];if(cc.id===id)return cc}return null},setDiscardable:function(discardable){this.discardable=discardable;return this},destroy:function(time){if(this.parent)this.parent.removeChild(this);this.fireEvent("destroyed",time)},modelToView:function(point){var tm=this.worldModelViewMatrix.matrix;if(point instanceof Array)for(var i=0;i<point.length;i++){var pt=point[i];var x=pt.x;var y=pt.y;pt.x=x*tm[0]+y*tm[1]+tm[2];pt.y=x*tm[3]+y*tm[4]+tm[5]}else{var x=
point.x;var y=point.y;point.x=x*tm[0]+y*tm[1]+tm[2];point.y=x*tm[3]+y*tm[4]+tm[5]}return point},modelToModel:function(point,otherActor){return otherActor.viewToModel(this.modelToView(point))},viewToModel:function(point){this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse();this.worldModelViewMatrixI.transformCoord(point);return point},findActorAtPosition:function(point){if(!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time))return null;this.modelViewMatrixI=this.modelViewMatrix.getInverse();
this.modelViewMatrixI.transformCoord(point);return this.contains(point.x,point.y)?this:null},enableDrag:function(){var me=this;this.ax=0;this.ay=0;this.mx=0;this.my=0;this.asx=1;this.asy=1;this.ara=0;this.screenx=0;this.screeny=0;this.mouseEnter=function(mouseEvent){this.__d_ax=-1;this.__d_ay=-1;this.pointed=true;CAAT.setCursor("move")};this.mouseExit=function(mouseEvent){this.__d_ax=-1;this.__d_ay=-1;this.pointed=false;CAAT.setCursor("default")};this.mouseMove=function(mouseEvent){};this.mouseUp=
function(mouseEvent){this.__d_ax=-1;this.__d_ay=-1};this.mouseDrag=function(mouseEvent){var pt;pt=this.modelToView(new CAAT.Point(mouseEvent.x,mouseEvent.y));this.parent.viewToModel(pt);if(this.__d_ax===-1||this.__d_ay===-1){this.__d_ax=pt.x;this.__d_ay=pt.y;this.__d_asx=this.scaleX;this.__d_asy=this.scaleY;this.__d_ara=this.rotationAngle;this.__d_screenx=mouseEvent.screenPoint.x;this.__d_screeny=mouseEvent.screenPoint.y}if(mouseEvent.isShiftDown()){var scx=(mouseEvent.screenPoint.x-this.__d_screenx)/
100;var scy=(mouseEvent.screenPoint.y-this.__d_screeny)/100;if(!mouseEvent.isAltDown()){var sc=Math.max(scx,scy);scx=sc;scy=sc}this.setScale(scx+this.__d_asx,scy+this.__d_asy)}else if(mouseEvent.isControlDown()){var vx=mouseEvent.screenPoint.x-this.__d_screenx;var vy=mouseEvent.screenPoint.y-this.__d_screeny;this.setRotation(-Math.atan2(vx,vy)+this.__d_ara)}else{this.x+=pt.x-this.__d_ax;this.y+=pt.y-this.__d_ay}this.__d_ax=pt.x;this.__d_ay=pt.y};return this},mouseClick:function(mouseEvent){},mouseDblClick:function(mouseEvent){},
mouseEnter:function(mouseEvent){this.pointed=true},mouseExit:function(mouseEvent){this.pointed=false},mouseMove:function(mouseEvent){},mouseDown:function(mouseEvent){},mouseUp:function(mouseEvent){},mouseOut:function(mouseEvent){},mouseOver:function(mouseEvent){},mouseDrag:function(mouseEvent){},drawScreenBoundingBox:function(director,time){if(null!==this.AABB&&this.inFrame){var s=this.AABB;var ctx=director.ctx;ctx.strokeStyle=CAAT.DEBUGAABBCOLOR;ctx.strokeRect(0.5+(s.x|0),0.5+(s.y|0),s.width|0,s.height|
0);if(CAAT.DEBUGBB){var vv=this.viewVertices;ctx.beginPath();ctx.lineTo(vv[0].x,vv[0].y);ctx.lineTo(vv[1].x,vv[1].y);ctx.lineTo(vv[2].x,vv[2].y);ctx.lineTo(vv[3].x,vv[3].y);ctx.closePath();ctx.strokeStyle=CAAT.DEBUGBBCOLOR;ctx.stroke()}}},animate:function(director,time){var i;if(!this.isInAnimationFrame(time)){this.inFrame=false;this.dirty=true;return false}if(this.x!==this.oldX||this.y!==this.oldY){this.dirty=true;this.oldX=this.x;this.oldY=this.y}for(i=0;i<this.behaviorList.length;i++)this.behaviorList[i].apply(time,
this);if(this.clipPath)this.clipPath.applyBehaviors(time);this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid){if(director.dirtyRectsEnabled)director.addDirtyRect(this.AABB);this.setScreenBounds();if(director.dirtyRectsEnabled)director.addDirtyRect(this.AABB)}this.dirty=false;this.invalid=false;this.inFrame=true;return this.AABB.intersects(director.AABB)},setModelViewMatrix:function(){var c,s,_m00,_m01,_m10,_m11;var mm0,mm1,mm2,mm3,mm4,mm5;var mm;this.wdirty=false;mm=this.modelViewMatrix.matrix;
if(this.dirty){mm0=1;mm1=0;mm3=0;mm4=1;mm2=this.x-this.tAnchorX*this.width;mm5=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var rx=this.rotationX*this.width;var ry=this.rotationY*this.height;mm2+=mm0*rx+mm1*ry;mm5+=mm3*rx+mm4*ry;c=Math.cos(this.rotationAngle);s=Math.sin(this.rotationAngle);_m00=mm0;_m01=mm1;_m10=mm3;_m11=mm4;mm0=_m00*c+_m01*s;mm1=-_m00*s+_m01*c;mm3=_m10*c+_m11*s;mm4=-_m10*s+_m11*c;mm2+=-mm0*rx-mm1*ry;mm5+=-mm3*rx-mm4*ry}if(this.scaleX!=1||this.scaleY!=1){var sx=this.scaleTX*
this.width;var sy=this.scaleTY*this.height;mm2+=mm0*sx+mm1*sy;mm5+=mm3*sx+mm4*sy;mm0=mm0*this.scaleX;mm1=mm1*this.scaleY;mm3=mm3*this.scaleX;mm4=mm4*this.scaleY;mm2+=-mm0*sx-mm1*sy;mm5+=-mm3*sx-mm4*sy}mm[0]=mm0;mm[1]=mm1;mm[2]=mm2;mm[3]=mm3;mm[4]=mm4;mm[5]=mm5}if(this.parent){this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1&&this.parent.isAA;if(this.dirty||this.parent.wdirty){this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix);if(this.isAA){var mmm=this.worldModelViewMatrix.matrix;
mmm[2]+=mm[2];mmm[5]+=mm[5]}else this.worldModelViewMatrix.multiply(this.modelViewMatrix);this.wdirty=true}}else{if(this.dirty)this.wdirty=true;this.worldModelViewMatrix.identity();this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1}},setScreenBounds:function(){var AABB=this.AABB;var vv=this.viewVertices;if(this.isAA){var m=this.worldModelViewMatrix.matrix;var x=m[2];var y=m[5];var w=this.width;var h=this.height;AABB.x=x;AABB.y=y;AABB.x1=x+w;AABB.y1=y+h;AABB.width=w;AABB.height=h;if(CAAT.GLRENDER){var vvv;
vvv=vv[0];vvv.x=x;vvv.y=y;vvv=vv[1];vvv.x=x+w;vvv.y=y;vvv=vv[2];vvv.x=x+w;vvv.y=y+h;vvv=vv[3];vvv.x=x;vvv.y=y+h}return this}var vvv;vvv=vv[0];vvv.x=0;vvv.y=0;vvv=vv[1];vvv.x=this.width;vvv.y=0;vvv=vv[2];vvv.x=this.width;vvv.y=this.height;vvv=vv[3];vvv.x=0;vvv.y=this.height;this.modelToView(this.viewVertices);var xmin=Number.MAX_VALUE,xmax=-Number.MAX_VALUE;var ymin=Number.MAX_VALUE,ymax=-Number.MAX_VALUE;vvv=vv[0];if(vvv.x<xmin)xmin=vvv.x;if(vvv.x>xmax)xmax=vvv.x;if(vvv.y<ymin)ymin=vvv.y;if(vvv.y>
ymax)ymax=vvv.y;var vvv=vv[1];if(vvv.x<xmin)xmin=vvv.x;if(vvv.x>xmax)xmax=vvv.x;if(vvv.y<ymin)ymin=vvv.y;if(vvv.y>ymax)ymax=vvv.y;var vvv=vv[2];if(vvv.x<xmin)xmin=vvv.x;if(vvv.x>xmax)xmax=vvv.x;if(vvv.y<ymin)ymin=vvv.y;if(vvv.y>ymax)ymax=vvv.y;var vvv=vv[3];if(vvv.x<xmin)xmin=vvv.x;if(vvv.x>xmax)xmax=vvv.x;if(vvv.y<ymin)ymin=vvv.y;if(vvv.y>ymax)ymax=vvv.y;AABB.x=xmin;AABB.y=ymin;AABB.x1=xmax;AABB.y1=ymax;AABB.width=xmax-xmin;AABB.height=ymax-ymin;return this},paintActor:function(director,time){if(!this.visible)return true;
var ctx=director.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;ctx.globalAlpha=this.frameAlpha;director.modelViewMatrix.transformRenderingContextSet(ctx);this.worldModelViewMatrix.transformRenderingContext(ctx);if(this.clip){ctx.beginPath();if(!this.clipPath)ctx.rect(0,0,this.width,this.height);else this.clipPath.applyAsPath(director);ctx.clip()}this.paint(director,time);return true},__paintActor:function(director,time){if(!this.visible)return true;var ctx=director.ctx;this.frameAlpha=
this.alpha;var m=this.worldModelViewMatrix.matrix;ctx.setTransform(m[0],m[3],m[1],m[4],m[2],m[5],this.frameAlpha);this.paint(director,time);return true},paintActorGL:function(director,time){this.frameAlpha=this.parent.frameAlpha*this.alpha;if(!this.glEnabled||!this.visible)return;if(this.glNeedsFlush(director)){director.glFlush();this.glSetShader(director);if(!this.__uv)this.__uv=new Float32Array(8);if(!this.__vv)this.__vv=new Float32Array(12);this.setGLCoords(this.__vv,0);this.setUV(this.__uv,0);
director.glRender(this.__vv,12,this.__uv);return}var glCoords=director.coords;var glCoordsIndex=director.coordsIndex;this.setGLCoords(glCoords,glCoordsIndex);director.coordsIndex=glCoordsIndex+12;this.setUV(director.uv,director.uvIndex);director.uvIndex+=8},setGLCoords:function(glCoords,glCoordsIndex){var vv=this.viewVertices;glCoords[glCoordsIndex++]=vv[0].x;glCoords[glCoordsIndex++]=vv[0].y;glCoords[glCoordsIndex++]=0;glCoords[glCoordsIndex++]=vv[1].x;glCoords[glCoordsIndex++]=vv[1].y;glCoords[glCoordsIndex++]=
0;glCoords[glCoordsIndex++]=vv[2].x;glCoords[glCoordsIndex++]=vv[2].y;glCoords[glCoordsIndex++]=0;glCoords[glCoordsIndex++]=vv[3].x;glCoords[glCoordsIndex++]=vv[3].y;glCoords[glCoordsIndex++]=0},setUV:function(uvBuffer,uvIndex){this.backgroundImage.setUV(uvBuffer,uvIndex)},glNeedsFlush:function(director){if(this.getTextureGLPage()!==director.currentTexturePage)return true;if(this.frameAlpha!==director.currentOpacity)return true;return false},glSetShader:function(director){var tp=this.getTextureGLPage();
if(tp!==director.currentTexturePage)director.setGLTexturePage(tp);if(this.frameAlpha!==director.currentOpacity)director.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(director,time){return this},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this},setClip:function(enable,clipPath){this.clip=enable;this.clipPath=clipPath;return this},cacheAsBitmap:function(time,strategy){time=time||0;var canvas=document.createElement("canvas");canvas.width=
this.width;canvas.height=this.height;var ctx=canvas.getContext("2d");var director={ctx:ctx,crc:ctx,modelViewMatrix:new CAAT.Matrix};this.paintActor(director,time);this.setBackgroundImage(canvas);this.cached=strategy?strategy:CAAT.Actor.CACHE_SIMPLE;return this},setAsButton:function(buttonImage,iNormal,iOver,iPress,iDisabled,fn){var me=this;this.setBackgroundImage(buttonImage,true);this.iNormal=iNormal||0;this.iOver=iOver||iNormal;this.iPress=iPress||iNormal;this.iDisabled=iDisabled||iNormal;this.fnOnClick=
fn;this.enabled=true;this.setSpriteIndex(iNormal);this.setEnabled=function(enabled){this.enabled=enabled;this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled);return this};this.actionPerformed=function(event){if(this.enabled&&null!==this.fnOnClick)this.fnOnClick(this)};this.mouseEnter=function(mouseEvent){if(!this.enabled)return;if(this.dragging)this.setSpriteIndex(this.iPress);else this.setSpriteIndex(this.iOver);CAAT.setCursor("pointer")};this.mouseExit=function(mouseEvent){if(!this.enabled)return;
this.setSpriteIndex(this.iNormal);CAAT.setCursor("default")};this.mouseDown=function(mouseEvent){if(!this.enabled)return;this.setSpriteIndex(this.iPress)};this.mouseUp=function(mouseEvent){if(!this.enabled)return;this.setSpriteIndex(this.iNormal);this.dragging=false};this.mouseClick=function(mouseEvent){};this.mouseDrag=function(mouseEvent){if(!this.enabled)return;this.dragging=true};this.setButtonImageIndex=function(_normal,_over,_press,_disabled){this.iNormal=_normal;this.iOver=_over;this.iPress=
_press;this.iDisabled=_disabled;this.setSpriteIndex(this.iNormal);return this};return this}};if(CAAT.NO_PERF)CAAT.Actor.prototype.paintActor=CAAT.Actor.prototype.__paintActor})();
(function(){var __CD=2;CAAT.ActorContainer=function(hint){CAAT.ActorContainer.superclass.constructor.call(this);this.childrenList=[];this.pendingChildrenList=[];if(typeof hint!=="undefined"){this.addHint=hint;this.boundingBox=new CAAT.Rectangle}return this};CAAT.ActorContainer.AddHint={CONFORM:1};CAAT.ActorContainer.prototype={childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Rectangle,drawScreenBoundingBox:function(director,time){if(!this.inFrame)return;
var cl=this.childrenList;for(var i=0;i<cl.length;i++)cl[i].drawScreenBoundingBox(director,time);CAAT.ActorContainer.superclass.drawScreenBoundingBox.call(this,director,time)},emptyChildren:function(){this.childrenList=[];return this},paintActor:function(director,time){if(!this.visible)return true;var ctx=director.ctx;ctx.save();CAAT.ActorContainer.superclass.paintActor.call(this,director,time);if(this.cached===__CD)return;if(!this.isGlobalAlpha)this.frameAlpha=this.parent?this.parent.frameAlpha:1;
for(var actor=this.activeChildren;actor;actor=actor.__next)if(actor.visible)actor.paintActor(director,time);ctx.restore();return true},__paintActor:function(director,time){if(!this.visible)return true;var ctx=director.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var m=this.worldModelViewMatrix.matrix;ctx.setTransform(m[0],m[3],m[1],m[4],m[2],m[5],this.frameAlpha);this.paint(director,time);if(!this.isGlobalAlpha)this.frameAlpha=this.parent?this.parent.frameAlpha:1;for(var actor=
this.activeChildren;actor;actor=actor.__next)actor.paintActor(director,time);return true},paintActorGL:function(director,time){var i,c;if(!this.visible)return true;CAAT.ActorContainer.superclass.paintActorGL.call(this,director,time);if(!this.isGlobalAlpha)this.frameAlpha=this.parent.frameAlpha;for(c=this.activeChildren;c;c=c.__next)c.paintActorGL(director,time)},animate:function(director,time){this.activeChildren=null;var last=null;if(false===CAAT.ActorContainer.superclass.animate.call(this,director,
time))return false;if(this.cached===__CD)return true;var i,l;var pcl=this.pendingChildrenList;for(i=0;i<pcl.length;i++){var child=pcl[i];this.addChild(child)}this.pendingChildrenList=[];var markDelete=[];var cl=this.childrenList;this.size_active=1;this.size_total=1;for(i=0;i<cl.length;i++){var actor=cl[i];actor.time=time;this.size_total+=actor.size_total;if(actor.animate(director,time)){if(!this.activeChildren){this.activeChildren=actor;actor.__next=null;last=actor}else{actor.__next=null;last.__next=
actor;last=actor}this.size_active+=actor.size_active}else if(actor.expired&&actor.discardable)markDelete.push(actor)}for(i=0,l=markDelete.length;i<l;i++){var md=markDelete[i];md.destroy(time);if(director.dirtyRectsEnabled)director.addDirtyRect(md.AABB)}return true},endAnimate:function(director,time){},addChildImmediately:function(child){return this.addChild(child)},addChild:function(child){if(child.parent!=null)throw"adding to a container an element with parent.";child.parent=this;this.childrenList.push(child);
child.dirty=true;if(this.addHint===CAAT.ActorContainer.AddHint.CONFORM)this.recalcSize();return this},recalcSize:function(){var bb=this.boundingBox;bb.setEmpty();var cl=this.childrenList;var ac;for(var i=0;i<cl.length;i++){ac=cl[i];this.runion.setBounds(ac.x<0?0:ac.x,ac.y<0?0:ac.y,ac.width,ac.height);bb.unionRectangle(this.runion)}this.setSize(bb.x1,bb.y1);return this},addChildDelayed:function(child){this.pendingChildrenList.push(child);return this},addChildAt:function(child,index){if(index<=0){child.parent=
this;child.dirty=true;this.childrenList.splice(0,0,child);return this}else if(index>=this.childrenList.length)index=this.childrenList.length;child.parent=this;child.dirty=true;this.childrenList.splice(index,0,child);return this},findActorById:function(id){var cl=this.childrenList;for(var i=0,l=cl.length;i<l;i++)if(cl[i].id===id)return cl[i];return null},findChild:function(child){var cl=this.childrenList;var i=0;var len=cl.length;for(i=0;i<len;i++)if(cl[i]===child)return i;return-1},removeChild:function(child){var pos=
this.findChild(child);var cl=this.childrenList;if(-1!==pos){cl[pos].setParent(null);cl.splice(pos,1)}return this},removeFirstChild:function(){var first=this.childrenList.shift();first.parent=null;return first},findActorAtPosition:function(point){if(null===CAAT.ActorContainer.superclass.findActorAtPosition.call(this,point))return null;var cl=this.childrenList;for(var i=cl.length-1;i>=0;i--){var child=this.childrenList[i];var np=new CAAT.Point(point.x,point.y,0);var contained=child.findActorAtPosition(np);
if(null!==contained)return contained}return this},destroy:function(){var cl=this.childrenList;for(var i=cl.length-1;i>=0;i--)cl[i].destroy();CAAT.ActorContainer.superclass.destroy.call(this);return this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(iPosition){return this.childrenList[iPosition]},setZOrder:function(actor,index){var actorPos=this.findChild(actor);if(-1!==actorPos){var cl=this.childrenList;
if(index===actorPos)return;if(index>=cl.length){cl.splice(actorPos,1);cl.push(actor)}else{var nActor=cl.splice(actorPos,1);if(index<0)index=0;else if(index>cl.length)index=cl.length;cl.splice(index,0,nActor[0])}}}};if(CAAT.NO_PERF)CAAT.ActorContainer.prototype.paintActor=CAAT.ActorContainer.prototype.__paintActor;extend(CAAT.ActorContainer,CAAT.Actor,null)})();
(function(){CAAT.TextActor=function(){CAAT.TextActor.superclass.constructor.call(this);this.font="10px sans-serif";this.textAlign="left";this.textBaseline="top";this.outlineColor="black";this.clip=false;return this};CAAT.TextActor.TRAVERSE_PATH_FORWARD=1;CAAT.TextActor.TRAVERSE_PATH_BACKWARD=-1;CAAT.TextActor.prototype={font:null,textAlign:null,textBaseline:null,fill:true,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:false,outlineColor:null,path:null,pathInterpolator:null,pathDuration:1E4,
sign:1,setFill:function(fill){this.fill=fill;return this},setTextFillStyle:function(style){this.textFillStyle=style;return this},setOutline:function(outline){this.outline=outline;return this},setPathTraverseDirection:function(direction){this.sign=direction;return this},setOutlineColor:function(color){this.outlineColor=color;return this},setText:function(sText){this.text=sText;if(null===this.text||this.text==="")this.width=this.height=0;this.calcTextSize(CAAT.director[0]);return this},setTextAlign:function(align){this.textAlign=
align;return this},setAlign:function(align){return this.setTextAlign(align)},setTextBaseline:function(baseline){this.textBaseline=baseline;return this},setBaseline:function(baseline){return this.setTextBaseline(baseline)},setFont:function(font){if(!font)font="10px sans-serif";this.font=font;this.calcTextSize(CAAT.director[0]);return this},calcTextSize:function(director){if(typeof this.text==="undefined"||null===this.text||""===this.text){this.textWidth=0;this.textHeight=0;return this}if(director.glEnabled)return this;
if(this.font instanceof CAAT.SpriteImage){this.textWidth=this.font.stringWidth(this.text);this.textHeight=this.font.stringHeight();this.width=this.textWidth;this.height=this.textHeight;return this}var ctx=director.ctx;ctx.save();ctx.font=this.font;this.textWidth=ctx.measureText(this.text).width;if(this.width===0)this.width=this.textWidth;try{var pos=this.font.indexOf("px");var s=this.font.substring(0,pos);this.textHeight=parseInt(s,10);this.textHeight+=this.textHeight/4>>0}catch(e){this.textHeight=
20}if(this.height===0)this.height=this.textHeight;ctx.restore();return this},paint:function(director,time){CAAT.TextActor.superclass.paint.call(this,director,time);if(this.cached)return;if(null===this.text)return;if(this.textWidth===0||this.textHeight===0)this.calcTextSize(director);var ctx=director.ctx;if(this.font instanceof CAAT.SpriteImage)return this.drawSpriteText(director,time);if(null!==this.font)ctx.font=this.font;if(null!==this.textAlign)ctx.textAlign=this.textAlign;if(null!==this.textBaseline)ctx.textBaseline=
this.textBaseline;if(this.fill&&null!==this.textFillStyle)ctx.fillStyle=this.textFillStyle;if(this.outline&&null!==this.outlineColor)ctx.strokeStyle=this.outlineColor;if(null===this.path){var tx=0;if(this.textAlign==="center")tx=this.width/2|0;else if(this.textAlign==="right")tx=this.width;if(this.fill){ctx.fillText(this.text,tx,0);if(this.outline){ctx.beginPath();ctx.strokeText(this.text,tx,0)}}else{if(null!==this.outlineColor)ctx.strokeStyle=this.outlineColor;ctx.beginPath();ctx.strokeText(this.text,
tx,0)}}else this.drawOnPath(director,time)},drawOnPath:function(director,time){var ctx=director.ctx;var textWidth=this.sign*this.pathInterpolator.getPosition(time%this.pathDuration/this.pathDuration).y*this.path.getLength();var p0=new CAAT.Point(0,0,0);var p1=new CAAT.Point(0,0,0);for(var i=0;i<this.text.length;i++){var caracter=this.text[i].toString();var charWidth=ctx.measureText(caracter).width;var currentCurveLength=charWidth/2+textWidth;p0=this.path.getPositionFromLength(currentCurveLength).clone();
p1=this.path.getPositionFromLength(currentCurveLength-0.1).clone();var angle=Math.atan2(p0.y-p1.y,p0.x-p1.x);ctx.save();ctx.translate(0.5+p0.x|0,0.5+p0.y|0);ctx.rotate(angle);if(this.fill)ctx.fillText(caracter,0,0);if(this.outline)ctx.strokeText(caracter,0,0);ctx.restore();textWidth+=charWidth}},drawSpriteText:function(director,time){if(null===this.path)this.font.drawString(director.ctx,this.text,0,0);else this.drawSpriteTextOnPath(director,time)},drawSpriteTextOnPath:function(director,time){var context=
director.ctx;var textWidth=this.sign*this.pathInterpolator.getPosition(time%this.pathDuration/this.pathDuration).y*this.path.getLength();var p0=new CAAT.Point(0,0,0);var p1=new CAAT.Point(0,0,0);for(var i=0;i<this.text.length;i++){var character=this.text[i].toString();var charWidth=this.font.stringWidth(character);var pathLength=this.path.getLength();var currentCurveLength=charWidth/2+textWidth;p0=this.path.getPositionFromLength(currentCurveLength).clone();p1=this.path.getPositionFromLength(currentCurveLength-
0.1).clone();var angle=Math.atan2(p0.y-p1.y,p0.x-p1.x);context.save();context.translate(p0.x|0,p0.y|0);context.rotate(angle);var y=this.textBaseline==="bottom"?0-this.font.height:0;this.font.drawString(context,character,0,y);context.restore();textWidth+=charWidth}},setPath:function(path,interpolator,duration){this.path=path;this.pathInterpolator=interpolator||(new CAAT.Interpolator).createLinearInterpolator();this.pathDuration=duration||1E4;this.mouseEnabled=false;return this}};extend(CAAT.TextActor,
CAAT.Actor,null)})();
(function(){CAAT.ShapeActor=function(){CAAT.ShapeActor.superclass.constructor.call(this);this.compositeOp="source-over";this.setShape(this.SHAPE_CIRCLE);return this};CAAT.ShapeActor.prototype={shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1,setLineWidth:function(l){this.lineWidth=l;return this},setLineCap:function(lc){this.lineCap=lc;return this},setLineJoin:function(lj){this.lineJoin=lj;return this},setMiterLimit:function(ml){this.miterLimit=ml;
return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(iShape){this.shape=iShape;this.paint=this.shape===this.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle;return this},setCompositeOp:function(compositeOp){this.compositeOp=compositeOp;return this},paint:function(director,time){},paintCircle:function(director,time){var ctx=director.crc;
ctx.lineWidth=this.lineWidth;ctx.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle){ctx.fillStyle=this.fillStyle;ctx.beginPath();ctx.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2,0,2*Math.PI,false);ctx.fill()}if(null!==this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.beginPath();ctx.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2,0,2*Math.PI,false);ctx.stroke()}},paintRectangle:function(director,time){var ctx=director.crc;ctx.lineWidth=
this.lineWidth;if(this.lineCap)ctx.lineCap=this.lineCap;if(this.lineJoin)ctx.lineJoin=this.lineJoin;if(this.miterLimit)ctx.miterLimit=this.miterLimit;ctx.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle){ctx.fillStyle=this.fillStyle;ctx.beginPath();ctx.fillRect(0,0,this.width,this.height);ctx.fill()}if(null!==this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.beginPath();ctx.strokeRect(0,0,this.width,this.height);ctx.stroke()}}};extend(CAAT.ShapeActor,CAAT.ActorContainer,null)})();
(function(){CAAT.StarActor=function(){CAAT.StarActor.superclass.constructor.call(this);this.compositeOp="source-over";return this};CAAT.StarActor.prototype={nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(l){this.lineWidth=l;return this},setLineCap:function(lc){this.lineCap=lc;return this},setLineJoin:function(lj){this.lineJoin=lj;return this},setMiterLimit:function(ml){this.miterLimit=ml;return this},getLineCap:function(){return this.lineCap},
getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(filled){return this},setOutlined:function(outlined){return this},setCompositeOp:function(compositeOp){this.compositeOp=compositeOp;return this},setInitialAngle:function(angle){this.initialAngle=angle;return this},initialize:function(nPeaks,maxRadius,minRadius){this.setSize(2*maxRadius,2*maxRadius);this.nPeaks=nPeaks;this.maxRadius=maxRadius;
this.minRadius=minRadius;return this},paint:function(director,timer){var ctx=director.ctx;var centerX=this.width/2;var centerY=this.height/2;var r1=this.maxRadius;var r2=this.minRadius;var ix=centerX+r1*Math.cos(this.initialAngle);var iy=centerY+r1*Math.sin(this.initialAngle);ctx.lineWidth=this.lineWidth;if(this.lineCap)ctx.lineCap=this.lineCap;if(this.lineJoin)ctx.lineJoin=this.lineJoin;if(this.miterLimit)ctx.miterLimit=this.miterLimit;ctx.globalCompositeOperation=this.compositeOp;ctx.beginPath();
ctx.moveTo(ix,iy);for(var i=1;i<this.nPeaks*2;i++){var angleStar=Math.PI/this.nPeaks*i+this.initialAngle;var rr=i%2===0?r1:r2;var x=centerX+rr*Math.cos(angleStar);var y=centerY+rr*Math.sin(angleStar);ctx.lineTo(x,y)}ctx.lineTo(centerX+r1*Math.cos(this.initialAngle),centerY+r1*Math.sin(this.initialAngle));ctx.closePath();if(this.fillStyle){ctx.fillStyle=this.fillStyle;ctx.fill()}if(this.strokeStyle){ctx.strokeStyle=this.strokeStyle;ctx.stroke()}}};extend(CAAT.StarActor,CAAT.ActorContainer,null)})();
(function(){CAAT.IMActor=function(){CAAT.IMActor.superclass.constructor.call(this);return this};CAAT.IMActor.prototype={imageProcessor:null,changeTime:100,lastApplicationTime:-1,setImageProcessor:function(im){this.imageProcessor=im;return this},setImageProcessingTime:function(time){this.changeTime=time;return this},paint:function(director,time){if(time-this.lastApplicationTime>this.changeTime){this.imageProcessor.apply(director,time);this.lastApplicationTime=time}var ctx=director.ctx;this.imageProcessor.paint(director,
time)}};extend(CAAT.IMActor,CAAT.ActorContainer,null)})();
(function(){CAAT.AudioManager=function(){this.browserInfo=new CAAT.BrowserDetect;return this};CAAT.AudioManager.prototype={browserInfo:null,musicEnabled:true,fxEnabled:true,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{"mp3":"audio/mpeg;","ogg":'audio/ogg; codecs="vorbis"',"wav":'audio/wav; codecs="1"',"mp4":'audio/mp4; codecs="mp4a.40.2"'},initialize:function(numChannels){this.audioCache=[];this.channels=[];this.workingChannels=[];for(var i=0;i<numChannels;i++){var channel=
document.createElement("audio");if(null!==channel){channel.finished=-1;this.channels.push(channel);var me=this;channel.addEventListener("ended",function(audioEvent){var target=audioEvent.target;var i;for(i=0;i<me.workingChannels.length;i++)if(me.workingChannels[i]===target){me.workingChannels.splice(i,1);break}if(target.caat_callback)target.caat_callback(target.caat_id);me.channels.push(target)},false)}}return this},addAudioFromURL:function(id,url,endplaying_callback){var extension=null;var audio=
document.createElement("audio");if(null!==audio){if(!audio.canPlayType)return false;extension=url.substr(url.lastIndexOf(".")+1);var canplay=audio.canPlayType(this.audioTypes[extension]);if(canplay!==""&&canplay!=="no"){audio.src=url;audio.preload="auto";audio.load();if(endplaying_callback){audio.caat_callback=endplaying_callback;audio.caat_id=id}this.audioCache.push({id:id,audio:audio});return true}}return false},addAudioFromDomNode:function(id,audio,endplaying_callback){var extension=audio.src.substr(audio.src.lastIndexOf(".")+
1);if(audio.canPlayType(this.audioTypes[extension])){if(endplaying_callback){audio.caat_callback=endplaying_callback;audio.caat_id=id}this.audioCache.push({id:id,audio:audio});return true}return false},addAudioElement:function(id,element,endplaying_callback){if(typeof element==="string")return this.addAudioFromURL(id,element,endplaying_callback);else try{if(element instanceof HTMLAudioElement)return this.addAudioFromDomNode(id,element,endplaying_callback)}catch(e){}return false},addAudio:function(id,
array_of_url_or_domnodes,endplaying_callback){if(array_of_url_or_domnodes instanceof Array)for(var i=0;i<array_of_url_or_domnodes.length;i++){if(this.addAudioElement(id,array_of_url_or_domnodes[i],endplaying_callback))break}else this.addAudioElement(id,array_of_url_or_domnodes,endplaying_callback);return this},getAudio:function(aId){for(var i=0;i<this.audioCache.length;i++)if(this.audioCache[i].id===aId)return this.audioCache[i].audio;return null},setVolume:function(id,volume){var audio=this.getAudio(id);
if(null!=audio)audio.volume=volume;return this},play:function(id){if(!this.fxEnabled)return this;var audio=this.getAudio(id);if(null!==audio&&this.channels.length>0){var channel=this.channels.shift();channel.src=audio.src;channel.load();channel.volume=audio.volume;channel.play();this.workingChannels.push(channel)}return this},loop:function(id){if(!this.musicEnabled)return this;var audio_in_cache=this.getAudio(id);if(null!==audio_in_cache){var audio=document.createElement("audio");if(null!==audio){audio.src=
audio_in_cache.src;audio.preload="auto";if(this.browserInfo.browser==="Firefox")audio.addEventListener("ended",function(audioEvent){var target=audioEvent.target;target.currentTime=0},false);else audio.loop=true;audio.load();audio.play();this.loopingChannels.push(audio);return audio}}return null},endSound:function(){var i;for(i=0;i<this.workingChannels.length;i++){this.workingChannels[i].pause();this.channels.push(this.workingChannels[i])}for(i=0;i<this.loopingChannels.length;i++)this.loopingChannels[i].pause();
return this},setSoundEffectsEnabled:function(enable){this.fxEnabled=enable;return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(enable){this.musicEnabled=enable;for(var i=0;i<this.loopingChannels.length;i++)if(enable)this.loopingChannels[i].play();else this.loopingChannels[i].pause();return this},isMusicEnabled:function(){return this.musicEnabled}}})();
(function(){CAAT.Dock=function(){CAAT.Dock.superclass.constructor.call(this);return this};CAAT.Dock.prototype={scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3,initialize:function(scene){this.scene=scene;return this},setApplicationRange:function(range){this.range=range;return this},setLayoutOp:function(lo){this.layoutOp=lo;return this},setSizes:function(min,max){this.minSize=min;this.maxSize=max;for(var i=0;i<this.childrenList.length;i++){this.childrenList[i].width=
min;this.childrenList[i].height=min}return this},layout:function(){var i,actor;if(this.layoutOp===this.OP_LAYOUT_BOTTOM||this.layoutOp===this.OP_LAYOUT_TOP){var currentWidth=0,currentX=0;for(i=0;i<this.getNumChildren();i++)currentWidth+=this.getChildAt(i).width;currentX=(this.width-currentWidth)/2;for(i=0;i<this.getNumChildren();i++){actor=this.getChildAt(i);actor.x=currentX;currentX+=actor.width;if(this.layoutOp===this.OP_LAYOUT_BOTTOM)actor.y=this.maxSize-actor.height;else actor.y=0}}else{var currentHeight=
0,currentY=0;for(i=0;i<this.getNumChildren();i++)currentHeight+=this.getChildAt(i).height;currentY=(this.height-currentHeight)/2;for(i=0;i<this.getNumChildren();i++){actor=this.getChildAt(i);actor.y=currentY;currentY+=actor.height;if(this.layoutOp===this.OP_LAYOUT_LEFT)actor.x=0;else actor.x=this.width-actor.width}}},mouseMove:function(mouseEvent){this.actorNotPointed()},mouseExit:function(mouseEvent){this.actorNotPointed()},actorNotPointed:function(){var i;var me=this;for(i=0;i<this.getNumChildren();i++){var actor=
this.getChildAt(i);actor.emptyBehaviorList();actor.addBehavior((new CAAT.GenericBehavior).setValues(actor.width,this.minSize,actor,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.GenericBehavior).setValues(actor.height,this.minSize,actor,"height").setFrameTime(this.scene.time,250));if(i===this.getNumChildren()-1)actor.behaviorList[0].addListener({behaviorApplied:function(behavior,time,normalizedTime,targetActor,value){targetActor.parent.layout()},behaviorExpired:function(behavior,
time,targetActor){for(i=0;i<me.getNumChildren();i++){actor=me.getChildAt(i);actor.width=me.minSize;actor.height=me.minSize}targetActor.parent.layout()}})}},actorPointed:function(x,y,pointedActor){var index=this.findChild(pointedActor);var across=0;if(this.layoutOp===this.OP_LAYOUT_BOTTOM||this.layoutOp===this.OP_LAYOUT_TOP)across=x/pointedActor.width;else across=y/pointedActor.height;var i;for(i=0;i<this.childrenList.length;i++){var actor=this.childrenList[i];actor.emptyBehaviorList();var wwidth=
0;if(i<index-this.range||i>index+this.range)wwidth=this.minSize;else if(i===index)wwidth=this.maxSize;else if(i<index)wwidth=this.minSize+(this.maxSize-this.minSize)*(Math.cos((i-index-across+1)/this.range*Math.PI)+1)/2;else wwidth=this.minSize+(this.maxSize-this.minSize)*(Math.cos((i-index-across)/this.range*Math.PI)+1)/2;actor.height=wwidth;actor.width=wwidth}this.layout()},actorMouseExit:function(mouseEvent){if(null!==this.ttask)this.ttask.cancel();var me=this;this.ttask=this.scene.createTimer(this.scene.time,
100,function timeout(sceneTime,time,timerTask){me.actorNotPointed()},null,null)},actorMouseEnter:function(mouseEvent){if(null!==this.ttask){this.ttask.cancel();this.ttask=null}},addChild:function(actor){var me=this;actor.__Dock_mouseEnter=actor.mouseEnter;actor.__Dock_mouseExit=actor.mouseExit;actor.__Dock_mouseMove=actor.mouseMove;actor.mouseEnter=function(mouseEvent){me.actorMouseEnter(mouseEvent);this.__Dock_mouseEnter(mouseEvent)};actor.mouseExit=function(mouseEvent){me.actorMouseExit(mouseEvent);
this.__Dock_mouseExit(mouseEvent)};actor.mouseMove=function(mouseEvent){me.actorPointed(mouseEvent.point.x,mouseEvent.point.y,mouseEvent.source);this.__Dock_mouseMove(mouseEvent)};actor.width=this.minSize;actor.height=this.minSize;return CAAT.Dock.superclass.addChild.call(this,actor)}};extend(CAAT.Dock,CAAT.ActorContainer,null)})();
(function(){CAAT.Director=function(){CAAT.Director.superclass.constructor.call(this);this.browserInfo=new CAAT.BrowserDetect;this.audioManager=(new CAAT.AudioManager).initialize(8);this.scenes=[];this.mousePoint=new CAAT.Point(0,0,0);this.prevMousePoint=new CAAT.Point(0,0,0);this.screenMousePoint=new CAAT.Point(0,0,0);this.isMouseDown=false;this.lastSelectedActor=null;this.dragging=false;this.cDirtyRects=[];this.dirtyRects=[];for(var i=0;i<64;i++)this.dirtyRects.push(new CAAT.Rectangle);this.dirtyRectsIndex=
0;return this};CAAT.Director.CLEAR_DIRTY_RECTS=1;CAAT.Director.CLEAR_ALL=true;CAAT.Director.CLEAR_NONE=false;CAAT.Director.prototype={debug:false,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:false,lastSelectedActor:null,dragging:false,scenes:null,currentScene:null,canvas:null,crc:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:true,transitionScene:null,browserInfo:null,gl:null,glEnabled:false,glTextureManager:null,
glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:false,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:false,nDirtyRects:0,stopped:false,
checkDebug:function(){if(CAAT.DEBUG){var dd=(new CAAT.Debug).initialize(this.width,60);this.debugInfo=dd.debugInfo.bind(dd)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(w,h){switch(this.resize){case this.RESIZE_WIDTH:this.setBounds(0,0,w,this.height);break;case this.RESIZE_HEIGHT:this.setBounds(0,0,this.width,h);break;case this.RESIZE_BOTH:this.setBounds(0,0,w,h);break;case this.RESIZE_PROPORTIONAL:this.setScaleProportional(w,h);break}if(this.glEnabled)this.glReset();
if(this.onResizeCallback)this.onResizeCallback(this,w,h)},setScaleProportional:function(w,h){var factor=Math.min(w/this.referenceWidth,h/this.referenceHeight);this.setScaleAnchored(factor,factor,0,0);this.canvas.width=this.referenceWidth*factor;this.canvas.height=this.referenceHeight*factor;this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.crc=this.ctx;if(this.glEnabled)this.glReset()},enableResizeEvents:function(mode,onResizeCallback){if(mode===this.RESIZE_BOTH||mode===
this.RESIZE_WIDTH||mode===this.RESIZE_HEIGHT||mode===this.RESIZE_PROPORTIONAL){this.referenceWidth=this.width;this.referenceHeight=this.height;this.resize=mode;CAAT.registerResizeListener(this);this.onResizeCallback=onResizeCallback;this.windowResized(window.innerWidth,window.innerHeight)}else{CAAT.unregisterResizeListener(this);this.onResizeCallback=null}},setBounds:function(x,y,w,h){CAAT.Director.superclass.setBounds.call(this,x,y,w,h);this.canvas.width=w;this.canvas.height=h;this.ctx=this.canvas.getContext(this.glEnabled?
"experimental-webgl":"2d");this.crc=this.ctx;for(var i=0;i<this.scenes.length;i++)this.scenes[i].setBounds(0,0,w,h);if(this.glEnabled)this.glReset();return this},initialize:function(width,height,canvas,proxy){if(!canvas){canvas=document.createElement("canvas");document.body.appendChild(canvas)}this.canvas=canvas;if(typeof proxy==="undefined")proxy=canvas;this.setBounds(0,0,width,height);this.create();this.enableEvents(proxy);this.timeline=(new Date).getTime();this.transitionScene=(new CAAT.Scene).setBounds(0,
0,width,height);var transitionCanvas=document.createElement("canvas");transitionCanvas.width=width;transitionCanvas.height=height;var transitionImageActor=(new CAAT.Actor).setBackgroundImage(transitionCanvas);this.transitionScene.ctx=transitionCanvas.getContext("2d");this.transitionScene.addChildImmediately(transitionImageActor);this.transitionScene.setEaseListener(this);this.checkDebug();return this},glReset:function(){this.pMatrix=makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1);this.gl.viewport(0,
0,this.canvas.width,this.canvas.height);this.glColorProgram.setMatrixUniform(this.pMatrix);this.glTextureProgram.setMatrixUniform(this.pMatrix);this.gl.viewportWidth=this.canvas.width;this.gl.viewportHeight=this.canvas.height},initializeGL:function(width,height,canvas,proxy){if(!canvas){canvas=document.createElement("canvas");document.body.appendChild(canvas)}canvas.width=width;canvas.height=height;if(typeof proxy==="undefined")proxy=canvas;this.referenceWidth=width;this.referenceHeight=height;var i;
try{this.gl=canvas.getContext("experimental-webgl");this.gl.viewportWidth=width;this.gl.viewportHeight=height;CAAT.GLRENDER=true}catch(e){}if(this.gl){this.canvas=canvas;this.create();this.setBounds(0,0,width,height);this.crc=this.ctx;this.enableEvents(canvas);this.timeline=(new Date).getTime();this.glColorProgram=(new CAAT.ColorProgram(this.gl)).create().initialize();this.glTextureProgram=(new CAAT.TextureProgram(this.gl)).create().initialize();this.glTextureProgram.useProgram();this.glReset();var maxTris=
512;this.coords=new Float32Array(maxTris*12);this.uv=new Float32Array(maxTris*8);this.gl.clearColor(0,0,0,255);if(this.front_to_back){this.gl.clearDepth(1);this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LESS)}else this.gl.disable(this.gl.DEPTH_TEST);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this.glEnabled=true;this.checkDebug()}else return this.initialize(width,height,canvas);return this},createScene:function(){var scene=(new CAAT.Scene).create();
this.addScene(scene);return scene},setImagesCache:function(imagesCache,tpW,tpH){var i;if(null!==this.glTextureManager){this.glTextureManager.deletePages();this.glTextureManager=null}if(this.imagesCache){var ids=[];for(i=0;i<this.imagesCache.length;i++)ids.push(this.imagesCache[i].id);for(i=0;i<ids.length;i++)delete this.imagesCache[ids[i]]}this.imagesCache=imagesCache;if(imagesCache)for(i=0;i<imagesCache.length;i++)this.imagesCache[imagesCache[i].id]=imagesCache[i].image;this.tpW=tpW||2048;this.tpH=
tpH||2048;this.updateGLPages()},updateGLPages:function(){if(this.glEnabled){this.glTextureManager=new CAAT.GLTexturePageManager;this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache);this.currentTexturePage=this.glTextureManager.pages[0];this.glTextureProgram.setTexture(this.currentTexturePage.texture)}},setGLTexturePage:function(tp){this.currentTexturePage=tp;this.glTextureProgram.setTexture(tp.texture);return this},addImage:function(id,image,noUpdateGL){if(this.getImage(id)){for(var i=
0;i<this.imagesCache.length;i++)if(this.imagesCache[i].id===id){this.imagesCache[i].image=image;break}this.imagesCache[id]=image}else{this.imagesCache.push({id:id,image:image});this.imagesCache[id]=image}if(!!!noUpdateGL)this.updateGLPages()},deleteImage:function(id,noUpdateGL){for(var i=0;i<this.imagesCache.length;i++)if(this.imagesCache[i].id===id){delete this.imagesCache[id];this.imagesCache.splice(i,1);break}if(!!!noUpdateGL)this.updateGLPages()},setGLCurrentOpacity:function(opacity){this.currentOpacity=
opacity;this.glTextureProgram.setAlpha(opacity)},glRender:function(vertex,coordsIndex,uv){vertex=vertex||this.coords;uv=uv||this.uv;coordsIndex=coordsIndex||this.coordsIndex;var gl=this.gl;var numTris=coordsIndex/12*2;var numVertices=coordsIndex/3;this.glTextureProgram.updateVertexBuffer(vertex);this.glTextureProgram.updateUVBuffer(uv);gl.drawElements(gl.TRIANGLES,3*numTris,gl.UNSIGNED_SHORT,0)},glFlush:function(){if(this.coordsIndex!==0)this.glRender(this.coords,this.coordsIndex,this.uv);this.coordsIndex=
0;this.uvIndex=0;this.statistics.draws++},findActorAtPosition:function(point){var cl=this.childrenList;for(var i=cl.length-1;i>=0;i--){var child=this.childrenList[i];var np=new CAAT.Point(point.x,point.y,0);var contained=child.findActorAtPosition(np);if(null!==contained)return contained}return this},resetStats:function(){this.statistics.size_total=0;this.statistics.size_active=0;this.statistics.draws=0},render:function(time){this.time+=time;this.animate(this,time);if(CAAT.DEBUG)this.resetStats();
var ne=this.childrenList.length;var i,tt,c;var ctx=this.ctx;if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.coordsIndex=0;this.uvIndex=0;for(i=0;i<ne;i++){c=this.childrenList[i];if(c.isInAnimationFrame(this.time)){tt=c.time-c.start_time;if(c.onRenderStart)c.onRenderStart(tt);c.paintActorGL(this,tt);if(c.onRenderEnd)c.onRenderEnd(tt);if(!c.isPaused())c.time+=time;if(CAAT.DEBUG){this.statistics.size_total+=c.size_total;this.statistics.size_active+=c.size_active}}}this.glFlush()}else{ctx.globalAlpha=
1;ctx.globalCompositeOperation="source-over";ctx.save();if(this.dirtyRectsEnabled){this.modelViewMatrix.transformRenderingContext(ctx);if(!CAAT.DEBUG_DIRTYRECTS){ctx.beginPath();this.nDirtyRects=0;var dr=this.cDirtyRects;for(i=0;i<dr.length;i++){var drr=dr[i];if(!drr.isEmpty()){ctx.rect(drr.x|0,drr.y|0,1+(drr.width|0),1+(drr.height|0));this.nDirtyRects++}}ctx.clip()}else ctx.clearRect(0,0,this.width,this.height)}else if(this.clear===true)ctx.clearRect(0,0,this.width,this.height);for(i=0;i<ne;i++){c=
this.childrenList[i];if(c.isInAnimationFrame(this.time)){tt=c.time-c.start_time;ctx.save();if(c.onRenderStart)c.onRenderStart(tt);if(!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled){if(this.nDirtyRects)c.paintActor(this,tt)}else c.paintActor(this,tt);if(c.onRenderEnd)c.onRenderEnd(tt);ctx.restore();if(CAAT.DEBUGAABB){ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";this.modelViewMatrix.transformRenderingContextSet(ctx);c.drawScreenBoundingBox(this,tt)}if(!c.isPaused())c.time+=time;if(CAAT.DEBUG){this.statistics.size_total+=
c.size_total;this.statistics.size_active+=c.size_active;this.statistics.size_dirtyRects=this.nDirtyRects}}}if(this.nDirtyRects>0&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){ctx.beginPath();this.nDirtyRects=0;var dr=this.cDirtyRects;for(i=0;i<dr.length;i++){var drr=dr[i];if(!drr.isEmpty()){ctx.rect(drr.x|0,drr.y|0,1+(drr.width|0),1+(drr.height|0));this.nDirtyRects++}}ctx.clip();ctx.fillStyle="rgba(160,255,150,.4)";ctx.fillRect(0,0,this.width,this.height)}ctx.restore()}this.frameCounter++},animate:function(director,
time){this.setModelViewMatrix(this);this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.setScreenBounds();this.dirty=false;this.invalid=false;this.dirtyRectsIndex=-1;this.cDirtyRects=[];var cl=this.childrenList;var cli;for(var i=0;i<cl.length;i++){cli=cl[i];var tt=cli.time-cli.start_time;cli.animate(this,tt)}return this},addDirtyRect:function(rectangle){if(rectangle.isEmpty())return;var i,dr,j,drj;var cdr=this.cDirtyRects;for(i=0;i<cdr.length;i++){dr=cdr[i];if(!dr.isEmpty()&&dr.intersects(rectangle)){var intersected=
true;while(intersected){dr.unionRectangle(rectangle);for(j=0;j<cdr.length;j++)if(j!==i){drj=cdr[j];if(!drj.isEmpty()&&drj.intersects(dr)){dr.unionRectangle(drj);drj.setEmpty();break}}if(j==cdr.length)intersected=false}for(j=0;j<cdr.length;j++)if(cdr[j].isEmpty())cdr.splice(j,1);return}}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length)for(i=0;i<32;i++)this.dirtyRects.push(new CAAT.Rectangle);var r=this.dirtyRects[this.dirtyRectsIndex];r.x=rectangle.x;r.y=rectangle.y;r.x1=rectangle.x1;
r.y1=rectangle.y1;r.width=rectangle.width;r.height=rectangle.height;this.cDirtyRects.push(r)},renderToContext:function(ctx,scene){if(scene.isInAnimationFrame(this.time)){ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";ctx.clearRect(0,0,this.width,this.height);ctx.setTransform(1,0,0,0,1,0);var octx=this.ctx;var ocrc=this.crc;this.ctx=this.crc=ctx;ctx.save();var matwmv=this.worldModelViewMatrix;this.worldModelViewMatrix=new CAAT.Matrix;this.wdirty=true;scene.animate(this,scene.time);if(scene.onRenderStart)scene.onRenderStart(scene.time);
scene.paintActor(this,scene.time);if(scene.onRenderEnd)scene.onRenderEnd(scene.time);this.worldModelViewMatrix=matwmv;ctx.restore();this.ctx=octx;this.crc=ocrc}},addScene:function(scene){scene.setBounds(0,0,this.width,this.height);this.scenes.push(scene);scene.setEaseListener(this);if(null===this.currentScene)this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(inSceneIndex,typein,anchorin,outSceneIndex,typeout,anchorout,time,alpha,interpolatorIn,interpolatorOut){if(inSceneIndex===
this.getCurrentSceneIndex())return;var ssin=this.scenes[inSceneIndex];var sout=this.scenes[outSceneIndex];if(!CAAT.__CSS__&&!this.glEnabled){this.worldModelViewMatrix.transformRenderingContext(this.transitionScene.ctx);this.renderToContext(this.transitionScene.ctx,sout);sout=this.transitionScene}ssin.setExpired(false);sout.setExpired(false);ssin.mouseEnabled=false;sout.mouseEnabled=false;ssin.resetTransform();sout.resetTransform();ssin.setLocation(0,0);sout.setLocation(0,0);ssin.alpha=1;sout.alpha=
1;if(typein===CAAT.Scene.prototype.EASE_ROTATION)ssin.easeRotationIn(time,alpha,anchorin,interpolatorIn);else if(typein===CAAT.Scene.prototype.EASE_SCALE)ssin.easeScaleIn(0,time,alpha,anchorin,interpolatorIn);else ssin.easeTranslationIn(time,alpha,anchorin,interpolatorIn);if(typeout===CAAT.Scene.prototype.EASE_ROTATION)sout.easeRotationOut(time,alpha,anchorout,interpolatorOut);else if(typeout===CAAT.Scene.prototype.EASE_SCALE)sout.easeScaleOut(0,time,alpha,anchorout,interpolatorOut);else sout.easeTranslationOut(time,
alpha,anchorout,interpolatorOut);this.childrenList=[];this.addChild(sout);this.addChild(ssin)},easeInOutRandom:function(inIndex,outIndex,time,alpha){var pin=Math.random();var pout=Math.random();var typeIn;var interpolatorIn;if(pin<0.33){typeIn=CAAT.Scene.prototype.EASE_ROTATION;interpolatorIn=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)}else if(pin<0.66){typeIn=CAAT.Scene.prototype.EASE_SCALE;interpolatorIn=(new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.4)}else{typeIn=
CAAT.Scene.prototype.EASE_TRANSLATE;interpolatorIn=(new CAAT.Interpolator).createBounceOutInterpolator()}var typeOut;var interpolatorOut;if(pout<0.33){typeOut=CAAT.Scene.prototype.EASE_ROTATION;interpolatorOut=(new CAAT.Interpolator).createExponentialInOutInterpolator(4)}else if(pout<0.66){typeOut=CAAT.Scene.prototype.EASE_SCALE;interpolatorOut=(new CAAT.Interpolator).createExponentialOutInterpolator(4)}else{typeOut=CAAT.Scene.prototype.EASE_TRANSLATE;interpolatorOut=(new CAAT.Interpolator).createBounceOutInterpolator()}this.easeInOut(inIndex,
typeIn,Math.random()*8.99>>0,outIndex,typeOut,Math.random()*8.99>>0,time,alpha,interpolatorIn,interpolatorOut)},easeIn:function(inSceneIndex,type,time,alpha,anchor,interpolator){var sin=this.scenes[inSceneIndex];if(type===CAAT.Scene.prototype.EASE_ROTATION)sin.easeRotationIn(time,alpha,anchor,interpolator);else if(type===CAAT.Scene.prototype.EASE_SCALE)sin.easeScaleIn(0,time,alpha,anchor,interpolator);else sin.easeTranslationIn(time,alpha,anchor,interpolator);this.childrenList=[];this.addChild(sin);
sin.resetTransform();sin.setLocation(0,0);sin.alpha=1;sin.mouseEnabled=false;sin.setExpired(false)},setScene:function(sceneIndex){var sin=this.scenes[sceneIndex];this.childrenList=[];this.addChild(sin);this.currentScene=sin;sin.setExpired(false);sin.mouseEnabled=true;sin.resetTransform();sin.setLocation(0,0);sin.alpha=1;sin.activated()},switchToScene:function(iNewSceneIndex,time,alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(!transition)this.setScene(iNewSceneIndex);
else this.easeInOutRandom(iNewSceneIndex,currentSceneIndex,time,alpha)},switchToPrevScene:function(time,alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||currentSceneIndex===0)return;if(!transition)this.setScene(currentSceneIndex-1);else this.easeInOutRandom(currentSceneIndex-1,currentSceneIndex,time,alpha)},switchToNextScene:function(time,alpha,transition){var currentSceneIndex=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||
currentSceneIndex===this.getNumScenes()-1)return;if(!transition)this.setScene(currentSceneIndex+1);else this.easeInOutRandom(currentSceneIndex+1,currentSceneIndex,time,alpha)},mouseEnter:function(mouseEvent){},mouseExit:function(mouseEvent){},mouseMove:function(mouseEvent){},mouseDown:function(mouseEvent){},mouseUp:function(mouseEvent){},mouseDrag:function(mouseEvent){},easeEnd:function(scene,b_easeIn){if(!b_easeIn)scene.setExpired(true);else{this.currentScene=scene;this.currentScene.activated()}scene.mouseEnabled=
true;scene.emptyBehaviorList()},getSceneIndex:function(scene){for(var i=0;i<this.scenes.length;i++)if(this.scenes[i]===scene)return i;return-1},getScene:function(index){return this.scenes[index]},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(sId){var ret=this.imagesCache[sId];if(ret)return ret;
for(var i=0;i<this.imagesCache.length;i++)if(this.imagesCache[i].id===sId)return this.imagesCache[i].image;return null},addAudio:function(id,url){this.audioManager.addAudio(id,url);return this},audioPlay:function(id){this.audioManager.play(id)},audioLoop:function(id){return this.audioManager.loop(id)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(enabled){return this.audioManager.setSoundEffectsEnabled(enabled)},setMusicEnabled:function(enabled){return this.audioManager.setMusicEnabled(enabled)},
isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(id,volume){return this.audioManager.setVolume(id,volume)},emptyScenes:function(){this.scenes=[]},addChild:function(scene){scene.parent=this;this.childrenList.push(scene)},loop:function(fps,callback,callback2){if(callback2){this.onRenderStart=callback;this.onRenderEnd=callback2}else if(callback)this.onRenderEnd=callback;CAAT.loop()},
renderFrame:function(fps,callback){if(this.stopped)return;var t=(new Date).getTime(),delta=t-this.timeline;if(delta>500)delta=500;if(this.onRenderStart)this.onRenderStart(delta);this.render(delta);if(this.debugInfo)this.debugInfo(this.statistics);this.timeline=t;if(this.onRenderEnd)this.onRenderEnd(delta)},endLoop:function(){},setClear:function(clear){this.clear=clear;if(this.clear===CAAT.Director.CLEAR_DIRTY_RECTS)this.dirtyRectsEnabled=true;return this},getAudioManager:function(){return this.audioManager},
cumulateOffset:function(node,parent,prop){var left=prop+"Left";var top=prop+"Top";var x=0,y=0,style;while(navigator.browser!=="iOS"&&node&&node.style){if(node.currentStyle)style=node.currentStyle["position"];else{style=(node.ownerDocument.defaultView||node.ownerDocument.parentWindow).getComputedStyle(node,null);style=style?style.getPropertyValue("position"):null}if(!/^(fixed)$/.test(style)){x+=node[left];y+=node[top];node=node[parent]}else break}return{x:x,y:y,style:style}},getOffset:function(node){var res=
this.cumulateOffset(node,"offsetParent","offset");if(res.style==="fixed"){var res2=this.cumulateOffset(node,node.parentNode?"parentNode":"parentElement","scroll");return{x:res.x+res2.x,y:res.y+res2.y}}return{x:res.x,y:res.y}},getCanvasCoord:function(point,e){var pt=new CAAT.Point;var posx=0;var posy=0;if(!e)e=window.event;if(e.offsetX){posx=e.offsetX;posy=e.offsetY;if(!CAAT.__CSS__){var pt=new CAAT.Point(posx,posy);if(!this.modelViewMatrixI)this.modelViewMatrixI=this.modelViewMatrix.getInverse();
this.modelViewMatrixI.transformCoord(pt);posx=pt.x;posy=pt.y}point.set(posx,posy);this.screenMousePoint.set(posx,posy);return}else if(e.layerX){posx=e.layerX;posy=e.layerY;if(!CAAT.__CSS__){var pt=new CAAT.Point(posx,posy);if(!this.modelViewMatrixI)this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(pt);posx=pt.x;posy=pt.y}point.set(posx,posy);this.screenMousePoint.set(posx,posy);return}if(e.pageX||e.pageY){posx=e.pageX;posy=e.pageY}else if(e.clientX||e.clientY){posx=
e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}var offset=this.getOffset(e.target);posx-=offset.x;posy-=offset.y;if(!CAAT.__CSS__){pt.x=posx;pt.y=posy;if(!this.modelViewMatrixI)this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(pt);posx=pt.x;posy=pt.y}point.set(posx,posy);this.screenMousePoint.set(posx,posy)},__mouseDownHandler:function(e){if(this.dragging&&this.lastSelectedActor){this.__mouseUpHandler(e);
return}this.getCanvasCoord(this.mousePoint,e);this.isMouseDown=true;var lactor=this.findActorAtPosition(this.mousePoint);if(null!==lactor){var pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));lactor.mouseDown((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=lactor},__mouseUpHandler:function(e){this.isMouseDown=false;this.getCanvasCoord(this.mousePoint,e);var pos=null;var lactor=
this.lastSelectedActor;if(null!==lactor){pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(lactor.actionPerformed&&lactor.contains(pos.x,pos.y))lactor.actionPerformed(e);lactor.mouseUp((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,this.currentScene.time))}if(!this.dragging&&null!==lactor)if(lactor.contains(pos.x,pos.y))lactor.mouseClick((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,this.currentScene.time));
this.dragging=false;this.in_=false},__mouseMoveHandler:function(e){this.getCanvasCoord(this.mousePoint,e);var lactor;var pos;var ct=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){lactor=this.lastSelectedActor;pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));this.dragging=true;var px=lactor.x;var py=lactor.y;lactor.mouseDrag((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,new CAAT.Point(this.screenMousePoint.x,
this.screenMousePoint.y),ct));this.prevMousePoint.x=pos.x;this.prevMousePoint.y=pos.y;if(px===lactor.x&&py===lactor.y){var contains=lactor.contains(pos.x,pos.y);if(this.in_&&!contains){lactor.mouseExit((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,ct));this.in_=false}if(!this.in_&&contains){lactor.mouseEnter((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,ct));this.in_=true}}return}this.in_=true;lactor=this.findActorAtPosition(this.mousePoint);if(lactor!==
this.lastSelectedActor){if(null!==this.lastSelectedActor){pos=this.lastSelectedActor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));this.lastSelectedActor.mouseExit((new CAAT.MouseEvent).init(pos.x,pos.y,e,this.lastSelectedActor,this.screenMousePoint,ct))}if(null!==lactor){pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));lactor.mouseEnter((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,ct))}}pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,
this.screenMousePoint.y,0));if(null!==lactor)lactor.mouseMove((new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,ct));this.lastSelectedActor=lactor},__mouseOutHandler:function(e){if(this.dragging)return;if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,e);var pos=new CAAT.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(pos);var ev=(new CAAT.MouseEvent).init(pos.x,pos.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);
this.lastSelectedActor.mouseExit(ev);this.lastSelectedActor.mouseOut(ev);if(!this.dragging)this.lastSelectedActor=null}else{this.isMouseDown=false;this.in_=false}},__mouseOverHandler:function(e){if(this.dragging)return;var lactor;var pos,ev;this.getCanvasCoord(this.mousePoint,e);if(null==this.lastSelectedActor){lactor=this.findActorAtPosition(this.mousePoint);if(null!==lactor){pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));ev=(new CAAT.MouseEvent).init(pos.x,
pos.y,e,lactor,this.screenMousePoint,this.currentScene?this.currentScene.time:0);lactor.mouseOver(ev);lactor.mouseEnter(ev)}this.lastSelectedActor=lactor}else{lactor=this.lastSelectedActor;pos=lactor.viewToModel(new CAAT.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));ev=(new CAAT.MouseEvent).init(pos.x,pos.y,e,lactor,this.screenMousePoint,this.currentScene.time);lactor.mouseOver(ev);lactor.mouseEnter(ev)}},__mouseDBLClickHandler:function(e){this.getCanvasCoord(this.mousePoint,e);if(null!==
this.lastSelectedActor)this.lastSelectedActor.mouseDblClick((new CAAT.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(e){e.preventDefault();e=e.targetTouches[0];this.__mouseDownHandler(e)},__touchEndHandler:function(e){e.preventDefault();e=e.changedTouches[0];this.__mouseUpHandler(e)},__touchMoveHandler:function(e){e.preventDefault();if(this.gesturing)return;for(var i=0;i<e.targetTouches.length;i++)if(!i)this.__mouseMoveHandler(e.targetTouches[i])},
__gestureStart:function(scale,rotation){this.gesturing=true;this.__gestureRotation=this.lastSelectedActor.rotationAngle;this.__gestureSX=this.lastSelectedActor.scaleX-1;this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(scale,rotation){if(typeof scale==="undefined"||typeof rotation==="undefined")return;if(this.lastSelectedActor!==null&&this.lastSelectedActor.isGestureEnabled()){this.lastSelectedActor.setRotation(rotation*Math.PI/180+this.__gestureRotation);this.lastSelectedActor.setScale(this.__gestureSX+
scale,this.__gestureSY+scale)}},__gestureEnd:function(scale,rotation){this.gesturing=false;this.__gestureRotation=0;this.__gestureScale=0},addHandlers:function(canvas){var me=this;canvas.addEventListener("mouseup",function(e){e.preventDefault();me.__mouseUpHandler(e)},false);canvas.addEventListener("mousedown",function(e){e.preventDefault();me.__mouseDownHandler(e)},false);canvas.addEventListener("mouseover",function(e){e.preventDefault();me.__mouseOverHandler(e)},false);canvas.addEventListener("mouseout",
function(e){e.preventDefault();me.__mouseOutHandler(e)},false);canvas.addEventListener("mousemove",function(e){e.preventDefault();me.__mouseMoveHandler(e)},false);canvas.addEventListener("dblclick",function(e){e.preventDefault();me.__mouseDBLClickHandler(e)},false);canvas.addEventListener("touchstart",this.__touchStartHandler.bind(this),false);canvas.addEventListener("touchmove",this.__touchMoveHandler.bind(this),false);canvas.addEventListener("touchend",this.__touchEndHandler.bind(this),false);canvas.addEventListener("gesturestart",
function(e){e.preventDefault();me.__gestureStart(e.scale,e.rotation)},false);canvas.addEventListener("gestureend",function(e){e.preventDefault();me.__gestureEnd(e.scale,e.rotation)},false);canvas.addEventListener("gesturechange",function(e){e.preventDefault();me.__gestureChange(e.scale,e.rotation)},false)},enableEvents:function(onElement){CAAT.RegisterDirector(this);this.in_=false;this.createEventHandler(onElement)},createEventHandler:function(onElement){this.in_=false;this.addHandlers(onElement)}};
if(CAAT.__CSS__){CAAT.Director.prototype.clip=true;CAAT.Director.prototype.glEnabled=false;CAAT.Director.prototype.getRenderType=function(){return"CSS"};CAAT.Director.prototype.setScaleProportional=function(w,h){var factor=Math.min(w/this.referenceWidth,h/this.referenceHeight);this.setScaleAnchored(factor,factor,0,0);this.eventHandler.style.width=""+this.referenceWidth+"px";this.eventHandler.style.height=""+this.referenceHeight+"px"};CAAT.Director.prototype.setBounds=function(x,y,w,h){CAAT.Director.superclass.setBounds.call(this,
x,y,w,h);for(var i=0;i<this.scenes.length;i++)this.scenes[i].setBounds(0,0,w,h);this.eventHandler.style.width=w+"px";this.eventHandler.style.height=h+"px";return this};CAAT.Director.prototype.initialize=function(width,height,domElement,proxy){this.timeline=(new Date).getTime();this.domElement=domElement;this.style("position","absolute");this.style("width",""+width+"px");this.style("height",""+height+"px");this.style("overflow","hidden");this.enableEvents(domElement);this.setBounds(0,0,width,height);
this.checkDebug();return this};CAAT.Director.prototype.render=function(time){this.time+=time;this.animate(this,time);var i,l,tt;if(CAAT.DEBUG)this.resetStats();for(i=0,l=this.childrenList.length;i<l;i++){var c=this.childrenList[i];if(c.isInAnimationFrame(this.time)){tt=c.time-c.start_time;if(c.onRenderStart)c.onRenderStart(tt);if(c.onRenderEnd)c.onRenderEnd(tt);if(!c.isPaused())c.time+=time;if(CAAT.DEBUG){this.statistics.size_total+=c.size_total;this.statistics.size_active+=c.size_active;this.statistics.size_dirtyRects=
this.nDirtyRects}}}this.frameCounter++};CAAT.Director.prototype.addScene=function(scene){scene.setVisible(true);scene.setBounds(0,0,this.width,this.height);this.scenes.push(scene);scene.setEaseListener(this);if(null===this.currentScene)this.setScene(0);this.domElement.appendChild(scene.domElement)};CAAT.Director.prototype.emptyScenes=function(){this.scenes=[];this.domElement.innerHTML="";this.createEventHandler()};CAAT.Director.prototype.setClear=function(clear){return this};CAAT.Director.prototype.createEventHandler=
function(){this.eventHandler=document.createElement("div");this.domElement.appendChild(this.eventHandler);this.eventHandler.style.position="absolute";this.eventHandler.style.left="0";this.eventHandler.style.top="0";this.eventHandler.style.zIndex=999999;this.eventHandler.style.width=""+this.width+"px";this.eventHandler.style.height=""+this.height+"px";var canvas=this.eventHandler;this.in_=false;this.addHandlers(canvas)}}extend(CAAT.Director,CAAT.ActorContainer,null)})();
(function(){CAAT.MouseEvent=function(){this.point=new CAAT.Point(0,0,0);this.screenPoint=new CAAT.Point(0,0,0);return this};CAAT.MouseEvent.prototype={screenPoint:null,point:null,time:0,source:null,shift:false,control:false,alt:false,meta:false,sourceEvent:null,init:function(x,y,sourceEvent,source,screenPoint,time){this.point.set(x,y);this.source=source;this.screenPoint=screenPoint;this.alt=sourceEvent.altKey;this.control=sourceEvent.ctrlKey;this.shift=sourceEvent.shiftKey;this.meta=sourceEvent.metaKey;
this.sourceEvent=sourceEvent;this.x=x;this.y=y;this.time=time;return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}})();
CAAT.setCoordinateClamping=function(clamp){if(clamp){CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp;CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp}else{CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp;CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp}};CAAT.PMR=64;
CAAT.GLRENDER=false;CAAT.DEBUG=false;CAAT.DEBUGBB=false;CAAT.DEBUGBBBCOLOR="#00f";CAAT.DEBUGAABB=false;CAAT.DEBUGAABBCOLOR="#f00";CAAT.DEBUG_DIRTYRECTS=false;CAAT.log=function(){if(window.console)window.console.log(Array.prototype.slice.call(arguments))};CAAT.FRAME_TIME=0;CAAT.GlobalEventsEnabled=false;CAAT.prevOnDeviceMotion=null;CAAT.onDeviceMotion=null;CAAT.accelerationIncludingGravity={x:0,y:0,z:0};CAAT.rotationRate={alpha:0,beta:0,gamma:0};CAAT.DRAG_THRESHOLD_X=5;CAAT.DRAG_THRESHOLD_Y=5;
CAAT.renderEnabled=false;CAAT.FPS=60;CAAT.windowResizeListeners=[];CAAT.registerResizeListener=function(f){CAAT.windowResizeListeners.push(f)};CAAT.unregisterResizeListener=function(director){for(var i=0;i<CAAT.windowResizeListeners.length;i++)if(director===CAAT.windowResizeListeners[i]){CAAT.windowResizeListeners.splice(i,1);return}};CAAT.keyListeners=[];CAAT.registerKeyListener=function(f){CAAT.keyListeners.push(f)};
CAAT.Keys={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,
SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};CAAT.SHIFT_KEY=16;CAAT.CONTROL_KEY=17;CAAT.ALT_KEY=18;CAAT.ENTER_KEY=13;CAAT.KEY_MODIFIERS={alt:false,control:false,shift:false};
CAAT.KeyEvent=function(keyCode,up_or_down,modifiers,originalEvent){this.keyCode=keyCode;this.action=up_or_down;this.modifiers=modifiers;this.sourceEvent=originalEvent;this.preventDefault=function(){this.sourceEvent.preventDefault()};this.getKeyCode=function(){return this.keyCode};this.getAction=function(){return this.action};this.modifiers=function(){return this.modifiers};this.isShiftPressed=function(){return this.modifiers.shift};this.isControlPressed=function(){return this.modifiers.control};this.isAltPressed=
function(){return this.modifiers.alt};this.getSourceEvent=function(){return this.sourceEvent}};
CAAT.GlobalEnableEvents=function __GlobalEnableEvents(){if(CAAT.GlobalEventsEnabled)return;this.GlobalEventsEnabled=true;window.addEventListener("keydown",function(evt){var key=evt.which?evt.which:evt.keyCode;if(key===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=true;else if(key===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=true;else if(key===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=true;else for(var i=0;i<CAAT.keyListeners.length;i++)CAAT.keyListeners[i](new CAAT.KeyEvent(key,"down",{alt:CAAT.KEY_MODIFIERS.alt,
control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},evt))},false);window.addEventListener("keyup",function(evt){var key=evt.which?evt.which:evt.keyCode;if(key===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=false;else if(key===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=false;else if(key===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=false;else for(var i=0;i<CAAT.keyListeners.length;i++)CAAT.keyListeners[i](new CAAT.KeyEvent(key,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,
shift:CAAT.KEY_MODIFIERS.shift},evt))},false);window.addEventListener("resize",function(evt){for(var i=0;i<CAAT.windowResizeListeners.length;i++)CAAT.windowResizeListeners[i].windowResized(window.innerWidth,window.innerHeight)},false)};
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function raf(callback,element){window.setTimeout(callback,1E3/CAAT.FPS)}}();CAAT.SET_INTERVAL=0;
CAAT.loop=function(fps){if(CAAT.renderEnabled)return;CAAT.FPS=fps||60;CAAT.renderEnabled=true;if(CAAT.NO_PERF)setInterval(function(){var t=(new Date).getTime();for(var i=0,l=CAAT.director.length;i<l;i++)CAAT.director[i].renderFrame();CAAT.FRAME_TIME=t-CAAT.SET_INTERVAL;CAAT.SET_INTERVAL=t},1E3/CAAT.FPS);else CAAT.renderFrame()};CAAT.FPS_REFRESH=500;CAAT.RAF=0;CAAT.REQUEST_ANIMATION_FRAME_TIME=0;
CAAT.renderFrame=function(){var t=(new Date).getTime();for(var i=0,l=CAAT.director.length;i<l;i++)CAAT.director[i].renderFrame();t=(new Date).getTime()-t;CAAT.FRAME_TIME=t;if(CAAT.RAF)CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF;CAAT.RAF=(new Date).getTime();window.requestAnimFrame(CAAT.renderFrame,0)};CAAT.setCursor=function(cursor){if(navigator.browser!=="iOS")document.body.style.cursor=cursor};
CAAT.RegisterDirector=function __CAATGlobal_RegisterDirector(director){if(!CAAT.director)CAAT.director=[];CAAT.director.push(director);CAAT.GlobalEnableEvents()};
(function(){function tilt(data){CAAT.rotationRate={alpha:0,beta:data[0],gamma:data[1]}}if(window.DeviceOrientationEvent)window.addEventListener("deviceorientation",function(event){tilt([event.beta,event.gamma])},true);else if(window.DeviceMotionEvent)window.addEventListener("devicemotion",function(event){tilt([event.acceleration.x*2,event.acceleration.y*2])},true);else window.addEventListener("MozOrientation",function(event){tilt([-event.y*45,event.x*45])},true)})();
(function(){CAAT.SpriteImageHelper=function(x,y,w,h,iw,ih){this.x=x;this.y=y;this.width=w;this.height=h;this.setGL(x/iw,y/ih,(x+w-1)/iw,(y+h-1)/ih);return this};CAAT.SpriteImageHelper.prototype={x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(u,v,u1,v1){this.u=u;this.v=v;this.u1=u1;this.v1=v1;return this}}})();
(function(){CAAT.SpriteImage=function(){this.paint=this.paintN;this.setAnimationImageIndex([0]);this.mapInfo={};return this};CAAT.SpriteImage.prototype={animationImageIndex:null,prevAnimationTime:-1,changeFPS:1E3,transformation:0,spriteIndex:0,TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_TILE:5,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,ownerActor:null,mapInfo:null,map:null,setOwner:function(actor){this.ownerActor=
actor;return this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){var el=this.mapInfo[this.spriteIndex];return el.width},getHeight:function(){var el=this.mapInfo[this.spriteIndex];return el.height},getRef:function(){var ret=new CAAT.SpriteImage;ret.image=this.image;ret.rows=this.rows;ret.columns=this.columns;ret.width=this.width;ret.height=this.height;ret.singleWidth=this.singleWidth;ret.singleHeight=this.singleHeight;ret.mapInfo=this.mapInfo;ret.offsetX=
this.offsetX;ret.offsetY=this.offsetY;ret.scaleX=this.scaleX;ret.scaleY=this.scaleY;return ret},setOffsetX:function(x){this.offsetX=x;return this},setOffsetY:function(y){this.offsetY=y;return this},setOffset:function(x,y){this.offsetX=x;this.offsetY=y;return this},initialize:function(image,rows,columns){this.image=image;this.rows=rows;this.columns=columns;this.width=image.width;this.height=image.height;this.singleWidth=Math.floor(this.width/columns);this.singleHeight=Math.floor(this.height/rows);
this.mapInfo={};var i,sx0,sy0;var helper;if(image.__texturePage){image.__du=this.singleWidth/image.__texturePage.width;image.__dv=this.singleHeight/image.__texturePage.height;var w=this.singleWidth;var h=this.singleHeight;var mod=this.columns;if(image.inverted){var t=w;w=h;h=t;mod=this.rows}var xt=this.image.__tx;var yt=this.image.__ty;var tp=this.image.__texturePage;for(i=0;i<rows*columns;i++){var c=i%mod>>0;var r=i/mod>>0;var u=xt+c*w;var v=yt+r*h;var u1=u+w;var v1=v+h;helper=(new CAAT.SpriteImageHelper(u,
v,u1-u,v1-v,tp.width,tp.height)).setGL(u/tp.width,v/tp.height,u1/tp.width,v1/tp.height);this.mapInfo[i]=helper}}else for(i=0;i<rows*columns;i++){sx0=(i%this.columns|0)*this.singleWidth;sy0=(i/this.columns|0)*this.singleHeight;helper=new CAAT.SpriteImageHelper(sx0,sy0,this.singleWidth,this.singleHeight,image.width,image.height);this.mapInfo[i]=helper}return this},paintTiled:function(director,time,x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];var r=new CAAT.Rectangle;this.ownerActor.AABB.intersect(director.AABB,
r);var w=this.getWidth();var h=this.getHeight();var xoff=(this.offsetX-this.ownerActor.x)%w;if(xoff>0)xoff=xoff-w;var yoff=(this.offsetY-this.ownerActor.y)%h;if(yoff>0)yoff=yoff-h;var nw=((r.width-xoff)/w>>0)+1;var nh=((r.height-yoff)/h>>0)+1;var i,j;var ctx=director.ctx;for(i=0;i<nh;i++)for(j=0;j<nw;j++)ctx.drawImage(this.image,el.x,el.y,el.width,el.height,r.x-this.ownerActor.x+xoff+j*el.width>>0,r.y-this.ownerActor.y+yoff+i*el.height>>0,el.width,el.height)},paintInvertedH:function(director,time,
x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];var ctx=director.ctx;ctx.save();ctx.translate((x|0)+el.width,y|0);ctx.scale(-1,1);ctx.drawImage(this.image,el.x,el.y,el.width,el.height,this.offsetX>>0,this.offsetY>>0,el.width,el.height);ctx.restore();return this},paintInvertedV:function(director,time,x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];var ctx=director.ctx;ctx.save();ctx.translate(x|0,y+el.height|0);ctx.scale(1,-1);ctx.drawImage(this.image,
el.x,el.y,el.width,el.height,this.offsetX>>0,this.offsetY>>0,el.width,el.height);ctx.restore();return this},paintInvertedHV:function(director,time,x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];var ctx=director.ctx;ctx.save();ctx.translate(x|0,y+el.height|0);ctx.scale(1,-1);ctx.translate(el.width,0);ctx.scale(-1,1);ctx.drawImage(this.image,el.x,el.y,el.width,el.height,this.offsetX>>0,this.offsetY>>0,el.width,el.height);ctx.restore();return this},paintN:function(director,
time,x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];director.ctx.drawImage(this.image,el.x,el.y,el.width,el.height,this.offsetX+x>>0,this.offsetY+y>>0,el.width,el.height);return this},paintScaled:function(director,time,x,y){this.setSpriteIndexAtTime(time);var el=this.mapInfo[this.spriteIndex];director.ctx.drawImage(this.image,el.x,el.y,el.width,el.height,this.offsetX+x>>0,this.offsetY+y>>0,this.ownerActor.width,this.ownerActor.height);return this},getCurrentSpriteImageCSSPosition:function(){var el=
this.mapInfo[this.spriteIndex];var x=-(el.x-this.offsetX);var y=-(el.y-this.offsetY);return""+x+"px "+y+"px "+(this.ownerActor.transformation===this.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(uvBuffer,uvIndex){var im=this.image;if(!im.__texturePage)return;var index=uvIndex;var sIndex=this.spriteIndex;var el=this.mapInfo[this.spriteIndex];var u=el.u;var v=el.v;var u1=el.u1;var v1=el.v1;if(this.offsetX||this.offsetY){var w=this.ownerActor.width;
var h=this.ownerActor.height;var tp=im.__texturePage;var _u=-this.offsetX/tp.width;var _v=-this.offsetY/tp.height;var _u1=(w-this.offsetX)/tp.width;var _v1=(h-this.offsetY)/tp.height;u=_u+im.__u;v=_v+im.__v;u1=_u1+im.__u;v1=_v1+im.__v}if(im.inverted){uvBuffer[index++]=u1;uvBuffer[index++]=v;uvBuffer[index++]=u1;uvBuffer[index++]=v1;uvBuffer[index++]=u;uvBuffer[index++]=v1;uvBuffer[index++]=u;uvBuffer[index++]=v}else{uvBuffer[index++]=u;uvBuffer[index++]=v;uvBuffer[index++]=u1;uvBuffer[index++]=v;
uvBuffer[index++]=u1;uvBuffer[index++]=v1;uvBuffer[index++]=u;uvBuffer[index++]=v1}},setChangeFPS:function(fps){this.changeFPS=fps;return this},setSpriteTransformation:function(transformation){this.transformation=transformation;switch(transformation){case this.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case this.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case this.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case this.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;
case this.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}return this},setAnimationImageIndex:function(aAnimationImageIndex){this.animationImageIndex=aAnimationImageIndex;this.spriteIndex=aAnimationImageIndex[0];return this},setSpriteIndex:function(index){this.spriteIndex=index;return this},setSpriteIndexAtTime:function(time){if(this.animationImageIndex.length>1)if(this.prevAnimationTime===-1){this.prevAnimationTime=time;this.spriteIndex=0}else{var ttime=time;ttime-=this.prevAnimationTime;
ttime/=this.changeFPS;ttime%=this.animationImageIndex.length;this.spriteIndex=this.animationImageIndex[Math.floor(ttime)]}},getMapInfo:function(index){return this.mapInfo[index]},initializeFromMap:function(image,map){this.initialize(image,1,1);var key;var helper;var count=0;for(key in map){var value=map[key];helper=new CAAT.SpriteImageHelper(value.x,value.y,value.width,value.height,image.width,image.height);this.mapInfo[key]=helper;if(!count)this.setAnimationImageIndex([key]);count++}return this},
initializeAsGlyphDesigner:function(image,map){this.initialize(image,1,1);var key;var helper;var count=0;for(key in map){var value=map[key];helper=new CAAT.SpriteImageHelper(value.x,value.y,value.width,value.height,image.width,image.height);helper.xoffset=typeof value.xoffset==="undefined"?0:value.xoffset;helper.yoffset=typeof value.yoffset==="undefined"?0:value.yoffset;helper.xadvance=typeof value.xadvance==="undefined"?value.width:value.xadvance;this.mapInfo[key]=helper;if(!count)this.setAnimationImageIndex([key]);
count++}return this},initializeAsFontMap:function(image,chars){this.initialize(image,1,1);var helper;var x=0;for(var i=0;i<chars.length;i++){var value=chars[i];helper=new CAAT.SpriteImageHelper(x,0,value.width,image.height,image.width,image.height);helper.xoffset=0;helper.yoffset=0;helper.xadvance=value.width;x+=value.width;this.mapInfo[chars[i].c]=helper;if(!i)this.setAnimationImageIndex([chars[i].c])}return this},initializeAsMonoTypeFontMap:function(image,chars){var map=[];var charArr=chars.split("");
var w=image.width/charArr.length>>0;for(var i=0;i<charArr.length;i++)map.push({c:charArr[i],width:w});return this.initializeAsFontMap(image,map)},stringWidth:function(str){var i,l,w=0,charInfo;for(i=0,l=str.length;i<l;i++){charInfo=this.mapInfo[str.charAt(i)];if(charInfo)w+=charInfo.xadvance}return w},stringHeight:function(){if(this.fontHeight)return this.fontHeight;var y=0;for(var i in this.mapInfo){var mi=this.mapInfo[i];var h=mi.height+mi.yoffset;if(h>y)y=h}this.fontHeight=y;return this.fontHeight},
drawString:function(ctx,str,x,y){var i,l,charInfo,w;var charArr=str.split("");for(i=0;i<charArr.length;i++){charInfo=this.mapInfo[charArr[i]];if(charInfo){w=charInfo.width;ctx.drawImage(this.image,charInfo.x,charInfo.y,w,charInfo.height,x+charInfo.xoffset,y+charInfo.yoffset,w,charInfo.height);x+=charInfo.xadvance}}}}})();
(function(){CAAT.ImagePreloader=function(){this.images=[];return this};CAAT.ImagePreloader.prototype={images:null,notificationCallback:null,imageCounter:0,loadImages:function(aImages,callback_loaded_one_image,callback_error){if(!aImages)if(callback_loaded_one_image)callback_loaded_one_image(0,[]);var me=this,i;this.notificationCallback=callback_loaded_one_image;this.images=[];for(i=0;i<aImages.length;i++)this.images.push({id:aImages[i].id,image:new Image});for(i=0;i<aImages.length;i++){this.images[i].image.onload=
function imageLoaded(){me.imageCounter++;me.notificationCallback(me.imageCounter,me.images)};this.images[i].image.onerror=function(index){return function(e){if(callback_error)callback_error(e,index)}}(i);this.images[i].image.src=aImages[i].url}if(aImages.length===0)callback_loaded_one_image(0,[])}}})();
(function(){CAAT.TimerTask=function(){return this};CAAT.TimerTask.prototype={startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,scene:null,taskId:0,remove:false,create:function(startTime,duration,callback_timeout,callback_tick,callback_cancel){this.startTime=startTime;this.duration=duration;this.callback_timeout=callback_timeout;this.callback_tick=callback_tick;this.callback_cancel=callback_cancel;return this},checkTask:function(time){var ttime=time;ttime-=this.startTime;
if(ttime>=this.duration){this.remove=true;if(this.callback_timeout)this.callback_timeout(time,ttime,this)}else if(this.callback_tick)this.callback_tick(time,ttime,this);return this},reset:function(time){this.remove=false;this.startTime=time;this.scene.ensureTimerTask(this);return this},cancel:function(){this.remove=true;if(null!=this.callback_cancel)this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this);return this}}})();
(function(){CAAT.Scene=function(){CAAT.Scene.superclass.constructor.call(this);this.timerList=[];this.fillStyle=null;return this};CAAT.Scene.prototype={easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:false,EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3,timerList:null,timerSequence:0,paused:false,isPaused:function(){return this.paused},setPaused:function(paused){this.paused=paused},checkTimers:function(time){var tl=this.timerList;var i=tl.length-1;while(i>=0){if(!tl[i].remove)tl[i].checkTask(time);
i--}},ensureTimerTask:function(timertask){if(!this.hasTimer(timertask))this.timerList.push(timertask);return this},hasTimer:function(timertask){var tl=this.timerList;var i=tl.length-1;while(i>=0){if(tl[i]===timertask)return true;i--}return false},createTimer:function(startTime,duration,callback_timeout,callback_tick,callback_cancel){var tt=(new CAAT.TimerTask).create(startTime,duration,callback_timeout,callback_tick,callback_cancel);tt.taskId=this.timerSequence++;tt.sceneTime=this.time;tt.scene=this;
this.timerList.push(tt);return tt},removeExpiredTimers:function(){var i;var tl=this.timerList;for(i=0;i<tl.length;i++)if(tl[i].remove)tl.splice(i,1)},animate:function(director,time){this.checkTimers(time);CAAT.Scene.superclass.animate.call(this,director,time);this.removeExpiredTimers()},createAlphaBehaviour:function(time,isIn){var ab=new CAAT.AlphaBehavior;ab.setFrameTime(0,time);ab.startAlpha=isIn?0:1;ab.endAlpha=isIn?1:0;this.easeContainerBehaviour.addBehavior(ab)},easeTranslationIn:function(time,
alpha,anchor,interpolator){this.easeTranslation(time,alpha,anchor,true,interpolator)},easeTranslationOut:function(time,alpha,anchor,interpolator){this.easeTranslation(time,alpha,anchor,false,interpolator)},easeTranslation:function(time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=new CAAT.ContainerBehavior;this.easeIn=isIn;var pb=new CAAT.PathBehavior;if(interpolator)pb.setInterpolator(interpolator);pb.setFrameTime(0,time);if(anchor<1)anchor=1;else if(anchor>4)anchor=4;switch(anchor){case CAAT.Actor.prototype.ANCHOR_TOP:if(isIn)pb.setPath((new CAAT.Path).setLinear(0,
-this.height,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,0,-this.height));break;case CAAT.Actor.prototype.ANCHOR_BOTTOM:if(isIn)pb.setPath((new CAAT.Path).setLinear(0,this.height,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,0,this.height));break;case CAAT.Actor.prototype.ANCHOR_LEFT:if(isIn)pb.setPath((new CAAT.Path).setLinear(-this.width,0,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,-this.width,0));break;case CAAT.Actor.prototype.ANCHOR_RIGHT:if(isIn)pb.setPath((new CAAT.Path).setLinear(this.width,
0,0,0));else pb.setPath((new CAAT.Path).setLinear(0,0,this.width,0));break}if(alpha)this.createAlphaBehaviour(time,isIn);this.easeContainerBehaviour.addBehavior(pb);this.easeContainerBehaviour.setFrameTime(this.time,time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(starttime,time,alpha,anchor,interpolator){this.easeScale(starttime,time,alpha,anchor,true,interpolator);this.easeIn=
true},easeScaleOut:function(starttime,time,alpha,anchor,interpolator){this.easeScale(starttime,time,alpha,anchor,false,interpolator);this.easeIn=false},easeScale:function(starttime,time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=new CAAT.ContainerBehavior;var x=0;var y=0;var x2=0;var y2=0;switch(anchor){case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:case CAAT.Actor.prototype.ANCHOR_CENTER:x2=
1;y2=1;break;case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:x=1;x2=1;y=0;y2=1;break;case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:y=1;y2=1;x=0;x2=1;break;default:alert("scale anchor ?? "+anchor)}if(!isIn){var tmp;tmp=x;x=x2;x2=tmp;tmp=y;y=y2;y2=tmp}if(alpha)this.createAlphaBehaviour(time,isIn);var anchorPercent=this.getAnchorPercent(anchor);var sb=(new CAAT.ScaleBehavior).setFrameTime(starttime,time).setValues(x,x2,y,y2,anchorPercent.x,
anchorPercent.y);if(interpolator)sb.setInterpolator(interpolator);this.easeContainerBehaviour.addBehavior(sb);this.easeContainerBehaviour.setFrameTime(this.time,time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(behaviour){return this},easeRotationIn:function(time,alpha,anchor,interpolator){this.easeRotation(time,alpha,anchor,true,interpolator);this.easeIn=true},easeRotationOut:function(time,
alpha,anchor,interpolator){this.easeRotation(time,alpha,anchor,false,interpolator);this.easeIn=false},easeRotation:function(time,alpha,anchor,isIn,interpolator){this.easeContainerBehaviour=new CAAT.ContainerBehavior;var start=0;var end=0;if(anchor==CAAT.Actor.prototype.ANCHOR_CENTER)anchor=CAAT.Actor.prototype.ANCHOR_TOP;switch(anchor){case CAAT.Actor.prototype.ANCHOR_TOP:case CAAT.Actor.prototype.ANCHOR_BOTTOM:case CAAT.Actor.prototype.ANCHOR_LEFT:case CAAT.Actor.prototype.ANCHOR_RIGHT:start=Math.PI*
(Math.random()<0.5?1:-1);break;case CAAT.Actor.prototype.ANCHOR_TOP_LEFT:case CAAT.Actor.prototype.ANCHOR_TOP_RIGHT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_LEFT:case CAAT.Actor.prototype.ANCHOR_BOTTOM_RIGHT:start=Math.PI/2*(Math.random()<0.5?1:-1);break;default:alert("rot anchor ?? "+anchor)}if(false===isIn){var tmp=start;start=end;end=tmp}if(alpha)this.createAlphaBehaviour(time,isIn);var anchorPercent=this.getAnchorPercent(anchor);var rb=(new CAAT.RotateBehavior).setFrameTime(0,time).setValues(start,
end,anchorPercent.x,anchorPercent.y);if(interpolator)rb.setInterpolator(interpolator);this.easeContainerBehaviour.addBehavior(rb);this.easeContainerBehaviour.setFrameTime(this.time,time);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(listener){this.easeContainerBehaviourListener=listener},behaviorExpired:function(actor){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},
activated:function(){},setExpired:function(bExpired){this.expired=bExpired},paint:function(director,time){if(this.fillStyle){var ctx=director.crc;ctx.fillStyle=this.fillStyle;ctx.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(point){var i,j;var p=new CAAT.Point;if(this.inputList){var il=this.inputList;for(i=0;i<il.length;i++){var ill=il[i];for(j=0;j<ill.length;j++){p.set(point.x,point.y);var modelViewMatrixI=ill[j].worldModelViewMatrix.getInverse();modelViewMatrixI.transformCoord(p);
if(ill[j].contains(p.x,p.y))return ill[j]}}}p.set(point.x,point.y);return CAAT.Scene.superclass.findActorAtPosition.call(this,p)},enableInputList:function(size){this.inputList=[];for(var i=0;i<size;i++)this.inputList.push([]);return this},addActorToInputList:function(actor,index,position){if(index<0)index=0;else if(index>=this.inputList.length)index=this.inputList.length-1;var il=this.inputList[index];if(typeof position==="undefined"||position>=il.length)il.push(actor);else if(position<=0)il.unshift(actor);
else il.splice(position,0,actor);return this},emptyInputList:function(index){if(index<0)index=0;else if(index>=this.inputList.length)index=this.inputList.length-1;this.inputList[index]=[];return this},removeActorFromInputList:function(actor,index){if(typeof index==="undefined"){var i,j;for(i=0;i<this.inputList.length;i++){var il=this.inputList[i];for(j=0;j<il.length;j++)if(il[j]==actor)il.splice(j,1)}return this}if(index<0)index=0;else if(index>=this.inputList.length)index=this.inputList.length-1;
var il=this.inputList[index];for(j=0;j<il.length;j++)if(il[j]==actor)il.splice(j,1);return this}};extend(CAAT.Scene,CAAT.ActorContainer)})();CAAT.modules=CAAT.modules||{};CAAT.modules.CircleManager=CAAT.modules.CircleManager||{};
(function(){CAAT.modules.CircleManager.PackedCircle=function(){this.boundsRule=CAAT.modules.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE;this.position=new CAAT.Point(0,0,0);this.offset=new CAAT.Point(0,0,0);this.targetPosition=new CAAT.Point(0,0,0);return this};CAAT.modules.CircleManager.PackedCircle.prototype={id:0,delegate:null,position:new CAAT.Point(0,0,0),offset:new CAAT.Point(0,0,0),targetPosition:null,targetChaseSpeed:0.02,isFixed:false,boundsRule:0,collisionMask:0,collisionGroup:0,BOUNDS_RULE_WRAP:1,
BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8,containsPoint:function(aPoint){var distanceSquared=this.position.getDistanceSquared(aPoint);return distanceSquared<this.radiusSquared},getDistanceSquaredFromPosition:function(aPosition){var distanceSquared=this.position.getDistanceSquared(aPosition);return distanceSquared<this.radiusSquared},intersects:function(aCircle){var distanceSquared=this.position.getDistanceSquared(aCircle.position);return distanceSquared<this.radiusSquared||
distanceSquared<aCircle.radiusSquared},setPosition:function(aPosition){this.position=aPosition;return this},setDelegate:function(aDelegate){this.delegate=aDelegate;return this},setOffset:function(aPosition){this.offset=aPosition;return this},setTargetPosition:function(aTargetPosition){this.targetPosition=aTargetPosition;return this},setTargetChaseSpeed:function(aTargetChaseSpeed){this.targetChaseSpeed=aTargetChaseSpeed;return this},setIsFixed:function(value){this.isFixed=value;return this},setCollisionMask:function(aCollisionMask){this.collisionMask=
aCollisionMask;return this},setCollisionGroup:function(aCollisionGroup){this.collisionGroup=aCollisionGroup;return this},setRadius:function(aRadius){this.radius=aRadius;this.radiusSquared=this.radius*this.radius;return this},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=overrides[i];return this},dealloc:function(){this.position=null;this.offset=null;this.delegate=null;this.targetPosition=null}}})();
(function(){CAAT.modules.CircleManager.PackedCircleManager=function(){return this};CAAT.modules.CircleManager.PackedCircleManager.prototype={allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:new CAAT.Rectangle,addCircle:function(aCircle){aCircle.id=this.allCircles.length;this.allCircles.push(aCircle);return this},removeCircle:function(aCircle){var index=0,found=false,len=this.allCircles.length;if(len===0)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";
while(len--)if(this.allCircles[len]===aCircle){found=true;index=len;break}if(!found)throw"Could not locate circle in allCircles array!";this.allCircles[index].dealloc();this.allCircles[index]=null;return this},forceCirclesToMatchDelegatePositions:function(){var len=this.allCircles.length;for(var n=0;n<len;n++){var aCircle=this.allCircles[n];if(!aCircle||!aCircle.delegate)continue;aCircle.position.set(aCircle.delegate.x+aCircle.offset.x,aCircle.delegate.y+aCircle.offset.y)}},pushAllCirclesTowardTarget:function(aTarget){var v=
new CAAT.Point(0,0,0),circleList=this.allCircles,len=circleList.length;for(var n=0;n<this.numberOfTargetingPasses;n++)for(var i=0;i<len;i++){var c=circleList[i];if(c.isFixed)continue;v.x=c.position.x-(c.targetPosition.x+c.offset.x);v.y=c.position.y-(c.targetPosition.y+c.offset.y);v.multiply(c.targetChaseSpeed);c.position.x-=v.x;c.position.y-=v.y}},handleCollisions:function(){this.removeExpiredElements();var v=new CAAT.Point(0,0,0),circleList=this.allCircles,len=circleList.length;for(var n=0;n<this.numberOfCollisionPasses;n++)for(var i=
0;i<len;i++){var ci=circleList[i];for(var j=i+1;j<len;j++){var cj=circleList[j];if(!this.circlesCanCollide(ci,cj))continue;var dx=cj.position.x-ci.position.x,dy=cj.position.y-ci.position.y;var r=(ci.radius+cj.radius)*1.08,d=ci.position.getDistanceSquared(cj.position);if(d<r*r-0.02){v.x=dx;v.y=dy;v.normalize();var inverseForce=(r-Math.sqrt(d))*0.5;v.multiply(inverseForce);if(!cj.isFixed){if(ci.isFixed)v.multiply(2.2);cj.position.translatePoint(v)}if(!ci.isFixed){if(cj.isFixed)v.multiply(2.2);ci.position.subtract(v)}}}}},
handleBoundaryForCircle:function(aCircle,boundsRule){var xpos=aCircle.position.x;var ypos=aCircle.position.y;var radius=aCircle.radius;var diameter=radius*2;var wrapXMask=1<<0;var wrapYMask=1<<2;var constrainXMask=1<<3;var constrainYMask=1<<4;var emitEvent=1<<5;boundsRule=wrapYMask|constrainXMask;if(boundsRule&wrapXMask&&xpos-diameter>this.bounds.right)aCircle.position.x=this.bounds.left+radius;else if(boundsRule&wrapXMask&&xpos+diameter<this.bounds.left)aCircle.position.x=this.bounds.right-radius;
if(boundsRule&wrapYMask&&ypos-diameter>this.bounds.bottom)aCircle.position.y=this.bounds.top-radius;else if(boundsRule&wrapYMask&&ypos+diameter<this.bounds.top)aCircle.position.y=this.bounds.bottom+radius;if(boundsRule&constrainXMask&&xpos+radius>=this.bounds.right)aCircle.position.x=aCircle.position.x=this.bounds.right-radius;else if(boundsRule&constrainXMask&&xpos-radius<this.bounds.left)aCircle.position.x=this.bounds.left+radius;if(boundsRule&constrainYMask&&ypos+radius>this.bounds.bottom)aCircle.position.y=
this.bounds.bottom-radius;else if(boundsRule&constrainYMask&&ypos-radius<this.bounds.top)aCircle.position.y=this.bounds.top+radius},getCircleAt:function(xpos,ypos,buffer){var circleList=this.allCircles;var len=circleList.length;var grabVector=new CAAT.Point(xpos,ypos,0);var closestCircle=null;var closestDistance=Number.MAX_VALUE;for(var i=0;i<len;i++){var aCircle=circleList[i];if(!aCircle)continue;var distanceSquared=aCircle.position.getDistanceSquared(grabVector);if(distanceSquared<closestDistance&&
distanceSquared<aCircle.radiusSquared+buffer){closestDistance=distanceSquared;closestCircle=aCircle}}return closestCircle},circlesCanCollide:function(circleA,circleB){if(!circleA||!circleB||circleA===circleB)return false;return true},setBounds:function(x,y,w,h){this.bounds.x=x;this.bounds.y=y;this.bounds.width=w;this.bounds.height=h},setNumberOfCollisionPasses:function(value){this.numberOfCollisionPasses=value;return this},setNumberOfTargetingPasses:function(value){this.numberOfTargetingPasses=value;
return this},sortOnDistanceToTarget:function(circleA,circleB){var valueA=circleA.getDistanceSquaredFromPosition(circleA.targetPosition);var valueB=circleB.getDistanceSquaredFromPosition(circleA.targetPosition);var comparisonResult=0;if(valueA>valueB)comparisonResult=-1;else if(valueA<valueB)comparisonResult=1;return comparisonResult},removeExpiredElements:function(){for(var k=this.allCircles.length;k>=0;k--)if(this.allCircles[k]===null)this.allCircles.splice(k,1)},initialize:function(overrides){if(overrides)for(var i in overrides)this[i]=
overrides[i];return this}}})();(function(){CAAT.modules.LocalStorage=function(){return this};CAAT.modules.LocalStorage.prototype={save:function(key,data){try{localStorage.setItem(key,JSON.stringify(data))}catch(e){}return this},load:function(key){try{return JSON.parse(localStorage.getItem(key))}catch(e){return null}},remove:function(key){try{localStorage.removeItem(key)}catch(e){}return this}}})();
(function(){CAAT.modules.ImageUtil={};CAAT.modules.ImageUtil.createAlphaSpriteSheet=function(maxAlpha,minAlpha,sheetSize,image,bg_fill_style){if(maxAlpha<minAlpha){var t=maxAlpha;maxAlpha=minAlpha;minAlpha=t}var canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height*sheetSize;var ctx=canvas.getContext("2d");ctx.fillStyle=bg_fill_style?bg_fill_style:"rgba(255,255,255,0)";ctx.fillRect(0,0,image.width,image.height*sheetSize);var i;for(i=0;i<sheetSize;i++){ctx.globalAlpha=
1-(maxAlpha-minAlpha)/sheetSize*(i+1);ctx.drawImage(image,0,i*image.height)}return canvas};CAAT.modules.ImageUtil.rotate=function(image,angle){angle=angle||0;if(!angle)return image;var canvas=document.createElement("canvas");canvas.width=image.height;canvas.height=image.width;var ctx=canvas.getContext("2d");ctx.globalAlpha=1;ctx.fillStyle="rgba(0,0,0,0)";ctx.clearRect(0,0,canvas.width,canvas.height);var m=new CAAT.Matrix;m.multiply((new CAAT.Matrix).setTranslate(canvas.width/2,canvas.width/2));m.multiply((new CAAT.Matrix).setRotation(angle*
Math.PI/180));m.multiply((new CAAT.Matrix).setTranslate(-canvas.width/2,-canvas.width/2));m.transformRenderingContext(ctx);ctx.drawImage(image,0,0);return canvas};CAAT.modules.ImageUtil.optimize=function(image,threshold,areas){threshold>>=0;var atop=true;var abottom=true;var aleft=true;var aright=true;if(typeof areas!=="undefined"){if(typeof areas.top!=="undefined")atop=areas.top;if(typeof areas.bottom!=="undefined")abottom=areas.bottom;if(typeof areas.left!=="undefined")aleft=areas.left;if(typeof areas.right!==
"undefined")aright=areas.right}var canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext("2d");ctx.fillStyle="rgba(0,0,0,0)";ctx.fillRect(0,0,image.width,image.height);ctx.drawImage(image,0,0);var imageData=ctx.getImageData(0,0,image.width,image.height);var data=imageData.data;var i,j;var miny=0,maxy=canvas.height-1;var minx=0,maxx=canvas.width-1;var alpha=false;if(atop){for(i=0;i<canvas.height;i++){for(j=0;j<canvas.width;j++)if(data[i*
canvas.width*4+3+j*4]>threshold){alpha=true;break}if(alpha)break}miny=i}if(abottom){alpha=false;for(i=canvas.height-1;i>=miny;i--){for(j=0;j<canvas.width;j++)if(data[i*canvas.width*4+3+j*4]>threshold){alpha=true;break}if(alpha)break}maxy=i}if(aleft){alpha=false;for(j=0;j<canvas.width;j++){for(i=miny;i<=maxy;i++)if(data[i*canvas.width*4+3+j*4]>threshold){alpha=true;break}if(alpha)break}minx=j}if(aright){alpha=false;for(j=canvas.width-1;j>=minx;j--){for(i=miny;i<=maxy;i++)if(data[i*canvas.width*4+3+
j*4]>threshold){alpha=true;break}if(alpha)break}maxx=j}if(0===minx&&0===miny&&canvas.width-1===maxx&&canvas.height-1===maxy)return canvas;var width=maxx-minx+1;var height=maxy-miny+1;var id2=ctx.getImageData(minx,miny,width,height);canvas.width=width;canvas.height=height;ctx=canvas.getContext("2d");ctx.putImageData(id2,0,0);return canvas};CAAT.modules.ImageUtil.createThumb=function(image,w,h,best_fit){w=w||24;h=h||24;var canvas=document.createElement("canvas");canvas.width=w;canvas.height=h;var ctx=
canvas.getContext("2d");if(best_fit){var max=Math.max(image.width,image.height);var ww=image.width/max*w;var hh=image.height/max*h;ctx.drawImage(image,(w-ww)/2,(h-hh)/2,ww,hh)}else ctx.drawImage(image,0,0,w,h);return canvas}})();
(function(){CAAT.modules.LayoutUtils={};CAAT.modules.LayoutUtils.row=function(dst,what_to_layout_array,constraint_object){var width=dst.width;var x=0,y=0,i=0,l=0;var actor_max_h=-Number.MAX_VALUE,actor_max_w=Number.MAX_VALUE;for(i=what_to_layout_array.length-1;i;i-=1){if(actor_max_w<what_to_layout_array[i].width)actor_max_w=what_to_layout_array[i].width;if(actor_max_h<what_to_layout_array[i].height)actor_max_h=what_to_layout_array[i].height}if(constraint_object.padding_left){x=constraint_object.padding_left;
width-=x}if(constraint_object.padding_right)width-=constraint_object.padding_right;if(constraint_object.top){var top=parseInt(constraint_object.top,10);if(!isNaN(top))y=top;else switch(constraint_object.top){case "center":y=(dst.height-actor_max_h)/2;break;case "top":y=0;break;case "bottom":y=dst.height-actor_max_h;break;default:y=0}}var actor_area=width/what_to_layout_array.length;for(i=0,l=what_to_layout_array.length;i<l;i++)what_to_layout_array[i].setLocation(x+i*actor_area+(actor_area-what_to_layout_array[i].width)/
2,y)}})();
(function(){CAAT.Font=function(){return this};var UNKNOWN_CHAR_WIDTH=10;CAAT.Font.prototype={fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,padding:0,image:null,charMap:null,height:0,setPadding:function(padding){this.padding=padding;return this},setFontStyle:function(style){this.fontStyle=style;return this},setFontSize:function(fontSize){this.fontSize=fontSize;this.fontSizeUnit="px";return this},setFont:function(font){this.font=font;return this},setFillStyle:function(style){this.fillStyle=
style;return this},setStrokeStyle:function(style){this.strokeStyle=style;return this},createDefault:function(padding){var str="";for(var i=32;i<128;i++)str=str+String.fromCharCode(i);return this.create(str,padding)},create:function(chars,padding){padding=padding|0;this.padding=padding;var canvas=document.createElement("canvas");canvas.width=1;canvas.height=1;var ctx=canvas.getContext("2d");ctx.textBaseline="top";ctx.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var textWidth=
0;var charWidth=[];var i;var x;var cchar;for(i=0;i<chars.length;i++){var cw=Math.max(1,(ctx.measureText(chars.charAt(i)).width>>0)+1)+2*padding;charWidth.push(cw);textWidth+=cw}canvas.width=textWidth;canvas.height=this.fontSize*1.5>>0;ctx=canvas.getContext("2d");ctx.textBaseline="top";ctx.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;ctx.fillStyle=this.fillStyle;ctx.strokeStyle=this.strokeStyle;this.charMap={};x=0;for(i=0;i<chars.length;i++){cchar=chars.charAt(i);ctx.fillText(cchar,
x+padding,0);if(this.strokeStyle){ctx.beginPath();ctx.strokeText(cchar,x+padding,0)}this.charMap[cchar]={x:x,width:charWidth[i]};x+=charWidth[i]}this.image=CAAT.modules.ImageUtil.optimize(canvas,32,{top:true,bottom:true,left:false,right:false});this.height=this.image.height;return this},setAsSpriteImage:function(){var cm=[];var _index=0;for(var i in this.charMap){var _char=i;var charData=this.charMap[i];cm[i]={id:_index++,height:this.height,xoffset:0,letter:_char,yoffset:0,width:charData.width,xadvance:charData.width,
x:charData.x,y:0}}return(new CAAT.SpriteImage).initializeAsGlyphDesigner(this.image,cm)},stringWidth:function(str){var i,l,w=0,c;for(i=0,l=str.length;i<l;i++){c=this.charMap[str.charAt(i)];if(c)w+=c.width;else w+=UNKNOWN_CHAR_WIDTH}return w},drawText:function(str,ctx,x,y){var i,l,charInfo,w;var height=this.image.height;for(i=0,l=str.length;i<l;i++){charInfo=this.charMap[str.charAt(i)];if(charInfo){w=charInfo.width;ctx.drawImage(this.image,charInfo.x,0,w,height,x,y,w,height);x+=w}else{ctx.strokeStyle=
"#f00";ctx.strokeRect(x,y,UNKNOWN_CHAR_WIDTH,height);x+=UNKNOWN_CHAR_WIDTH}}},save:function(){var str="image/png";var strData=this.image.toDataURL(str);document.location.href=strData.replace(str,"image/octet-stream")}}})();
(function(){CAAT.InterpolatorActor=function(){CAAT.InterpolatorActor.superclass.constructor.call(this);return this};CAAT.InterpolatorActor.prototype={interpolator:null,contour:null,S:50,gap:5,setGap:function(gap){this.gap=gap;return this},setInterpolator:function(interpolator,size){this.interpolator=interpolator;this.contour=interpolator.getContour(size||this.S);return this},paint:function(director,time){CAAT.InterpolatorActor.superclass.paint.call(this,director,time);if(this.backgroundImage)return this;
if(this.interpolator){var canvas=director.crc;var xs=this.width-2*this.gap;var ys=this.height-2*this.gap;canvas.beginPath();canvas.moveTo(this.gap+xs*this.contour[0].x,-this.gap+this.height-ys*this.contour[0].y);for(var i=1;i<this.contour.length;i++)canvas.lineTo(this.gap+xs*this.contour[i].x,-this.gap+this.height-ys*this.contour[i].y);canvas.strokeStyle=this.strokeStyle;canvas.stroke()}},getInterpolator:function(){return this.interpolator}};extend(CAAT.InterpolatorActor,CAAT.ActorContainer,null)})();
(function(){CAAT.PathSegment=function(){this.bbox=new CAAT.Rectangle;return this};CAAT.PathSegment.prototype={color:"#000",length:0,bbox:null,parent:null,setParent:function(parent){this.parent=parent;return this},setColor:function(color){if(color)this.color=color;return this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(points){},setPoint:function(point,index){},getPosition:function(time){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},
numControlPoints:function(){},getControlPoint:function(index){},endPath:function(){},getContour:function(iSize){},updatePath:function(point){},applyAsPath:function(director){},transform:function(matrix){},drawHandle:function(ctx,x,y){var w=CAAT.Curve.prototype.HANDLE_SIZE/2;ctx.fillRect(x-w,y-w,w*2,w*2)}}})();
(function(){CAAT.LinearPath=function(){CAAT.LinearPath.superclass.constructor.call(this);this.points=[];this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.newPosition=new CAAT.Point(0,0,0);return this};CAAT.LinearPath.prototype={points:null,newPosition:null,applyAsPath:function(director){director.ctx.lineTo(this.points[0].x,this.points[1].y)},setPoint:function(point,index){if(index===0)this.points[0]=point;else if(index===1)this.points[1]=point},updatePath:function(point){var x=
this.points[1].x-this.points[0].x;var y=this.points[1].y-this.points[0].y;this.length=Math.sqrt(x*x+y*y);this.bbox.setEmpty();this.bbox.union(this.points[0].x,this.points[0].y);this.bbox.union(this.points[1].x,this.points[1].y);return this},setPoints:function(points){this.points[0]=points[0];this.points[1]=points[1];this.updatePath();return this},setInitialPosition:function(x,y){this.points[0].x=x;this.points[0].y=y;this.newPosition.set(x,y);return this},setFinalPosition:function(finalX,finalY){this.points[1].x=
finalX;this.points[1].y=finalY;return this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*time,this.points[0].y+(this.points[1].y-this.points[0].y)*time);return this.newPosition},getPositionFromLength:function(len){return this.getPosition(len/this.length)},initialPositionX:function(){return this.points[0].x},
finalPositionX:function(){return this.points[1].x},paint:function(director,bDrawHandles){var ctx=director.ctx;ctx.save();ctx.strokeStyle=this.color;ctx.beginPath();ctx.moveTo(this.points[0].x,this.points[0].y);ctx.lineTo(this.points[1].x,this.points[1].y);ctx.stroke();if(bDrawHandles){ctx.globalAlpha=0.5;ctx.fillStyle="#7f7f00";ctx.beginPath();this.drawHandle(ctx,this.points[0].x,this.points[0].y);this.drawHandle(ctx,this.points[1].x,this.points[1].y)}ctx.restore()},numControlPoints:function(){return 2},
getControlPoint:function(index){if(0===index)return this.points[0];else if(1===index)return this.points[1]},getContour:function(iSize){var contour=[];contour.push(this.getPosition(0).clone());contour.push(this.getPosition(1).clone());return contour}};extend(CAAT.LinearPath,CAAT.PathSegment)})();
(function(){CAAT.CurvePath=function(){CAAT.CurvePath.superclass.constructor.call(this);this.newPosition=new CAAT.Point(0,0,0);return this};CAAT.CurvePath.prototype={curve:null,newPosition:null,applyAsPath:function(director){this.curve.applyAsPath(director);return this},setPoint:function(point,index){if(this.curve)this.curve.setPoint(point,index)},setPoints:function(points){var curve=new CAAT.Bezier;curve.setPoints(points);this.curve=curve;return this},setQuadric:function(p0x,p0y,p1x,p1y,p2x,p2y){var curve=
new CAAT.Bezier;curve.setQuadric(p0x,p0y,p1x,p1y,p2x,p2y);this.curve=curve;this.updatePath();return this},setCubic:function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var curve=new CAAT.Bezier;curve.setCubic(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y);this.curve=curve;this.updatePath();return this},updatePath:function(point){this.curve.update();this.length=this.curve.getLength();this.curve.getBoundingBox(this.bbox);return this},getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;this.curve.solve(this.newPosition,
time);return this.newPosition},getPositionFromLength:function(iLength){this.curve.solve(this.newPosition,iLength/this.length);return this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(director,bDrawHandles){this.curve.drawHandles=bDrawHandles;director.ctx.strokeStyle=this.color;this.curve.paint(director,bDrawHandles)},numControlPoints:function(){return this.curve.coordlist.length},
getControlPoint:function(index){return this.curve.coordlist[index]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push({x:i/iSize,y:this.getPosition(i/iSize).y});return contour}};extend(CAAT.CurvePath,CAAT.PathSegment,null)})();
(function(){CAAT.ShapePath=function(){CAAT.ShapePath.superclass.constructor.call(this);this.points=[];this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.points.push(new CAAT.Point);this.newPosition=new CAAT.Point;return this};CAAT.ShapePath.prototype={points:null,length:-1,cw:true,bbox:null,newPosition:null,applyAsPath:function(director){var ctx=director.ctx;if(this.cw){ctx.lineTo(this.points[0].x,this.points[0].y);
ctx.lineTo(this.points[1].x,this.points[1].y);ctx.lineTo(this.points[2].x,this.points[2].y);ctx.lineTo(this.points[3].x,this.points[3].y);ctx.lineTo(this.points[4].x,this.points[4].y)}else{ctx.lineTo(this.points[4].x,this.points[4].y);ctx.lineTo(this.points[3].x,this.points[3].y);ctx.lineTo(this.points[2].x,this.points[2].y);ctx.lineTo(this.points[1].x,this.points[1].y);ctx.lineTo(this.points[0].x,this.points[0].y)}return this},setPoint:function(point,index){if(index>=0&&index<this.points.length)this.points[index]=
point},setPoints:function(points){this.points=[];this.points.push(points[0]);this.points.push((new CAAT.Point).set(points[1].x,points[0].y));this.points.push(points[1]);this.points.push((new CAAT.Point).set(points[0].x,points[1].y));this.points.push(points[0].clone());this.updatePath();return this},setClockWise:function(cw){this.cw=cw!==undefined?cw:true;return this},isClockWise:function(){return this.cw},setInitialPosition:function(x,y){for(var i=0,l=this.points.length;i<l;i++){this.points[i].x=
x;this.points[i].y=y}return this},setFinalPosition:function(finalX,finalY){this.points[2].x=finalX;this.points[2].y=finalY;this.points[1].x=finalX;this.points[1].y=this.points[0].y;this.points[3].x=this.points[0].x;this.points[3].y=finalY;this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y;this.updatePath();return this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(time){if(time>1||time<0)time%=1;if(time<
0)time=1+time;if(-1===this.length)this.newPosition.set(0,0);else{var w=this.bbox.width/this.length;var h=this.bbox.height/this.length;var accTime=0;var times;var segments;var index=0;if(this.cw){segments=[0,1,2,3,4];times=[w,h,w,h]}else{segments=[4,3,2,1,0];times=[h,w,h,w]}while(index<times.length)if(accTime+times[index]<time){accTime+=times[index];index++}else break;time-=accTime;var p0=segments[index];var p1=segments[index+1];this.newPosition.set(this.points[p0].x+(this.points[p1].x-this.points[p0].x)*
time/times[index],this.points[p0].y+(this.points[p1].y-this.points[p0].y)*time/times[index])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(director,bDrawHandles){var ctx=director.ctx;ctx.save();ctx.strokeStyle=this.color;ctx.beginPath();ctx.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height);if(bDrawHandles){ctx.globalAlpha=0.5;ctx.fillStyle="#7f7f00";for(var i=0;i<this.points.length;i++)this.drawHandle(ctx,
this.points[i].x,this.points[i].y)}ctx.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(index){return this.points[index]},getContour:function(iSize){var contour=[];for(var i=0;i<this.points.length;i++)contour.push(this.points[i]);return contour},updatePath:function(point){if(point){if(point===this.points[0]){this.points[1].y=point.y;this.points[3].x=point.x}else if(point===this.points[1]){this.points[0].y=point.y;this.points[2].x=point.x}else if(point===this.points[2]){this.points[3].y=
point.y;this.points[1].x=point.x}else if(point===this.points[3]){this.points[0].x=point.x;this.points[2].y=point.y}this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y}this.bbox.setEmpty();var minx=Number.MAX_VALUE,miny=Number.MAX_VALUE,maxx=-Number.MAX_VALUE,maxy=-Number.MAX_VALUE;for(var i=0;i<4;i++)this.bbox.union(this.points[i].x,this.points[i].y);this.length=2*this.bbox.width+2*this.bbox.height;this.points[0].x=this.bbox.x;this.points[0].y=this.bbox.y;this.points[1].x=this.bbox.x+
this.bbox.width;this.points[1].y=this.bbox.y;this.points[2].x=this.bbox.x+this.bbox.width;this.points[2].y=this.bbox.y+this.bbox.height;this.points[3].x=this.bbox.x;this.points[3].y=this.bbox.y+this.bbox.height;this.points[4].x=this.bbox.x;this.points[4].y=this.bbox.y;return this}};extend(CAAT.ShapePath,CAAT.PathSegment)})();
(function(){CAAT.Path=function(){CAAT.Path.superclass.constructor.call(this);this.newPosition=new CAAT.Point(0,0,0);this.pathSegments=[];this.behaviorList=[];this.matrix=new CAAT.Matrix;this.tmpMatrix=new CAAT.Matrix;return this};CAAT.Path.prototype={pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:true,behaviorList:null,rb_angle:0,rb_rotateAnchorX:0.5,rb_rotateAnchorY:0.5,
sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:0.5,sb_scaleAnchorY:0.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,applyAsPath:function(director){var ctx=director.ctx;director.modelViewMatrix.transformRenderingContext(ctx);ctx.beginPath();ctx.globalCompositeOperation="source-out";ctx.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var i=0;i<this.pathSegments.length;i++)this.pathSegments[i].applyAsPath(director);
ctx.globalCompositeOperation="source-over";return this},setInteractive:function(interactive){this.interactive=interactive;return this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){if(this.pathSegments.length)return this.pathSegments[this.pathSegments.length-1].endCurvePosition();else return(new CAAT.Point).set(this.beginPathX,
this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(x0,y0,x1,y1){this.beginPath(x0,y0);this.addLineTo(x1,y1);this.endPath();return this},setQuadric:function(x0,y0,x1,y1,x2,y2){this.beginPath(x0,y0);this.addQuadricTo(x1,y1,x2,y2);this.endPath();return this},setCubic:function(x0,y0,x1,y1,x2,y2,x3,y3){this.beginPath(x0,y0);this.addCubicTo(x1,y1,x2,y2,
x3,y3);this.endPath();return this},setRectangle:function(x0,y0,x1,y1){this.beginPath(x0,y0);this.addRectangleTo(x1,y1);this.endPath();return this},setCatmullRom:function(points,closed){if(closed){points=points.slice(0);points.unshift(points[points.length-1]);points.push(points[1]);points.push(points[2])}for(var i=1;i<points.length-2;i++){var segment=(new CAAT.CurvePath).setColor("#000").setParent(this);var cm=(new CAAT.CatmullRom).setCurve(points[i-1],points[i],points[i+1],points[i+2]);segment.curve=
cm;this.pathSegments.push(segment)}return this},addSegment:function(pathSegment){pathSegment.setParent(this);this.pathSegments.push(pathSegment);return this},addRectangleTo:function(x1,y1,cw,color){var r=new CAAT.ShapePath;r.setPoints([this.endCurvePosition(),(new CAAT.Point).set(x1,y1)]);r.setClockWise(cw);r.setColor(color);r.setParent(this);this.pathSegments.push(r);return this},addQuadricTo:function(px1,py1,px2,py2,color){var bezier=new CAAT.Bezier;bezier.setPoints([this.endCurvePosition(),(new CAAT.Point).set(px1,
py1),(new CAAT.Point).set(px2,py2)]);this.trackPathX=px2;this.trackPathY=py2;var segment=(new CAAT.CurvePath).setColor(color).setParent(this);segment.curve=bezier;this.pathSegments.push(segment);return this},addCubicTo:function(px1,py1,px2,py2,px3,py3,color){var bezier=new CAAT.Bezier;bezier.setPoints([this.endCurvePosition(),(new CAAT.Point).set(px1,py1),(new CAAT.Point).set(px2,py2),(new CAAT.Point).set(px3,py3)]);this.trackPathX=px3;this.trackPathY=py3;var segment=(new CAAT.CurvePath).setColor(color).setParent(this);
segment.curve=bezier;this.pathSegments.push(segment);return this},addCatmullTo:function(px1,py1,px2,py2,px3,py3,color){var curve=(new CAAT.CatmullRom).setColor(color);curve.setCurve(this.trackPathX,this.trackPathY,px1,py1,px2,py2,px3,py3);this.trackPathX=px3;this.trackPathY=py3;var segment=(new CAAT.CurvePath).setParent(this);segment.curve=curve;this.pathSegments.push(segment);return this},addLineTo:function(px1,py1,color){var segment=(new CAAT.LinearPath).setColor(color);segment.setPoints([this.endCurvePosition(),
(new CAAT.Point).set(px1,py1)]);segment.setParent(this);this.trackPathX=px1;this.trackPathY=py1;this.pathSegments.push(segment);return this},beginPath:function(px0,py0){this.trackPathX=px0;this.trackPathY=py0;this.beginPathX=px0;this.beginPathY=py0;return this},closePath:function(){this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1);this.trackPathX=this.beginPathX;this.trackPathY=this.beginPathY;this.endPath();return this},
endPath:function(){this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];this.updatePath();return this},getPosition:function(time){if(time>1||time<0)time%=1;if(time<0)time=1+time;var ps=this.pathSegments;var psst=this.pathSegmentStartTime;var psdt=this.pathSegmentDurationTime;var l=0;var r=ps.length;var m;var np=this.newPosition;var psstv;while(l!==r){m=(r+l)/2|0;psstv=psst[m];if(psstv<=time&&time<=psstv+psdt[m]){time=psdt[m]?(time-psstv)/psdt[m]:0;var pointInPath=ps[m].getPosition(time);np.x=
pointInPath.x;np.y=pointInPath.y;return np}else if(time<psstv)r=m;else l=m+1}return this.endCurvePosition()},getPositionFromLength:function(iLength){iLength%=this.getLength();if(iLength<0)iLength+=this.getLength();var accLength=0;for(var i=0;i<this.pathSegments.length;i++){if(accLength<=iLength&&iLength<=this.pathSegments[i].getLength()+accLength){iLength-=accLength;var pointInPath=this.pathSegments[i].getPositionFromLength(iLength);this.newPosition.x=pointInPath.x;this.newPosition.y=pointInPath.y;
break}accLength+=this.pathSegments[i].getLength()}return this.newPosition},paint:function(director){for(var i=0;i<this.pathSegments.length;i++)this.pathSegments[i].paint(director,this.interactive)},release:function(){this.ax=-1;this.ay=-1},getNumSegments:function(){return this.pathSegments.length},getSegment:function(index){return this.pathSegments[index]},numControlPoints:function(){return this.points.length},getControlPoint:function(index){return this.points[index]},updatePath:function(point,callback){var i,
j;this.length=0;this.bbox.setEmpty();this.points=[];var xmin=Number.MAX_VALUE,ymin=Number.MAX_VALUE;for(i=0;i<this.pathSegments.length;i++){this.pathSegments[i].updatePath(point);this.length+=this.pathSegments[i].getLength();this.bbox.unionRectangle(this.pathSegments[i].bbox);for(j=0;j<this.pathSegments[i].numControlPoints();j++){var pt=this.pathSegments[i].getControlPoint(j);this.points.push(pt);if(pt.x<xmin)xmin=pt.x;if(pt.y<ymin)ymin=pt.y}}this.clipOffsetX=-xmin;this.clipOffsetY=-ymin;this.width=
this.bbox.width;this.height=this.bbox.height;this.setLocation(this.bbox.x,this.bbox.y);this.bbox.x=0;this.bbox.y=0;this.bbox.x1=this.width;this.bbox.y1=this.height;this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];var i;for(i=0;i<this.pathSegments.length;i++){this.pathSegmentStartTime.push(0);this.pathSegmentDurationTime.push(0)}for(i=0;i<this.pathSegments.length;i++){this.pathSegmentDurationTime[i]=this.getLength()?this.pathSegments[i].getLength()/this.getLength():0;if(i>0)this.pathSegmentStartTime[i]=
this.pathSegmentStartTime[i-1]+this.pathSegmentDurationTime[i-1];else this.pathSegmentStartTime[0]=0;this.pathSegments[i].endPath()}this.extractPathPoints();if(typeof callback!=="undefined")callback(this);return this},press:function(x,y){if(!this.interactive)return;var HS=CAAT.Curve.prototype.HANDLE_SIZE/2;for(var i=0;i<this.pathSegments.length;i++)for(var j=0;j<this.pathSegments[i].numControlPoints();j++){var point=this.pathSegments[i].getControlPoint(j);if(x>=point.x-HS&&y>=point.y-HS&&x<point.x+
HS&&y<point.y+HS){this.point=point;return}}this.point=null},drag:function(x,y,callback){if(!this.interactive)return;if(null===this.point)return;if(-1===this.ax||-1===this.ay){this.ax=x;this.ay=y}this.point.x+=x-this.ax;this.point.y+=y-this.ay;this.ax=x;this.ay=y;this.updatePath(this.point,callback)},getContour:function(iSize){var contour=[];for(var i=0;i<=iSize;i++)contour.push((new CAAT.Point).set(i/iSize,this.getPosition(i/iSize).y,0));return contour},setPoints:function(points){if(this.points.length===
points.length)for(var i=0;i<points.length;i++){this.points[i].x=points[i].x;this.points[i].y=points[i].y}return this},setPoint:function(point,index){if(index>=0&&index<this.points.length){this.points[index].x=point.x;this.points[index].y=point.y}return this},emptyBehaviorList:function(){this.behaviorList=[];return this},extractPathPoints:function(){if(!this.pathPoints){var i;this.pathPoints=[];for(i=0;i<this.numControlPoints();i++)this.pathPoints.push(this.getControlPoint(i).clone())}return this},
addBehavior:function(behavior){this.behaviorList.push(behavior);return this},removeBehaviour:function(behavior){var n=this.behaviorList.length-1;while(n)if(this.behaviorList[n]===behavior){this.behaviorList.splice(n,1);return this}return this},removeBehaviorById:function(id){for(var n=0;n<this.behaviorList.length;n++)if(this.behaviorList[n].id===id)this.behaviorList.splice(n,1);return this},applyBehaviors:function(time){for(var i=0;i<this.behaviorList.length;i++)this.behaviorList[i].apply(time,this);
this.setATMatrix();for(i=0;i<this.numControlPoints();i++)this.setPoint(this.matrix.transformCoord(this.pathPoints[i].clone().translate(this.clipOffsetX,this.clipOffsetY)),i);return this},setATMatrix:function(){this.matrix.identity();var m=this.tmpMatrix.identity();var mm=this.matrix.matrix;var c,s,_m00,_m01,_m10,_m11;var mm0,mm1,mm2,mm3,mm4,mm5;var bbox=this.bbox;var bbw=bbox.width;var bbh=bbox.height;var bbx=bbox.x;var bby=bbox.y;mm0=1;mm1=0;mm3=0;mm4=1;mm2=this.tb_x-bbx-this.tAnchorX*bbw;mm5=this.tb_y-
bby-this.tAnchorY*bbh;if(this.rb_angle){var rbx=this.rb_rotateAnchorX*bbw+bbx;var rby=this.rb_rotateAnchorY*bbh+bby;mm2+=mm0*rbx+mm1*rby;mm5+=mm3*rbx+mm4*rby;c=Math.cos(this.rb_angle);s=Math.sin(this.rb_angle);_m00=mm0;_m01=mm1;_m10=mm3;_m11=mm4;mm0=_m00*c+_m01*s;mm1=-_m00*s+_m01*c;mm3=_m10*c+_m11*s;mm4=-_m10*s+_m11*c;mm2+=-mm0*rbx-mm1*rby;mm5+=-mm3*rbx-mm4*rby}if(this.sb_scaleX!=1||this.sb_scaleY!=1){var sbx=this.sb_scaleAnchorX*bbw+bbx;var sby=this.sb_scaleAnchorY*bbh+bby;mm2+=mm0*sbx+mm1*sby;mm5+=
mm3*sbx+mm4*sby;mm0=mm0*this.sb_scaleX;mm1=mm1*this.sb_scaleY;mm3=mm3*this.sb_scaleX;mm4=mm4*this.sb_scaleY;mm2+=-mm0*sbx-mm1*sby;mm5+=-mm3*sbx-mm4*sby}mm[0]=mm0;mm[1]=mm1;mm[2]=mm2;mm[3]=mm3;mm[4]=mm4;mm[5]=mm5;return this},setRotationAnchored:function(angle,rx,ry){this.rb_angle=angle;this.rb_rotateAnchorX=rx;this.rb_rotateAnchorY=ry;return this},setRotationAnchor:function(ax,ay){this.rb_rotateAnchorX=ax;this.rb_rotateAnchorY=ay},setRotation:function(angle){this.rb_angle=angle},setScaleAnchored:function(scaleX,
scaleY,sx,sy){this.sb_scaleX=scaleX;this.sb_scaleAnchorX=sx;this.sb_scaleY=scaleY;this.sb_scaleAnchorY=sy;return this},setScale:function(sx,sy){this.sb_scaleX=sx;this.sb_scaleY=sy;return this},setScaleAnchor:function(ax,ay){this.sb_scaleAnchorX=ax;this.sb_scaleAnchorY=ay;return this},setPositionAnchor:function(ax,ay){this.tAnchorX=ax;this.tAnchorY=ay;return this},setPositionAnchored:function(x,y,ax,ay){this.tb_x=x;this.tb_y=y;this.tAnchorX=ax;this.tAnchorY=ay;return this},setPosition:function(x,y){this.tb_x=
x;this.tb_y=y;return this},setLocation:function(x,y){this.tb_x=x;this.tb_y=y;return this},flatten:function(npatches,closed){var point=this.getPositionFromLength(0);var path=(new CAAT.Path).beginPath(point.x,point.y);for(var i=0;i<npatches;i++){point=this.getPositionFromLength(i/npatches*this.length);path.addLineTo(point.x,point.y)}if(closed)path.closePath();else path.endPath();return path}};extend(CAAT.Path,CAAT.PathSegment,null)})();
(function(){CAAT.PathActor=function(){CAAT.PathActor.superclass.constructor.call(this);return this};CAAT.PathActor.prototype={path:null,pathBoundingRectangle:null,bOutline:false,outlineColor:"black",onUpdateCallback:null,interactive:false,getPath:function(){return this.path},setPath:function(path){this.path=path;if(path!=null){this.pathBoundingRectangle=path.getBoundingBox();this.setInteractive(this.interactive)}return this},paint:function(director,time){CAAT.PathActor.superclass.paint.call(this,
director,time);if(!this.path)return;var ctx=director.ctx;ctx.strokeStyle="#000";this.path.paint(director,this.interactive);if(this.bOutline){ctx.strokeStyle=this.outlineColor;ctx.strokeRect(0,0,this.width,this.height)}},showBoundingBox:function(show,color){this.bOutline=show;if(show&&color)this.outlineColor=color},setInteractive:function(interactive){this.interactive=interactive;if(this.path)this.path.setInteractive(interactive);return this},setOnUpdateCallback:function(fn){this.onUpdateCallback=
fn;return this},mouseDrag:function(mouseEvent){this.path.drag(mouseEvent.point.x,mouseEvent.point.y,this.onUpdateCallback)},mouseDown:function(mouseEvent){this.path.press(mouseEvent.point.x,mouseEvent.point.y)},mouseUp:function(mouseEvent){this.path.release()}};extend(CAAT.PathActor,CAAT.ActorContainer,null)})();
(function(){CAAT.ImageProcessor=function(){return this};CAAT.ImageProcessor.prototype={canvas:null,ctx:null,width:0,height:0,imageData:null,bufferImage:null,grabPixels:function(image){var canvas=document.createElement("canvas");if(canvas!==null){canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext("2d");ctx.drawImage(image,0,0);try{var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);return imageData}catch(e){CAAT.log("error pixelgrabbing.",image);return null}}return null},
makeArray:function(size,initValue){var a=[];for(var i=0;i<size;i++)a.push(initValue);return a},makeArray2D:function(size,size2,initvalue){var a=[];for(var i=0;i<size;i++)a.push(this.makeArray(size2,initvalue));return a},initialize:function(width,height){this.width=width;this.height=height;this.canvas=document.createElement("canvas");if(this.canvas!==null){this.canvas.width=width;this.canvas.height=height;this.ctx=this.canvas.getContext("2d");this.imageData=this.ctx.getImageData(0,0,width,height);
this.bufferImage=this.imageData.data}return this},clear:function(r,g,b,a){if(null===this.imageData)return this;var data=this.imageData.data;for(var i=0;i<this.width*this.height;i++){data[i*4+0]=r;data[i*4+1]=g;data[i*4+2]=b;data[i*4+3]=a}this.imageData.data=data;return this},getImageData:function(){return this.ctx.getImageData(0,0,this.width,this.height)},apply:function(director,time){if(null!==this.imageData){this.imageData.data=this.bufferImage;this.ctx.putImageData(this.imageData,0,0)}return this},
getCanvas:function(){return this.canvas},createPattern:function(type){return this.ctx.createPattern(this.canvas,type?type:"repeat")},paint:function(director,time){if(null!==this.canvas){var ctx=director.ctx;ctx.drawImage(this.getCanvas(),0,0)}}}})();
(function(){CAAT.IMPlasma=function(){CAAT.IMPlasma.superclass.constructor.call(this);return this};CAAT.IMPlasma.prototype={wavetable:null,m_colorMap:null,spd1:1,spd2:2,spd3:3,spd4:4,pos1:0,pos2:0,pos3:0,pos4:0,tpos1:0,tpos2:0,tpos3:0,tpos4:0,m_colorMapSize:256,i1:0,i2:0,i3:0,i4:0,b1:false,b2:false,b3:false,b4:false,color:[4294967295,4294902015,4294967040,4278255360,4294901760,4278190335,4278190080],initialize:function(width,height,colors){CAAT.IMPlasma.superclass.initialize.call(this,width,height);
this.wavetable=[];for(var x=0;x<256;x++)this.wavetable.push(Math.floor(32*(1+Math.cos(x*2*Math.PI/256))));this.pos1=Math.floor(255*Math.random());this.pos2=Math.floor(255*Math.random());this.pos3=Math.floor(255*Math.random());this.pos4=Math.floor(255*Math.random());this.m_colorMap=CAAT.Color.prototype.makeRGBColorRamp(colors!==null?colors:this.color,256,CAAT.Color.prototype.RampEnumeration.RAMP_CHANNEL_RGBA_ARRAY);this.setB();return this},setB:function(){this.b1=Math.random()>0.5;this.b2=Math.random()>
0.5;this.b3=Math.random()>0.5;this.b4=Math.random()>0.5;this.spd1=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd2=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd3=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.spd4=Math.floor((Math.random()*3+1)*(Math.random()<0.5?1:-1));this.i1=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1));this.i2=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1));this.i3=Math.floor((Math.random()*2.4+1)*(Math.random()<
0.5?1:-1));this.i4=Math.floor((Math.random()*2.4+1)*(Math.random()<0.5?1:-1))},apply:function(director,time){var v=0;this.tpos1=this.pos1;this.tpos2=this.pos2;var bi=this.bufferImage;var cm=this.m_colorMap;var wt=this.wavetable;var z;var cmz;for(var x=0;x<this.height;x++){this.tpos3=this.pos3;this.tpos4=this.pos4;for(var y=0;y<this.width;y++){var o1=this.tpos1+this.tpos2+this.tpos3;var o2=this.tpos2+this.tpos3-this.tpos1;var o3=this.tpos3+this.tpos4-this.tpos2;var o4=this.tpos4+this.tpos1-this.tpos2;
if(this.b1)o1=-o1;if(this.b2)o2=-o2;if(this.b3)o3=-o3;if(this.b4)o4=-o4;z=Math.floor(wt[o1&255]+wt[o2&255]+wt[o3&255]+wt[o4&255]);cmz=cm[z];bi[v++]=cmz[0];bi[v++]=cmz[1];bi[v++]=cmz[2];bi[v++]=cmz[3];this.tpos3+=this.i1;this.tpos3&=255;this.tpos4+=this.i2;this.tpos4&=255}this.tpos1+=this.i3;this.tpos1&=255;this.tpos2+=this.i4;this.tpos2&=255}this.pos1+=this.spd1;this.pos2-=this.spd2;this.pos3+=this.spd3;this.pos4-=this.spd4;this.pos1&=255;this.pos3&=255;this.pos2&=255;this.pos4&=255;return CAAT.IMPlasma.superclass.apply.call(this,
director,time)}};extend(CAAT.IMPlasma,CAAT.ImageProcessor,null)})();
(function(){CAAT.IMBump=function(){CAAT.IMBump.superclass.constructor.call(this);return this};CAAT.IMBump.prototype={m_avgX:null,m_avgY:null,m_tt:null,phong:null,m_radius:75,m_lightcolor:null,bcolor:false,lightPosition:[],prepareBump:function(image,radius){var i,j;this.m_radius=radius?radius:75;var imageData=this.grabPixels(image);this.m_tt=this.makeArray(this.height,0);for(i=0;i<this.height;i++)this.m_tt[i]=this.width*i;this.m_avgX=this.makeArray2D(this.height,this.width,0);this.m_avgY=this.makeArray2D(this.height,
this.width,0);var bump=this.makeArray2D(this.height,this.width,0);if(null===imageData)return;var sourceImagePixels=imageData.data;for(i=0;i<this.height;i++)for(j=0;j<this.width;j++){var pos=(i*this.width+j)*4;bump[i][j]=sourceImagePixels[pos]+sourceImagePixels[pos+1]+sourceImagePixels[pos+2]}bump=this.soften(bump);for(var x=1;x<this.width-1;x++)for(var y=1;y<this.height-1;y++){this.m_avgX[y][x]=Math.floor(bump[y][x+1]-bump[y][x-1]);this.m_avgY[y][x]=Math.floor(bump[y+1][x]-bump[y-1][x])}bump=null},
soften:function(bump){var temp;var sbump=this.makeArray2D(this.height,this.width,0);for(var j=0;j<this.width;j++)for(var i=0;i<this.height;i++){temp=bump[i][j];temp+=bump[(i+1)%this.height][j];temp+=bump[(i+this.height-1)%this.height][j];temp+=bump[i][(j+1)%this.width];temp+=bump[i][(j+this.width-1)%this.width];temp+=bump[(i+1)%this.height][(j+1)%this.width];temp+=bump[(i+this.height-1)%this.height][(j+this.width-1)%this.width];temp+=bump[(i+this.height-1)%this.height][(j+1)%this.width];temp+=bump[(i+
1)%this.height][(j+this.width-1)%this.width];temp/=9;sbump[i][j]=temp/3}return sbump},calculatePhong:function(){this.phong=this.makeArray2D(this.m_radius,this.m_radius,0);var i,j,z;for(i=0;i<this.m_radius;i++)for(j=0;j<this.m_radius;j++){var x=j/this.m_radius;var y=i/this.m_radius;z=(1-Math.sqrt(x*x+y*y))*0.8;if(z<0)z=0;this.phong[i][j]=Math.floor(z*255)}},drawColored:function(dstPixels){var i,j,k;for(i=0;i<this.height;i++)for(j=0;j<this.width;j++){var rrr=0;var ggg=0;var bbb=0;for(k=0;k<this.m_lightcolor.length;k++){var lx=
this.lightPosition[k].x;var ly=this.lightPosition[k].y;var dx=Math.floor(Math.abs(this.m_avgX[i][j]-j+lx));var dy=Math.floor(Math.abs(this.m_avgY[i][j]-i+ly));if(dx>=this.m_radius)dx=this.m_radius-1;if(dy>=this.m_radius)dy=this.m_radius-1;var c=this.phong[dx][dy];var r=0;var g=0;var b=0;if(c>=0){r=this.m_lightcolor[k][0]*c/128;g=this.m_lightcolor[k][1]*c/128;b=this.m_lightcolor[k][2]*c/128}else{c=128+c;var rr=this.m_lightcolor[k][0];var gg=this.m_lightcolor[k][1];var bb=this.m_lightcolor[k][2];r=
Math.floor(rr+(255-rr)*c/128);g=Math.floor(gg+(255-gg)*c/128);b=Math.floor(bb+(255-bb)*c/128)}rrr+=r;ggg+=g;bbb+=b}if(rrr>255)rrr=255;if(ggg>255)ggg=255;if(bbb>255)bbb=255;var pos=(j+this.m_tt[i])*4;dstPixels[pos]=rrr;dstPixels[pos+1]=ggg;dstPixels[pos+2]=bbb;dstPixels[pos+3]=255}},setLightColors:function(colors_rgb_array){this.m_lightcolor=colors_rgb_array;this.lightPosition=[];for(var i=0;i<this.m_lightcolor.length;i++){var x=this.width*Math.random();var y=this.height*Math.random();this.lightPosition.push((new CAAT.Point).set(x,
y))}return this},initialize:function(image,radius){CAAT.IMBump.superclass.initialize.call(this,image.width,image.height);this.setLightColors([[255,128,0],[0,0,255]]);this.prepareBump(image,radius);this.calculatePhong();return this},setLightPosition:function(lightIndex,x,y){this.lightPosition[lightIndex].set(x,y);return this},apply:function(director,time){this.drawColored(this.bufferImage);return CAAT.IMBump.superclass.apply.call(this,director,time)}};extend(CAAT.IMBump,CAAT.ImageProcessor,null)})();
(function(){CAAT.IMRotoZoom=function(){CAAT.IMRotoZoom.superclass.constructor.call(this);return this};CAAT.IMRotoZoom.prototype={m_alignv:1,m_alignh:1,distortion:2,mask:0,shift:0,sourceImageData:null,initialize:function(width,height,patternImage){CAAT.IMRotoZoom.superclass.initialize.call(this,width,height);this.clear(255,128,0,255);this.sourceImageData=this.grabPixels(patternImage);if(null!==this.sourceImageData)switch(this.sourceImageData.width){case 1024:this.mask=1023;this.shift=10;break;case 512:this.mask=
511;this.shift=9;break;case 256:this.mask=255;this.shift=8;break;case 128:this.mask=127;this.shift=7;break;case 64:this.mask=63;this.shift=6;break;case 32:this.mask=31;this.shift=5;break;case 16:this.mask=15;this.shift=4;break;case 8:this.mask=7;this.shift=3;break}this.setCenter();return this},rotoZoom:function(director,time){var timer=(new Date).getTime();var angle=Math.PI*2*Math.cos(timer*1.0E-4);var distance=600+550*Math.sin(timer*2.0E-4);var dist=this.distortion;var off=0;var ddx=Math.floor(Math.cos(angle)*
distance);var ddy=Math.floor(Math.sin(angle)*distance);var hh=0,ww=0;switch(this.m_alignh){case 0:hh=0;break;case 1:hh=this.height>>1;break;case 2:hh=this.height-1;break}switch(this.m_alignv){case 0:ww=0;break;case 1:ww=this.width>>1;break;case 2:ww=this.width-1;break}var i=(this.width>>1<<8)-ddx*ww+ddy*hh&65535;var j=(this.height>>1<<8)-ddy*ww-ddx*hh&65535;var srcwidth=this.sourceImageData.width;var srcheight=this.sourceImageData.height;var srcdata=this.sourceImageData.data;var bi=this.bufferImage;
var dstoff;var addx;var addy;while(off<this.width*this.height*4){addx=i;addy=j;for(var m=0;m<this.width;m++){dstoff=(addy>>this.shift&this.mask)*srcwidth+(addx>>this.shift&this.mask);dstoff<<=2;bi[off++]=srcdata[dstoff++];bi[off++]=srcdata[dstoff++];bi[off++]=srcdata[dstoff++];bi[off++]=srcdata[dstoff++];addx+=ddx;addy+=ddy}dist+=this.distortion;i-=ddy;j+=ddx-dist}},apply:function(director,time){if(null!==this.sourceImageData)this.rotoZoom(director,time);return CAAT.IMRotoZoom.superclass.apply.call(this,
director,time)},setCenter:function(){var d=Math.random();if(d<0.33)this.m_alignv=0;else if(d<0.66)this.m_alignv=1;else this.m_alignv=2;d=Math.random();if(d<0.33)this.m_alignh=0;else if(d<0.66)this.m_alignh=1;else this.m_alignh=2}};extend(CAAT.IMRotoZoom,CAAT.ImageProcessor,null)})();
(function(){CAAT.Program=function(gl){this.gl=gl;return this};CAAT.Program.prototype={shaderProgram:null,gl:null,setAlpha:function(alpha){},getShader:function(gl,type,str){var shader;if(type==="x-shader/x-fragment")shader=gl.createShader(gl.FRAGMENT_SHADER);else if(type==="x-shader/x-vertex")shader=gl.createShader(gl.VERTEX_SHADER);else return null;gl.shaderSource(shader,str);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){alert(gl.getShaderInfoLog(shader));return null}return shader},
getDomShader:function(gl,id){var shaderScript=document.getElementById(id);if(!shaderScript)return null;var str="";var k=shaderScript.firstChild;while(k){if(k.nodeType===3)str+=k.textContent;k=k.nextSibling}var shader;if(shaderScript.type==="x-shader/x-fragment")shader=gl.createShader(gl.FRAGMENT_SHADER);else if(shaderScript.type==="x-shader/x-vertex")shader=gl.createShader(gl.VERTEX_SHADER);else return null;gl.shaderSource(shader,str);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){alert(gl.getShaderInfoLog(shader));
return null}return shader},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var gl=this.gl;this.shaderProgram=gl.createProgram();gl.attachShader(this.shaderProgram,this.getVertexShader());gl.attachShader(this.shaderProgram,this.getFragmentShader());gl.linkProgram(this.shaderProgram);gl.useProgram(this.shaderProgram);return this},setMatrixUniform:function(caatMatrix4){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,
false,new Float32Array(caatMatrix4.flatten()))},useProgram:function(){this.gl.useProgram(this.shaderProgram);return this}}})();
(function(){CAAT.ColorProgram=function(gl){CAAT.ColorProgram.superclass.constructor.call(this,gl);return this};CAAT.ColorProgram.prototype={colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \n"+"precision highp float; \n"+"#endif \n"+"varying vec4 color; \n"+"void main(void) { \n"+"  gl_FragColor = color;\n"+"}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex",
"attribute vec3 aVertexPosition; \n"+"attribute vec4 aColor; \n"+"uniform mat4 uPMatrix; \n"+"varying vec4 color; \n"+"void main(void) { \n"+"gl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \n"+"color= aColor; \n"+"}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,
"aColor");this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.useProgram();this.colorBuffer=this.gl.createBuffer();this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);var maxTris=512,i;this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(maxTris*12);this.gl.bufferData(this.gl.ARRAY_BUFFER,
this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,0,0);return CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(colorArray){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(colorArray),this.gl.STATIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,false,0,0)}};extend(CAAT.ColorProgram,
CAAT.Program,null)})();
(function(){CAAT.TextureProgram=function(gl){CAAT.TextureProgram.superclass.constructor.call(this,gl);return this};CAAT.TextureProgram.prototype={vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \n"+"precision highp float; \n"+"#endif \n"+"varying vec2 vTextureCoord; \n"+
"uniform sampler2D uSampler; \n"+"uniform float alpha; \n"+"uniform bool uUseColor;\n"+"uniform vec4 uColor;\n"+"void main(void) { \n"+"if ( uUseColor ) {\n"+"  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n"+"} else { \n"+"  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n"+"  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n"+"}\n"+"}\n")},getVertexShader:function(){return this.getShader(this.gl,
"x-shader/x-vertex","attribute vec3 aVertexPosition; \n"+"attribute vec2 aTextureCoord; \n"+"uniform mat4 uPMatrix; \n"+"varying vec2 vTextureCoord; \n"+"void main(void) { \n"+"gl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \n"+"vTextureCoord = aTextureCoord;\n"+"}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,
this.vertexIndexBuffer)},initialize:function(){var i;this.linesBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var arr=[];for(i=0;i<1024;i++)arr[i]=i;this.linesBufferArray=new Uint16Array(arr);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW);this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);
this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord");this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler");this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha");this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,
"uUseColor");this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor");this.setAlpha(1);this.setUseColor(false);var maxTris=4096;this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(maxTris*12);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,
0,0);this.vertexUVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.vertexUVArray=new Float32Array(maxTris*8);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,false,0,0);this.vertexIndexBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);var vertexIndex=[];for(i=0;i<maxTris;i++){vertexIndex.push(0+
i*4);vertexIndex.push(1+i*4);vertexIndex.push(2+i*4);vertexIndex.push(0+i*4);vertexIndex.push(2+i*4);vertexIndex.push(3+i*4)}this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(vertexIndex),this.gl.DYNAMIC_DRAW);return CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(use,r,g,b,a){this.gl.uniform1i(this.shaderProgram.useColor,use?1:0);if(use)if(this.prevA!==a||this.prevR!==r||this.prevG!==g||this.prevB!==b){this.gl.uniform4f(this.shaderProgram.color,r,g,b,a);this.prevA=
a;this.prevR=r;this.prevG=g;this.prevB=b}},setTexture:function(glTexture){if(this.prevTexture!==glTexture){var gl=this.gl;gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,glTexture);gl.uniform1i(this.shaderProgram.samplerUniform,0);this.prevTexture=glTexture}return this},updateVertexBuffer:function(vertexArray){var gl=this.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexPositionBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,vertexArray);return this},updateUVBuffer:function(uvArray){var gl=this.gl;
gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexUVBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,uvArray);return this},setAlpha:function(alpha){if(this.prevAlpha!==alpha){this.gl.uniform1f(this.shaderProgram.alphaUniform,alpha);this.prevAlpha=alpha}return this},drawLines:function(lines_data,size,r,g,b,a,lineWidth){var gl=this.gl;this.setAlpha(a);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);gl.lineWidth(lineWidth);this.updateVertexBuffer(lines_data);this.setUseColor(true,r,g,b,1);gl.drawElements(gl.LINES,
size,gl.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(polyline_data,size,r,g,b,a,lineWidth){var gl=this.gl;gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);gl.lineWidth(lineWidth);this.setAlpha(a);this.updateVertexBuffer(polyline_data);this.setUseColor(true,r,g,b,1);gl.drawElements(gl.LINE_STRIP,size,gl.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,
this.vertexIndexBuffer)}};extend(CAAT.TextureProgram,CAAT.Program,null)})();function makePerspective(fovy,aspect,znear,zfar,viewportHeight){var ymax=znear*Math.tan(fovy*Math.PI/360);var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return makeFrustum(xmin,xmax,ymin,ymax,znear,zfar,viewportHeight)}
function makeFrustum(left,right,bottom,top,znear,zfar,viewportHeight){var X=2*znear/(right-left);var Y=2*znear/(top-bottom);var A=(right+left)/(right-left);var B=(top+bottom)/(top-bottom);var C=-(zfar+znear)/(zfar-znear);var D=-2*zfar*znear/(zfar-znear);return(new CAAT.Matrix3).initWithMatrix([[X,0,A,-viewportHeight/2],[0,-Y,B,viewportHeight/2],[0,0,C,D],[0,0,-1,0]])}
function makeOrtho(left,right,bottom,top,znear,zfar){var tx=-(right+left)/(right-left);var ty=-(top+bottom)/(top-bottom);var tz=-(zfar+znear)/(zfar-znear);return(new CAAT.Matrix3).initWithMatrix([[2/(right-left),0,0,tx],[0,2/(top-bottom),0,ty],[0,0,-2/(zfar-znear),tz],[0,0,0,1]])}(function(){CAAT.GLTextureElement=function(){return this};CAAT.GLTextureElement.prototype={inverted:false,image:null,u:0,v:0,glTexture:null}})();
(function(){CAAT.GLTextureScan=function(w){this.freeChunks=[{position:0,size:w||1024}];return this};CAAT.GLTextureScan.prototype={freeChunks:null,findWhereFits:function(width){if(this.freeChunks.length===0)return[];var fitsOnPosition=[];var i;for(i=0;i<this.freeChunks.length;i++){var pos=0;while(pos+width<=this.freeChunks[i].size){fitsOnPosition.push(pos+this.freeChunks[i].position);pos+=width}}return fitsOnPosition},fits:function(position,size){var i=0;for(i=0;i<this.freeChunks.length;i++){var fc=
this.freeChunks[i];if(fc.position<=position&&position+size<=fc.position+fc.size)return true}return false},substract:function(position,size){var i=0;for(i=0;i<this.freeChunks.length;i++){var fc=this.freeChunks[i];if(fc.position<=position&&position+size<=fc.position+fc.size){var lp=0;var ls=0;var rp=0;var rs=0;lp=fc.position;ls=position-fc.position;rp=position+size;rs=fc.position+fc.size-rp;this.freeChunks.splice(i,1);if(ls>0)this.freeChunks.splice(i++,0,{position:lp,size:ls});if(rs>0)this.freeChunks.splice(i,
0,{position:rp,size:rs});return true}}return false},log:function(index){if(0===this.freeChunks.length)CAAT.log("index "+index+" empty");else{var str="index "+index;for(var i=0;i<this.freeChunks.length;i++){var fc=this.freeChunks[i];str+="["+fc.position+","+fc.size+"]"}CAAT.log(str)}}}})();
(function(){CAAT.GLTextureScanMap=function(w,h){this.scanMapHeight=h;this.scanMapWidth=w;this.scanMap=[];for(var i=0;i<this.scanMapHeight;i++)this.scanMap.push(new CAAT.GLTextureScan(this.scanMapWidth));return this};CAAT.GLTextureScanMap.prototype={scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(width,height){if(width>this.width||height>this.height)return null;var i,j,initialPosition=0;while(initialPosition<=this.scanMapHeight-height){var fitHorizontalPositions=null;var foundPositionOnScan=
false;for(;initialPosition<=this.scanMapHeight-height;initialPosition++){fitHorizontalPositions=this.scanMap[initialPosition].findWhereFits(width);if(null!==fitHorizontalPositions&&fitHorizontalPositions.length>0){foundPositionOnScan=true;break}}if(foundPositionOnScan){var minInitialPosition=Number.MAX_VALUE;for(j=0;j<fitHorizontalPositions.length;j++){var fits=true;for(i=initialPosition;i<initialPosition+height;i++)if(!this.scanMap[i].fits(fitHorizontalPositions[j],width)){fits=false;break}if(fits)return{x:fitHorizontalPositions[j],
y:initialPosition}}initialPosition++}else return null}return null},substract:function(x,y,width,height){for(var i=0;i<height;i++)if(!this.scanMap[i+y].substract(x,width))CAAT.log("Error: removing chunk ",width,height," at ",x,y)},log:function(){for(var i=0;i<this.scanMapHeight;i++)this.scanMap[i].log(i)}}})();
(function(){CAAT.GLTexturePage=function(w,h){this.width=w||1024;this.height=h||1024;this.images=[];return this};CAAT.GLTexturePage.prototype={width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:false,padding:4,scan:null,images:null,criteria:"area",initialize:function(gl){this.gl=gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);var uarr=new Uint8Array(this.width*
this.height*4);for(var jj=0;jj<4*this.width*this.height;){uarr[jj++]=0;uarr[jj++]=0;uarr[jj++]=0;uarr[jj++]=0}gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,uarr);gl.enable(gl.BLEND);for(var i=0;i<this.images.length;i++){var img=this.images[i];if(img.inverted)img=CAAT.modules.ImageUtil.prototype.rotate(img,-90);gl.texSubImage2D(gl.TEXTURE_2D,0,this.images[i].__tx,this.images[i].__ty,gl.RGBA,gl.UNSIGNED_BYTE,img)}},create:function(imagesCache){var images=[];
for(var i=0;i<imagesCache.length;i++){var img=imagesCache[i].image;if(!img.__texturePage)images.push(img)}this.createFromImages(images)},clear:function(){this.createFromImages([])},update:function(invert,padding,width,height){this.allowImagesInvertion=invert;this.padding=padding;if(width<100)width=100;if(height<100)height=100;this.width=width;this.height=height;this.createFromImages(this.images)},createFromImages:function(images){var i;this.scan=new CAAT.GLTextureScanMap(this.width,this.height);this.images=
[];if(this.allowImagesInvertion)for(i=0;i<images.length;i++)images[i].inverted=this.allowImagesInvertion&&images[i].height<images[i].width;var me=this;images.sort(function(a,b){var aarea=a.width*a.height;var barea=b.width*b.height;if(me.criteria==="width")return a.width<b.width?1:a.width>b.width?-1:0;else if(me.criteria==="height")return a.height<b.height?1:a.height>b.height?-1:0;return aarea<barea?1:aarea>barea?-1:0});for(i=0;i<images.length;i++){var img=images[i];this.packImage(img)}},addImage:function(image,
invert,padding){this.allowImagesInvertion=invert;this.padding=padding;this.images.push(image);this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var gl=this.gl;gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D)},deletePage:function(){for(var i=0;i<this.images.length;i++){delete this.images[i].__texturePage;delete this.images[i].__u;delete this.images[i].__v}this.gl.deleteTexture(this.texture)},
toCanvas:function(canvass,outline){canvass=canvass||document.createElement("canvas");canvass.width=this.width;canvass.height=this.height;var ctxx=canvass.getContext("2d");ctxx.fillStyle="rgba(0,0,0,0)";ctxx.fillRect(0,0,this.width,this.height);for(var i=0;i<this.images.length;i++){ctxx.drawImage(!this.images[i].inverted?this.images[i]:CAAT.modules.ImageUtil.prototype.rotate(this.images[i],90),this.images[i].__tx,this.images[i].__ty);if(outline){ctxx.strokeStyle="red";ctxx.strokeRect(this.images[i].__tx,
this.images[i].__ty,this.images[i].__w,this.images[i].__h)}}if(outline){ctxx.strokeStyle="red";ctxx.strokeRect(0,0,this.width,this.height)}return canvass},packImage:function(img){var newWidth,newHeight;if(img.inverted){newWidth=img.height;newHeight=img.width}else{newWidth=img.width;newHeight=img.height}var w=newWidth;var h=newHeight;var mod;if(w&&this.padding){mod=this.padding;if(w+mod<=this.width)w+=mod}if(h&&this.padding){mod=this.padding;if(h+mod<=this.height)h+=mod}var where=this.scan.whereFitsChunk(w,
h);if(null!==where){this.images.push(img);img.__tx=where.x;img.__ty=where.y;img.__u=where.x/this.width;img.__v=where.y/this.height;img.__u1=(where.x+newWidth)/this.width;img.__v1=(where.y+newHeight)/this.height;img.__texturePage=this;img.__w=newWidth;img.__h=newHeight;this.scan.substract(where.x,where.y,w,h)}else CAAT.log("Imagen ",img.src," de tamano ",img.width,img.height," no cabe.")},changeHeuristic:function(criteria){this.criteria=criteria}}})();
(function(){CAAT.GLTexturePageManager=function(){this.pages=[];return this};CAAT.GLTexturePageManager.prototype={pages:null,createPages:function(gl,width,height,imagesCache){var end=false;while(!end){var page=new CAAT.GLTexturePage(width,height);page.create(imagesCache);page.initialize(gl);page.endCreation();this.pages.push(page);end=true;for(var i=0;i<imagesCache.length;i++)if(!imagesCache[i].image.__texturePage){if(imagesCache[i].image.width<=width&&imagesCache[i].image.height<=height)end=false;
break}}},deletePages:function(){for(var i=0;i<this.pages.length;i++)this.pages[i].deletePage();this.pages=null}}})();var HN=HN||{};(function(){HN.GameModes={classic:{fixed_table_size:true,rearrange_on_remove:true,rows_initial:8,columns_initial:8,rows_max:8,columns_max:8,time_policy:-500,minTurnTime:12E3,number_policy:[10,10,10,15,15,15,20,20,25,30,35,40,45,50],name:"classic"},progressive:{fixed_table_size:false,rearrange_on_remove:true,rows_initial:3,columns_initial:3,rows_max:8,columns_max:8,time_policy:0,number_policy:[10,10,10,10,10,15,15,15,15,20,25,30,35,40,45,50],name:"progressive"},respawn:{fixed_table_size:true,rearrange_on_remove:true,
respawn:true,respawn_time:22E3,rows_initial:8,columns_initial:8,rows_max:8,columns_max:8,time_policy:-1E3,initial_map:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0],[0,0,1,1,1,1,0,0],[0,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1]],number_policy:[10,10,10,10,10,15,15,15,15,20,25,30,35,40,45,50],name:"respawn"}}})();
(function(){HN.Brick=function(){return this};HN.Brick.prototype={value:0,color:0,selected:false,removed:false,row:0,column:0,context:null,delegate:null,initialize:function(row,column,context,removed){removed=removed||false;this.row=row;this.column=column;this.selected=false;this.removed=removed;this.color=Math.random()*context.getNumberColors()>>0;this.context=context;this.respawn()},changeSelection:function(){this.selected=!this.selected;this.context.selectionChanged(this)},respawn:function(){this.selected=
false;if(Math.random()>0.3)this.value=4+Math.random()*6>>0;else this.value=1+Math.random()*3>>0;if(this.value<1)this.value=1;else if(this.value>9)this.value=9;if(null!=this.delegate)this.delegate();return this}}})();
(function(){HN.Context=function(){this.eventListener=[];return this};HN.Context.prototype={eventListener:null,gameMode:null,rows:0,columns:0,numNumberColors:0,initialRows:0,initialColumns:0,currentRows:0,currentColumns:0,initialBricks:0,data:null,guessNumber:0,time:0,selectedList:null,status:0,level:0,score:0,turnTime:15E3,turnTimes:[2E4,15E3,1E4],difficulty:0,brickIncrementByDifficulty:[5,10],meters:0,ST_STARTGAME:5,ST_INITIALIZING:0,ST_START_LEVEL:2,ST_RUNNNING:1,ST_LEVEL_RESULT:3,ST_ENDGAME:4,
create:function(maxR,maxC,numNumberColors){this.rows=maxR;this.columns=maxC;this.numNumberColors=numNumberColors;this.data=[];var i,j;for(i=0;i<this.rows;i++){this.data.push([]);for(j=0;j<this.columns;j++)this.data[i].push(new HN.Brick)}return this},setGameMode:function(gameMode){if(gameMode!=this.gameMode){this.gameMode=gameMode;this.initialRows=gameMode.rows_initial;this.initialColumns=gameMode.columns_initial}this.initialize()},getNumberColors:function(){return this.numNumberColors},initialize:function(){this.setStatus(this.ST_STARTGAME);
this.turnTime=this.turnTimes[this.difficulty];this.score=0;this.level=0;this.setAltitude(0);this.currentRows=this.initialRows;this.currentColumns=this.initialColumns;this.nextLevel();return this},getLevelActiveBricks:function(){return this.initialBricks},prepareBricks:function(){var i,j;for(i=0;i<this.rows;i++)for(j=0;j<this.columns;j++)this.data[i][j].initialize(i,j,this,true);if(this.gameMode.initial_map){var im=this.gameMode.initial_map;this.initialBricks=0;for(i=0;i<this.currentRows;i++)for(j=
0;j<this.currentColumns;j++){var removed=true;if(im.length<i)removed=false;else if(im[i].length<j)removed=false;else removed=im[i][j]==0;this.data[i][j].initialize(i,j,this,removed);if(!removed)this.initialBricks++}}else{this.initialBricks=this.currentRows*this.currentColumns;for(i=0;i<this.currentRows;i++)for(j=0;j<this.currentColumns;j++)this.data[i][j].initialize(i,j,this,false)}},nextLevel:function(){this.level++;this.fireEvent("context","levelchange",this.level);this.selectedList=[];if(!this.gameMode.fixed_table_size)if(this.level>
1&&(this.currentRows<this.rows||this.currentColumns<this.columns))if(this.currentRows==this.currentColumns)this.currentColumns++;else this.currentRows++;this.prepareBricks();this.setStatus(this.ST_INITIALIZING);if(this.level>1){this.turnTime-=this.gameMode.time_policy;if(this.gameMode.minTurnTime)if(this.turnTime<this.gameMode.minTurnTime)this.turnTime=this.gameMode.minTurnTime}return this},fireEvent:function(sSource,sEvent,params){var i;for(i=0;i<this.eventListener.length;i++)this.eventListener[i].contextEvent({source:sSource,
event:sEvent,params:params})},addContextListener:function(listener){this.eventListener.push(listener);return this},getBrick:function(row,column){return this.data[row][column]},setStatus:function(status){this.status=status;this.fireEvent("context","status",this.status);if(this.status==this.ST_RUNNNING)this.setGuessNumber()},selectionChanged:function(brick){var i,j;for(i=0;i<this.selectedList.length;i++)if(this.selectedList[i]==brick){this.selectedList.splice(i,1);this.fireEvent("brick","selection",
brick);return}var sum=0;for(i=0;i<this.selectedList.length;i++)sum+=this.selectedList[i].value;sum+=brick.value;var selected;if(sum>this.guessNumber){brick.selected=false;selected=this.selectedList.slice(0);for(i=0;i<this.selectedList.length;i++)this.selectedList[i].selected=false;this.selectedList=[];this.fireEvent("brick","selectionoverflow",selected)}else if(sum==this.guessNumber){this.selectedList.push(brick);selected=this.selectedList.slice(0);for(i=0;i<this.selectedList.length;i++){this.selectedList[i].selected=
false;this.selectedList[i].removed=true}if(this.gameMode.rearrange_on_remove)for(i=0;i<this.selectedList.length;i++){var r=this.selectedList[i].row;var c=this.selectedList[i].column;for(var row=r;row>0;row--){var move=this.data[row-1][c];var to=this.data[row][c];var tmp=move;this.data[row-1][c]=this.data[row][c];this.data[row][c]=tmp;tmp=move.row;move.row=to.row;to.row=tmp;this.fireEvent("brick","rearranged",{fromRow:move.row-1,toRow:move.row,column:c})}}this.selectedList=[];this.fireEvent("brick",
"selection-cleared",selected);this.score+=this.multiplier*(selected.length+1)*(this.difficulty==0?10:20)*selected.length;this.fireEvent("context","score",this);for(i=0;i<this.rows;i++)for(j=0;j<this.columns;j++)if(!this.data[i][j].removed){this.setGuessNumber();return}this.setStatus(this.ST_LEVEL_RESULT)}else{this.selectedList.push(brick);this.fireEvent("brick","selection",brick);this.setMultipliers()}},setGuessNumber:function(){var activeBricks=[];var i,j;for(i=0;i<this.rows;i++)for(j=0;j<this.columns;j++)if(!this.data[i][j].removed)activeBricks.push(this.data[i][j]);
if(activeBricks.length>1)for(i=0;i<activeBricks.length;i++){var rpos0=Math.random()*activeBricks.length>>0;var tmp=activeBricks[i];activeBricks[i]=activeBricks[rpos0];activeBricks[rpos0]=tmp}var sum=0;var diff=this.brickIncrementByDifficulty[this.difficulty];var index__=this.level-1;if(index__>=this.gameMode.number_policy.length)index__=this.gameMode.number_policy.length-1;var min=this.gameMode.number_policy[index__];var max=min+diff;var brickCount=0;if(activeBricks.length==1)sum=activeBricks[0].value;
else if(activeBricks.length==2)sum=activeBricks[0].value+activeBricks[1].value;else{for(i=0;i<activeBricks.length;i++)if(sum+activeBricks[i].value<=max){sum+=activeBricks[i].value;brickCount++}else if(sum>min)break;if(brickCount==1)sum=activeBricks[0].value+activeBricks[1].value}this.guessNumber=sum;this.fireEvent("context","guessnumber",this);this.setMultipliers()},timeUp:function(){this.setStatus(this.ST_ENDGAME)},respawn:function(){var cabenMas=true;var i,j;for(i=0;i<this.currentColumns;i++)if(!this.data[0][i].removed){cabenMas=
false;break}if(!cabenMas){this.setStatus(this.ST_ENDGAME);return}var respawnData=[];for(j=0;j<this.currentColumns;j++){for(i=0;i<this.currentRows;i++)if(!this.data[i][j].removed)break;i--;this.data[i][j].removed=false;this.data[i][j].selected=false;this.data[i][j].respawn();respawnData.push({row:i,column:j})}this.fireEvent("brick","respawn",respawnData)},setMultipliers:function(){if(this.selectedList&&this.selectedList.length>0){var x0=this.selectedList[0].column;var y0=this.selectedList[0].row;var d=
0;var i;for(i=1;i<this.selectedList.length;i++){var x1=this.selectedList[i].column;var y1=this.selectedList[i].row;d+=Math.sqrt((x1-x0)*(x1-x0)+(y1-y0)*(y1-y0));x0=x1;y0=y1}d=d>>0;d=1+d/10>>0;if(d<1)d=1;else if(d>5)d=5;this.multiplier=d}else this.multiplier=0;this.fireEvent("context","multiplier",this)},incrementAltitude:function(increment){this.setAltitude(this.meters+increment)},setAltitude:function(altitude){this.meters=altitude;this.fireEvent("context","altitude",this.meters)}}})();function __CAAT__loadingScene(director){var scene=director.createScene();var TIME=5E3;var time=(new Date).getTime();var background=(new CAAT.ActorContainer).setBackgroundImage(director.getImage("splash0"),true).addBehavior((new CAAT.GenericBehavior).setFrameTime(TIME/2,0).setValues(1,0,null,null,function(value,target,actor){actor.setBackgroundImage(director.getImage("splash1"),true)}));scene.addChild(background);var lading=(new CAAT.Actor).setBackgroundImage(director.getImage("lading"),true).enableEvents(false);
lading.setLocation(director.width-lading.width-10,director.height-lading.height-30);scene.addChild(lading);var rueda=(new CAAT.Actor).setBackgroundImage(director.getImage("rueda"),true).setLocation(lading.x+20,lading.y+10).enableEvents(false);scene.addChild(rueda);var rrb=(new CAAT.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1E3);rueda.addBehavior(rrb.setCycle(true));var starsImage=null;starsImage=(new CAAT.SpriteImage).initialize(director.getImage("stars"),24,6);var T=600;var kfc_i=(new CAAT.Interpolator).createExponentialInInterpolator(2,
false);var mouseStars=function(mouseEvent){for(var i=0;i<3;i++){var offset0=Math.random()*10*(Math.random()<0.5?1:-1)+mouseEvent.point.x;var offset1=Math.random()*10*(Math.random()<0.5?1:-1)+mouseEvent.point.y;var iindex=Math.random()*6>>0;var actorStar=new CAAT.Actor;actorStar.__imageIndex=iindex;actorStar.setBackgroundImage(starsImage.getRef().setAnimationImageIndex([Math.random()*6>>0]),true).setLocation(offset0,offset1).setDiscardable(true).enableEvents(false).setFrameTime(scene.time,T).addBehavior((new CAAT.ScaleBehavior).setFrameTime(scene.time,
T).setValues(1,5,1,5).setInterpolator(kfc_i));if(director.getRenderType()==="CSS")actorStar.addBehavior((new CAAT.AlphaBehavior).setFrameTime(scene.time,T).setValues(1,0.1).setInterpolator(kfc_i));else actorStar.addBehavior((new CAAT.GenericBehavior).setFrameTime(scene.time,T).setValues(1,0.1,null,null,function(value,target,actor){actor.backgroundImage.setAnimationImageIndex([actor.__imageIndex+(23-(23*value>>0))*actor.backgroundImage.getColumns()])}));background.addChild(actorStar)}};background.mouseMove=
mouseStars;background.mouseDrag=mouseStars;scene.loadedImage=function(count,total){if(count==total){var difftime=(new Date).getTime()-time;if(difftime<TIME){difftime=Math.abs(TIME-difftime);if(difftime>TIME)difftime=TIME;scene.createTimer(scene.time,difftime,function(){lading.setOutOfFrameTime();rueda.setOutOfFrameTime();__end_loading(director)})}else __end_loading(director)}};return scene}
function __end_loading(director){director.emptyScenes();director.setImagesCache(director.__next_images);delete director.__next_images;var gardenScene=(new HN.GardenScene).create(director,director.getRenderType()==="CANVAS"?120:0);var gameScene=(new HN.GameScene).create(director,HN.GameModes.respawn);gardenScene.gameScene=gameScene;gameScene.addGameListener(gardenScene);director.easeIn(0,CAAT.Scene.prototype.EASE_TRANSLATE,1E3,false,CAAT.Actor.prototype.ANCHOR_TOP,(new CAAT.Interpolator).createExponentialInOutInterpolator(5,
false))}function createCSS(){var director;if(window.innerWidth>window.innerHeight)director=(new CAAT.Director).initialize(700,500,document.getElementById("game")).setClear(false);else director=(new CAAT.Director).initialize(500,750,document.getElementById("game")).setClear(false);return director}
function createCanvas(){var director;if(window.innerWidth>window.innerHeight)director=(new CAAT.Director).initialize(700,500).setClear(false);else director=(new CAAT.Director).initialize(500,750).setClear(false);return director}
function __Hypernumbers_init(){CAAT.setCoordinateClamping(false);HN.LOWQUALITY=0;var director=createCanvas();HN.director=director;var ni=director.width>director.height;var prefix=typeof __RESOURCE_URL!=="undefined"?__RESOURCE_URL:"";(new CAAT.ImagePreloader).loadImages([{id:"stars",url:prefix+"res/img/stars.png"},{id:"splash0",url:prefix+(ni?"res/splash/splash0.png":"res/splash/splash0-i.png")},{id:"splash1",url:prefix+(ni?"res/splash/splash1.png":"res/splash/splash1-i.png")},{id:"lading",url:prefix+
"res/splash/lading.png"},{id:"rueda",url:prefix+"res/splash/rueda.png"}],function(counter,images){if(counter==images.length){director.setImagesCache(images);var scene_loading=__CAAT__loadingScene(director);(new CAAT.ImagePreloader).loadImages([{id:"smoke",url:prefix+"res/img/humo.png"},{id:"stars",url:prefix+"res/img/stars.png"},{id:"bricks",url:prefix+"res/img/bricks.png"},{id:"buttons",url:prefix+"res/img/botones.png"},{id:"numbers",url:prefix+"res/img/numbers.png"},{id:"numberssmall",url:prefix+
"res/img/numbers_s.png"},{id:"madewith",url:prefix+"res/img/madewith.png"},{id:"background-1",url:prefix+"res/img/fondo1.png"},{id:"background-2",url:prefix+(ni?"res/img/fondo2.png":"res/img/fondo2inv.png")},{id:"background_op",url:prefix+"res/img/gameover.png"},{id:"cloud0",url:prefix+"res/img/nube1.png"},{id:"cloud1",url:prefix+"res/img/nube2.png"},{id:"cloud2",url:prefix+"res/img/nube3.png"},{id:"cloud3",url:prefix+"res/img/nube4.png"},{id:"cloudb0",url:prefix+"res/img/nubefondo1.png"},{id:"cloudb1",
url:prefix+"res/img/nubefondo2.png"},{id:"cloudb2",url:prefix+"res/img/nubefondo3.png"},{id:"cloudb3",url:prefix+"res/img/nubefondo4.png"},{id:"level",url:prefix+"res/img/level.png"},{id:"level-small",url:prefix+"res/img/levelsmall.png"},{id:"boton-salir",url:prefix+"res/img/boton_salir.png"},{id:"points",url:prefix+"res/img/score.png"},{id:"time",url:prefix+"res/img/time.png"},{id:"timeprogress",url:prefix+"res/img/time_progress.png"},{id:"multiplier",url:prefix+(ni?"res/img/x.png":"res/img/xsmall.png")},
{id:"multiplier-star",url:prefix+"res/img/multiplicador.png"},{id:"tweet",url:prefix+"res/img/tweet.png"},{id:"ovni",url:prefix+"res/img/ovni.png"},{id:"logo",url:prefix+"res/img/logo_menu.png"},{id:"levelclear",url:prefix+"res/img/levelcleared.png"},{id:"msg1",url:prefix+"res/img/7.png"},{id:"msg2",url:prefix+"res/img/6.png"},{id:"msg3",url:prefix+"res/img/5.png"},{id:"msg4",url:prefix+"res/img/4.png"},{id:"msg5",url:prefix+"res/img/3.png"},{id:"msg6",url:prefix+"res/img/2.png"},{id:"msg7",url:prefix+
"res/img/1.png"},{id:"info_howto",url:prefix+"res/img/info.png"},{id:"sound",url:prefix+"res/img/sound.png"},{id:"mode-respawn",url:prefix+"res/img/respawn.png"},{id:"mode-progressive",url:prefix+"res/img/progresive.png"},{id:"mode-classic",url:prefix+"res/img/normal_mode.png"},{id:"mode-text",url:prefix+"res/img/textos.png"},{id:"rclock-bg",url:prefix+"res/img/rclock_bg.png"},{id:"rclock-tick",url:prefix+"res/img/rclock_tick.png"},{id:"rclock-arrow",url:prefix+"res/img/rclock_arrow.png"},{id:"bolas",
url:prefix+"res/img/bolas.png"},{id:"info",url:prefix+(ni?"res/big/about.png":"res/big/about-i.png")},{id:"howto",url:prefix+(ni?"res/big/tutorial.png":"res/big/tutorial-i.png")},{id:"target-number",url:prefix+"res/img/target.png"}],function(counter,images){if(counter==images.length){director.__next_images=images;director.addAudio("01",prefix+"res/sound/01.mp3").addAudio("10",prefix+"res/sound/10.mp3").addAudio("11",prefix+"res/sound/11.mp3").addAudio("12",prefix+"res/sound/12.mp3").addAudio("sumamal",
prefix+"res/sound/suma_mal.mp3").addAudio("mostrarpanel",prefix+"res/sound/mostrarpanel.mp3").addAudio("deseleccionar",prefix+"res/sound/deseleccionar.mp3").addAudio("music",prefix+"res/sound/music.mp3")}scene_loading.loadedImage(counter,images.length)})}});CAAT.loop(60)}window.addEventListener("load",__Hypernumbers_init,false);(function(){HN.Grass=function(){return this};HN.Grass.prototype={alto_hierba:0,maxAngle:0,angle:0,coords:null,color:null,offset_control_point:3,curve:null,initialize:function(canvasWidth,canvasHeight,minHeight,maxHeight,angleMax,initialMaxAngle){var sx=Math.floor(Math.random()*canvasWidth);var sy=canvasHeight;var offset_control_x=2;this.alto_hierba=minHeight+Math.random()*maxHeight;this.maxAngle=10+Math.random()*angleMax;this.angle=Math.random()*initialMaxAngle*(Math.random()<0.5?1:-1)*Math.PI/180;
var csx=sx-offset_control_x;var csy=sy-this.alto_hierba/2;var psx=csx;var psy=csy;this.offset_control_point=10;var dx=sx+this.offset_control_point;var dy=sy;this.coords=[sx,sy,csx,csy,psx,psy,dx,dy];this.color=[16+Math.floor(Math.random()*32),100+Math.floor(Math.random()*155),16+Math.floor(Math.random()*32)]},paint:function(ctx,time,ambient){var inc_punta_hierba=Math.sin(time*5.0E-4);var ang=this.angle+Math.PI/2+inc_punta_hierba*Math.PI/180*this.maxAngle*Math.cos(time*2.0E-4);var px=this.coords[0]+
this.offset_control_point+this.alto_hierba*Math.cos(ang);var py=this.coords[1]-this.alto_hierba*Math.sin(ang);ctx.beginPath();ctx.moveTo(this.coords[0],this.coords[1]);ctx.bezierCurveTo(this.coords[0],this.coords[1],this.coords[2],this.coords[3],px,py);ctx.bezierCurveTo(px,py,this.coords[4],this.coords[5],this.coords[6],this.coords[7]);ctx.closePath();ctx.fillStyle="rgb("+Math.floor(this.color[0]*ambient)+","+Math.floor(this.color[1]*ambient)+","+Math.floor(this.color[2]*ambient)+")";ctx.fill()},
paintActorGL:function(director,time,ambient,wmv){if(null==this.curve){this.curve=new CAAT.Bezier;this.__polyLine=new Float32Array(11*2*3)}var inc_punta_hierba=Math.sin(time*5.0E-4);var ang=this.angle+Math.PI/2+inc_punta_hierba*Math.PI/180*this.maxAngle*Math.cos(time*2.0E-4);var px=this.coords[0]+this.offset_control_point+this.alto_hierba*Math.cos(ang);var py=this.coords[1]-this.alto_hierba*Math.sin(ang);var contour=this.curve.setQuadric(this.coords[0],this.coords[1],this.coords[2],this.coords[3],
px,py).getContour(10);var contour2=this.curve.setQuadric(px,py,this.coords[4],this.coords[5],this.coords[6],this.coords[7]).getContour(10);contour=contour.concat(contour2);var pos=0;var z=-director.height/2;for(var i=0;i<contour.length;i++){wmv.transformCoord(contour[i]);this.__polyLine[pos++]=contour[i].x;this.__polyLine[pos++]=contour[i].y;this.__polyLine[pos++]=z}director.glTextureProgram.drawPolylines(this.__polyLine,contour.length,Math.floor(this.color[0]*ambient)/255,Math.floor(this.color[1]*
ambient)/255,Math.floor(this.color[2]*ambient)/255,1,3)}}})();
(function(){HN.Garden=function(){HN.Garden.superclass.constructor.call(this);return this};HN.Garden.prototype={grass:null,ambient:1,stars:null,firefly_radius:10,num_fireflyes:40,num_stars:512,fireflyColor:["#ffff00","#7fff00","#c0c000"],backgroundEnabled:false,initialize:function(ctx,size,maxGrassHeight){this.grass=[];for(var i=0;i<size;i++){var g=new HN.Grass;g.initialize(this.width,this.height,50,maxGrassHeight,20,40);this.grass.push(g)}this.stars=[];for(i=0;i<this.num_stars;i++){this.stars.push(Math.floor(Math.random()*
(this.width-10)+5));this.stars.push(Math.floor(Math.random()*(this.height-10)+5))}if(this.backgroundEnabled)this.lerp(ctx,0,2E3);return this},paint:function(director,time){var ctx=director.ctx;var i,j;if(this.backgroundEnabled){ctx.fillStyle=this.gradient;ctx.fillRect(0,0,this.width,this.height);if(this.ambient<0.3){ctx.globalAlpha=1-(this.ambient-0.05)/0.25;var intensity=1-(this.ambient/2-0.05)/0.25;var c=Math.floor(192*intensity);var strc="rgb("+c+","+c+","+c+")";ctx.strokeStyle=strc;for(j=this.num_fireflyes*
2;j<this.stars.length;j+=2){var inc=1;if(j%3==0)inc=1.5;else if(j%11==0)inc=2.5;this.stars[j]=(this.stars[j]+0.1*inc)%this.width;var y=this.stars[j+1];ctx.strokeRect(this.stars[j],this.stars[j+1],1,1)}}ctx.globalAlpha=1}for(i=0;i<this.num_fireflyes*2;i+=2){ctx.fillStyle=this.fireflyColor[i%3];var angle=Math.PI*2*Math.sin(time*3.0E-4)+i*Math.PI/50;var radius=this.firefly_radius*Math.cos(time*3.0E-4);var fy=this.height-this.height*0.3+0.5*this.stars[i+1]+20*Math.sin(time*3.0E-4)+radius*Math.sin(angle);
if(fy<director.height){ctx.beginPath();ctx.arc(this.width/2+0.5*this.stars[i]+150*Math.cos(time*3.0E-4)+(radius+20*Math.cos(i%5*Math.PI/3600))*Math.cos(angle),fy,2,0,Math.PI*2,false);ctx.fill()}}for(i=0;i<this.grass.length;i++)this.grass[i].paint(ctx,time,this.ambient);if(this.backgroundEnabled)if(time>this.nextLerpTime){this.lerpindex=Math.floor((time-this.nextLerpTime)/this.nextLerpTime);if((time-this.nextLerpTime)%this.nextLerpTime<this.lerpTime)this.lerp(ctx,(time-this.nextLerpTime)%this.nextLerpTime,
this.lerpTime)}},gradient:null,lerpTime:1E4,nextLerpTime:15E3,colors:[[0,63,127,0,63,127,31,95,192,63,160,255],[0,63,127,160,95,127,255,144,224,255,144,0],[0,63,127,0,47,127,0,40,80,0,31,63],[0,63,127,63,47,160,160,31,31,255,127,0]],ambients:[1,0.35,0.05,0.5],lerpindex:0,lerp:function(ctx,time,last){this.gradient=ctx.createLinearGradient(0,0,0,this.height);var i0=this.lerpindex%this.colors.length;var i1=(this.lerpindex+1)%this.colors.length;for(var i=0;i<4;i++){var rgb="rgb(";for(var j=0;j<3;j++){rgb+=
Math.floor((this.colors[i1][i*3+j]-this.colors[i0][i*3+j])*time/last+this.colors[i0][i*3+j]);if(j<2)rgb+=","}rgb+=")";this.gradient.addColorStop(i/3,rgb)}this.ambient=(this.ambients[i1]-this.ambients[i0])*time/last+this.ambients[i0]}};extend(HN.Garden,CAAT.Actor)})();
(function(){HN.Cloud=function(){HN.Cloud.superclass.constructor.call(this);return this};HN.Cloud.prototype={scene:null,setScene:function(scene){this.scene=scene;return this},setupBehavior:function(director){this.setBackgroundImage(director.getImage("cloudb"+(4*Math.random()>>0)));var me=this;var ix0,ix1,iy0,iy1;var from=Math.random();var dw=director.width;var dh=director.height;var ih=this.backgroundImage.height;var iw=this.backgroundImage.width;var t=4E4+5E3*Math.random()*4;ix0=-iw+-iw*2*Math.random();
iy0=dh*Math.random()/2;ix1=dw;iy1=iy0+50*Math.random()/2;var me=this;var pb=(new CAAT.PathBehavior).setPath((new CAAT.Path).setLinear(ix0,iy0,ix1,iy1));this.emptyBehaviorList();this.addBehavior(pb.setFrameTime(this.scene.time,t).addListener({behaviorExpired:function(behavior,time,actor){ix0=-iw+-iw*2*Math.random();iy0=dh*Math.random()/2;ix1=dw;iy1=iy0+50*Math.random()/2;t=4E4+5E3*Math.random()*4;behavior.path.setLinear(ix0,iy0,ix1,iy1);behavior.setTimeOffset(0).setFrameTime(me.scene.time,t)}}).setTimeOffset(Math.random()));
return this}};extend(HN.Cloud,CAAT.Actor)})();
(function(){HN.ScoreItem=function(){return this};HN.ScoreItem.prototype={score:0,level:0,mode:"",date:"",initialize:function(score,level,mode){this.score=score;this.level=level;this.mode=mode;var d=new Date;this.date=""+d.getFullYear()+"/"+this.pad(1+d.getMonth())+"/"+this.pad(d.getDate());return this},pad:function(n){n=""+n;if(n.length==1)n="0"+n;return n}};HN.Scores=function(){return this};HN.Scores.prototype={maxScoreRows:10,scores:null,initialize:function(){var rows=0,i;if(null!=this.scores){rows=
this.scores.length;for(i=0;i<rows;i++){this.setDOM(i+"_1",this.scores[i].score);this.setDOM(i+"_2",this.scores[i].level);this.setDOM(i+"_3",this.scores[i].mode);this.setDOM(i+"_4",this.scores[i].date)}}else this.scores=[];for(i=rows;i<10;i++)for(var j=1;j<=4;j++)this.setDOM(i+"_"+j,"");return this},setDOM:function(elem,value){var dom=document.getElementById(elem);if(null!=dom)dom.innerHTML=value;return this},addScore:function(score,level,mode){while(this.scores.length>=this.maxScoreRows)this.scores.splice(this.scores.length-
1,1);var i=0;for(i=0;i<this.scores.length;i++)if(score>this.scores[i].score)break;this.scores.splice(i,0,(new HN.ScoreItem).initialize(score,level,mode));CAAT.modules.LocalStorage.prototype.save("sumon_scores_1",this.scores);this.initialize();return this},setData:function(){this.scores=CAAT.modules.LocalStorage.prototype.load("sumon_scores_1");return this}}})();
(function(){HN.Ovni=function(director,scene,ovnitrail,id){HN.Ovni.superclass.constructor.call(this);var ovniImage=(new CAAT.SpriteImage).initialize(director.getImage("ovni"),1,2);this.setBackgroundImage(ovniImage.getRef().setAnimationImageIndex([Math.random()*2>>0]));this.enableEvents(false);this.setId(id);setupBehavior(director,scene,ovnitrail,this);return this};HN.Ovni.prototype={animationName:null,__index:0,nextAnimationName:function(){this.animationName=this.getId()+this.__index++;return this.animationName},
getAnimationName:function(){return this.animationName}};function setupBehavior(director,scene,ovnitrail,actor){var smokeImage;smokeImage=(new CAAT.SpriteImage).initialize(director.getImage("smoke"),32,1);var TT=1E3;if(director.glEnabled)TT=6E3;var path=(new CAAT.Path).setCubic(Math.random()*director.width,Math.random()*director.height,Math.random()*director.width,Math.random()*director.height,Math.random()*director.width,Math.random()*director.height,Math.random()*director.width,Math.random()*director.height);
var pb=(new CAAT.PathBehavior).setPath(path).setFrameTime(scene.time,3E3+Math.random()*3E3).addListener({prevTime:-1,smokeTime:TT,nextSmokeTime:100,behaviorExpired:function(behaviour,time){var endCoord=behaviour.path.endCurvePosition();behaviour.setPath((new CAAT.Path).setCubic(endCoord.x,endCoord.y,Math.random()*director.width,Math.random()*director.height,Math.random()*director.width,Math.random()*director.height,Math.random()*director.width,Math.random()*director.height));behaviour.setFrameTime(scene.time,
3E3+Math.random()*3E3)},behaviorApplied:function(behavior,time,normalizedTime,actor,value){if(-1==this.prevTime||time-this.prevTime>=this.nextSmokeTime){var img=smokeImage;var offset0=Math.random()*10*(Math.random()<0.5?1:-1);var offset1=Math.random()*10*(Math.random()<0.5?1:-1);var humo=(new CAAT.Actor).setBackgroundImage(smokeImage.getRef().setAnimationImageIndex([0])).setLocation(offset0+actor.x+actor.width/2-img.singleWidth/2,offset1+actor.y+actor.height/2-img.singleHeight/2).setDiscardable(true).enableEvents(false).setFrameTime(time,
this.smokeTime).addBehavior((new CAAT.ScaleBehavior).setFrameTime(time,this.smokeTime).setValues(0.5,1.5,0.5,1.5));humo.addBehavior((new CAAT.GenericBehavior).setFrameTime(time,this.smokeTime).setValues(1,0,null,null,function(value,target,actor){var v=31-(value*31>>0);if(v!==actor.backgroundImage.animationImageIndex[0])actor.setAnimationImageIndex([v])}));ovnitrail.addChild(humo);this.prevTime=time}}});actor.addBehavior(pb)}extend(HN.Ovni,CAAT.Actor)})();
(function(){HN.GardenScene=function(){if(CAAT.browser!=="iOS")this.scores=(new HN.Scores).setData().initialize();return this};HN.GardenScene.prototype={gameScene:null,directorScene:null,director:null,buttonImage:null,scores:null,music:null,sound:null,createClouds:function(){for(var i=0;i<5;i++){var cl=(new HN.Cloud).setId("cloud"+i).setScene(this.directorScene).setupBehavior(this.director);this.directorScene.addChild(cl)}},createModeButtons:function(){var me=this;var m=[];m.push((new CAAT.SpriteImage).initialize(me.director.getImage("mode-classic"),
1,3));m.push((new CAAT.SpriteImage).initialize(me.director.getImage("mode-progressive"),1,3));m.push((new CAAT.SpriteImage).initialize(me.director.getImage("mode-respawn"),1,3));var modes=[HN.GameModes.classic,HN.GameModes.progressive,HN.GameModes.respawn];var i,w=0;for(i=0;i<m.length;i++)w=Math.max(w,m[i].singleWidth);var margin=20;w+=margin;var dw=(me.director.width-w*m.length)/2+margin/2;function createb(index){var text=(new CAAT.SpriteImage).initialize(me.director.getImage("mode-text"),1,3).setAnimationImageIndex([index]);
var c=(new CAAT.ActorContainer).create().setBounds(dw+w*index,me.director.width>me.director.height?me.director.height/2-10:me.director.height/2-100,Math.max(m[index].singleWidth,text.singleWidth),m[index].singleWidth+text.singleHeight);var b=(new CAAT.Actor).setAsButton(m[index],0,1,2,0,function(){me.director.audioPlay("11");me.startGame(me.director,0,modes[index])}).setBounds((c.width-m[index].singleWidth)/2,0,m[index].singleWidth,m[index].singleHeight);var t=(new CAAT.Actor).setBackgroundImage(text).setBounds((c.width-
text.singleWidth)/2,b.height,text.singleWidth,text.singleHeight);c.addChild(b);c.addChild(t);return c}this.directorScene.addChild(createb(0));this.directorScene.addChild(createb(1));this.directorScene.addChild(createb(2))},createHowtoButton:function(info_howto_ci){var director=this.director;var ihw=info_howto_ci.singleWidth;var ihh=info_howto_ci.singleHeight;var me=this;var _howto=(new CAAT.Actor).setBackgroundImage((new CAAT.SpriteImage).initialize(director.getImage("howto"),1,1)).setOutOfFrameTime().setAlpha(0.9);
var pbOut=(new CAAT.PathBehavior).setValues((new CAAT.Path).setLinear(_howto.x,0,700,0)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator(false)).addListener({behaviorExpired:function(behavior,time,actor){_howto.setOutOfFrameTime()}});var pbIn=(new CAAT.PathBehavior).setValues((new CAAT.Path).setLinear(700,0,0,0)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator(false));if(CAAT.CSS3){CAAT.CSS.registerKeyframes({name:"HowtoIn",behavior:pbIn,size:100});CAAT.CSS.registerKeyframes({name:"HowtoOut",
behavior:pbOut,size:100});pbIn.setValueApplication(false);pbOut.setValueApplication(false)}_howto.mouseClick=function(e){_howto.emptyBehaviorList().setFrameTime(me.directorScene.time,Number.MAX_VALUE).addBehavior(pbOut.setFrameTime(me.directorScene.time,1E3));if(CAAT.CSS3)CAAT.CSS.applyKeyframe(_howto.domElement,"HowtoOut",1E3)};var howto=(new CAAT.Actor).setAsButton(info_howto_ci.getRef(),3,4,5,3,function(){director.audioPlay("11");_howto.emptyBehaviorList().setFrameTime(me.directorScene.time,Number.MAX_VALUE).addBehavior(pbIn.setFrameTime(me.directorScene.time,
1E3));if(CAAT.CSS3)CAAT.CSS.applyKeyframe(_howto.domElement,"HowtoIn",1E3)}).setBounds(10,director.height-10-ihh-ihh-5,ihw,ihh);return{howto:howto,howtod:_howto}},createInfoButton:function(info_howto_ci){var director=this.director;var ihw=info_howto_ci.singleWidth;var ihh=info_howto_ci.singleHeight;var me=this;var _info=(new CAAT.Actor).setBackgroundImage((new CAAT.SpriteImage).initialize(director.getImage("info"),1,1)).setOutOfFrameTime().setAlpha(0.9);var pbOut=(new CAAT.PathBehavior).setValues((new CAAT.Path).setLinear(_info.x,
0,-700,0)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator(false)).addListener({behaviorExpired:function(behavior,time,actor){_info.setOutOfFrameTime()}});var pbIn=(new CAAT.PathBehavior).setFrameTime(me.directorScene.time,1E3).setValues((new CAAT.Path).setLinear(-700,0,0,0)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator(false));if(CAAT.CSS3){CAAT.CSS.registerKeyframes({name:"infoIn",behavior:pbIn,size:100});CAAT.CSS.registerKeyframes({name:"infoOut",behavior:pbOut,
size:100});pbIn.setValueApplication(false);pbOut.setValueApplication(false)}_info.mouseClick=function(e){_info.emptyBehaviorList().setFrameTime(me.directorScene.time,Number.MAX_VALUE).addBehavior(pbOut.setFrameTime(me.directorScene.time,1E3));if(CAAT.CSS3)CAAT.CSS.applyKeyframe(_info.domElement,"infoOut",1E3)};var info=(new CAAT.Actor).setAsButton(info_howto_ci.getRef(),0,1,2,0,function(button){director.audioPlay("11");_info.emptyBehaviorList().setFrameTime(me.directorScene.time,Number.MAX_VALUE).addBehavior(pbIn.setFrameTime(me.directorScene.time,
1E3));if(CAAT.CSS3)CAAT.CSS.applyKeyframe(_info.domElement,"infoIn",1E3)}).setBounds(10,this.director.height-10-ihh,ihw,ihh);return{info:info,infod:_info}},create:function(director,gardenSize){director.audioLoop("music");this.director=director;this.directorScene=director.createScene();var dw=director.width;var dh=director.height;var me=this;this.directorScene.activated=function(){me.prepareSound()};var imgb=director.getImage("background-2");this.directorScene.addChild((new CAAT.Actor).setBounds(0,
0,dw,dh).setBackgroundImage(imgb));this.createClouds();var ovnitrail=(new CAAT.ActorContainer).create().setBounds(0,0,dw,dh);this.directorScene.addChild(ovnitrail);for(var i=0;i<2;i++)this.directorScene.addChild(new HN.Ovni(director,this.directorScene,ovnitrail,"ovni"+i));if(gardenSize>0)this.directorScene.addChild((new HN.Garden).create().setBounds(0,0,dw,dh).initialize(director.ctx,gardenSize,dh*0.5));this.buttonImage=(new CAAT.SpriteImage).initialize(director.getImage("buttons"),7,3);var bw=this.buttonImage.singleWidth;
var bh=this.buttonImage.singleHeight;var numButtons=4;var yGap=10;var scores=null;if(false&&CAAT.browser!=="iOS")scores=(new CAAT.Actor).setAsButton(this.buttonImage.getRef(),18,19,20,18,function(){director.audioPlay("11")}).setBounds(dw-bw-10,dh-bh-10,bw,bh);this.soundControls(director);this.createModeButtons();if(false&&CAAT.browser!=="iOS")this.directorScene.addChild(scores);var logoi=director.getImage("logo");var logo=(new CAAT.Actor).setBackgroundImage(logoi).enableEvents(false);logo.setLocation((dw-
logo.width)/2,-10);if(director.width<director.height)logo.setBackgroundImage(logoi,false).setSize(logoi.width*0.8,logoi.height*0.8).setImageTransformation(CAAT.SpriteImage.prototype.TR_FIXED_TO_SIZE);this.directorScene.addChild(logo);var madeWith=new CAAT.Actor;var madeWithCI=(new CAAT.SpriteImage).initialize(director.getImage("madewith"),1,3);if(CAAT.browser!=="iOS")madeWith.setAsButton(madeWithCI,0,1,2,0,function(button){window.open("http://labs.hyperandroid.com","Hyperandroid")});else madeWith.setBackgroundImage(madeWithCI,
true);madeWith.setLocation(dw-(director.width>director.height?100:madeWithCI.singleWidth),0);this.directorScene.addChild(madeWith);var info_howto_ci=(new CAAT.SpriteImage).initialize(director.getImage("info_howto"),2,3);var info=this.createInfoButton(info_howto_ci);var howto=this.createHowtoButton(info_howto_ci);this.directorScene.addChild(howto.howto);this.directorScene.addChild(info.info);this.directorScene.addChild(howto.howtod);this.directorScene.addChild(info.infod);if(director.width<director.height)CAAT.modules.LayoutUtils.row(this.directorScene,
[info.info,howto.howto],{padding_left:195,padding_right:195,top:director.height/2+100});this.numbersImageSmall=(new CAAT.SpriteImage).initialize(director.getImage("numberssmall"),1,10);var me=this;var C=20;var count=0;var fpsc=0;var fps=(new CAAT.Actor).setBounds(0,0,120,40);fps.__fps=0;fps.paintActor=function(director,time){this.invalidate();CAAT.Actor.prototype.__paintActor.call(this,director,time);fpsc+=CAAT.FRAME_TIME;count++;if(!(count%C)){this.__fps=C*1E3/fpsc>>0;fpsc=0;count=0}this.__fps=""+
this.__fps;var ctx=director.ctx;var im=me.numbersImageSmall;ctx.fillStyle="rgb(32,32,32)";ctx.fillRect(0,0,this.__fps.length*im.singleWidth+10,10+im.singleHeight);for(var i=0;i<this.__fps.length;i++){var c=this.__fps.charAt(i);c=parseInt(c,10);if(c>=0&&c<=9){im.setSpriteIndex(c);im.paint(director,0,i*im.singleWidth+5,5)}}};this.directorScene.addChild(fps);return this},soundControls:function(director){var ci=(new CAAT.SpriteImage).initialize(director.getImage("sound"),2,3);var dw=director.width;var dh=
director.height;var music=(new CAAT.Actor).setAsButton(ci.getRef(),0,1,0,0,function(button){director.setMusicEnabled(!director.audioManager.isMusicEnabled());if(director.isMusicEnabled())button.setButtonImageIndex(0,1,0,0);else button.setButtonImageIndex(2,2,2,2)}).setBounds(dw-ci.singleWidth-2,2,ci.singleWidth,ci.singleHeight);var sound=(new CAAT.Actor).setAsButton(ci.getRef(),3,4,3,3,function(button){director.setSoundEffectsEnabled(!director.audioManager.isSoundEffectsEnabled());if(director.isSoundEffectsEnabled())button.setButtonImageIndex(3,
4,3,3);else button.setButtonImageIndex(5,5,5,5)}).setBounds(dw-ci.singleWidth-2,2+2+ci.singleHeight,ci.singleWidth,ci.singleHeight);music.prepare=function(){if(director.audioManager.isMusicEnabled())this.setButtonImageIndex(0,1,0,0);else this.setButtonImageIndex(2,2,2,2)};sound.prepare=function(){if(director.audioManager.isSoundEffectsEnabled())this.setButtonImageIndex(3,4,3,3);else this.setButtonImageIndex(5,5,5,5)};this.directorScene.addChild(sound);this.directorScene.addChild(music);if(director.width<
director.height)CAAT.modules.LayoutUtils.row(this.directorScene,[music,sound],{padding_left:195,padding_right:195,top:director.height/2+150});this.music=music;this.sound=sound},prepareSound:function(){try{this.sound.prepare();this.music.prepare()}catch(e){}},startGame:function(director,level,gameMode){this.gameScene.setDifficulty(level);this.gameScene.prepareSceneIn(gameMode);director.easeInOut(1,CAAT.Scene.EASE_TRANSLATE,CAAT.Actor.prototype.ANCHOR_TOP,0,CAAT.Scene.EASE_TRANSLATE,CAAT.Actor.prototype.ANCHOR_BOTTOM,
1E3,false,(new CAAT.Interpolator).createExponentialInOutInterpolator(3,false),(new CAAT.Interpolator).createExponentialInOutInterpolator(3,false))},gameEvent:function(type,data){if(CAAT.browser!=="iOS")this.scores.addScore(data.score,data.level,data.gameMode)}}})();(function(){HN.BrickActor=function(){HN.BrickActor.superclass.constructor.call(this);this.sb=(new CAAT.ScaleBehavior).setFrameTime(-1,0).setValues(1,1);this.addBehavior(this.sb);this.rb=(new CAAT.RotateBehavior).setFrameTime(-1,0).setValues(0,0);this.addBehavior(this.rb);this.pb=(new CAAT.PathBehavior).setFrameTime(-1,0);this.addBehavior(this.pb);this.ab=(new CAAT.AlphaBehavior).setFrameTime(-1,0).setValues(1);this.addBehavior(this.ab);return this};HN.BrickActor.status={REGULAR:0,FALLING:1,CLEARED:2};
HN.BrickActor.prototype={timeOver:250,timeSelection:1E3,timeRespawn:1500,timeRearrange:1500,timeOverflow:200,timeCleared:800,brick:null,status:0,ab:null,sb:null,rb:null,pb:null,initialize:function(numberImage,brick){var tw=numberImage.singleWidth;var th=numberImage.singleHeight;this.setSize(tw,th);this.setBackgroundImage(numberImage.getRef(),true);this.brick=brick;var me=this;brick.delegate=function(){me.setSpriteIndex(me.brick.value+numberImage.columns*me.brick.color)};return this},initializeForPlay:function(brickPosition,
animationStartTime,animationDuration){var brickActor=this;brickActor.setLocation(brickPosition.x,brickPosition.y).setScale(0.01,0.01);brickActor.sb.setValues(0.01,1,0.01,1).setInterpolator((new CAAT.Interpolator).createElasticOutInterpolator(1.1,0.1,false)).setFrameTime(animationStartTime,animationDuration)},setStatus:function(st){this.status=st;return this},mouseEnter:function(mouseEvent){if(this.brick.selected)return;this.parent.setZOrder(this,Number.MAX_VALUE);this.sb.setFrameTime(this.time,this.timeOver).setValues(1,
1.2,1,1.2).setPingPong();if(CAAT.browser!=="iOS")CAAT.setCursor("pointer")},mouseExit:function(mouseEvent){if(CAAT.browser!=="iOS")CAAT.setCursor("default")},mouseDown:function(mouseEvent){this.brick.changeSelection()},toString:function(){return"HN.Brick "+this.brick.row+","+this.brick.column},reset:function(){this.resetAlpha().resetRotate().resetScale().resetTransform();this.alpha=1;return this},resetBehavior:function(b,p1,p2){b.emptyListenerList();b.setCycle(false);b.setInterpolator((new CAAT.Interpolator).createLinearInterpolator());
b.setFrameTime(-1,0);if(p1&&p2)b.setValues(p1,p2)},resetAlpha:function(){this.resetBehavior(this.ab,1,1);return this},resetScale:function(){this.resetBehavior(this.sb,1,1);return this},resetRotate:function(){this.resetBehavior(this.rb,0,2*Math.PI);return this},resetPath:function(){this.resetBehavior(this.pb);return this},resetBehaviors:function(){this.resetAlpha();this.resetScale();this.resetRotate();this.resetPath();return this},setSelected:function(){this.sb.setValues(1,0.65,1,0.65).setFrameTime(this.time,
this.timeSelection).setPingPong().setCycle(true);this.ab.setValues(0.75,0.25).setFrameTime(this.time,this.timeSelection).setPingPong().setCycle(true)},set:function(){this.status=HN.BrickActor.status.REGULAR;this.enableEvents(true);this.reset()},respawn:function(x,y){this.reset().enableEvents(true).setFrameTime(this.time,Number.MAX_VALUE).resetTransform().setAlpha(1).setStatus(HN.BrickActor.status.FALLING);this.pb.emptyListenerList().setFrameTime(this.time,this.timeRespawn+this.brick.row*50).setPath((new CAAT.LinearPath).setInitialPosition(x,
-this.height-(Math.random()*100>>0)).setFinalPosition(x,y)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator()).addListener({behaviorApplied:function(){},behaviorExpired:function(behavior,time,actor){actor.setStatus(HN.BrickActor.status.REGULAR)}})},rearrange:function(x,y){if(this.status===HN.BrickActor.status.CLEARED)return;this.setStatus(HN.BrickActor.status.FALLING);this.pb.emptyListenerList().setFrameTime(this.time+this.brick.column*50,this.timeRearrange).setPath((new CAAT.LinearPath).setInitialPosition(this.x,
this.y).setFinalPosition(x,y)).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator()).addListener({behaviorApplied:function(){},behaviorExpired:function(behavior,time,actor){actor.setStatus(HN.BrickActor.status.REGULAR)}})},selectionOverflow:function(){if(this.status===HN.BrickActor.status.REGULAR){var signo=Math.random()<0.5?1:-1;this.pb.emptyListenerList().setFrameTime(this.time,this.timeOverflow).setPath((new CAAT.Path).beginPath(this.x,this.y).addLineTo(this.x+signo*(5+5*Math.random()),
this.y).addLineTo(this.x-signo*(5+5*Math.random()),this.y).endPath()).setPingPong()}},selectionCleared:function(scene,maxHeight){this.setStatus(HN.BrickActor.status.CLEARED);var signo=Math.random()<0.5?1:-1;var offset=50+Math.random()*30;var actor=this;this.enableEvents(false).setScale(1.5,1.5);this.pb.emptyListenerList().setFrameTime(this.time,this.timeCleared).setPath((new CAAT.Path).beginPath(this.x,this.y).addQuadricTo(this.x+offset*signo,this.y-300,this.x+offset*signo*2,this.y+maxHeight+20).endPath());
if(!HN.LOWQUALITY)this.pb.addListener({behaviorExpired:function(behavior,time,actor){actor.setExpired(true)},behaviorApplied:function(behavior,time,normalizedTime,actor,value){for(var i=0;i<(CAAT.browser==="iOS"?1:3);i++){var offset0=Math.random()*10*(Math.random()<0.5?1:-1);var offset1=Math.random()*10*(Math.random()<0.5?1:-1);if(scene.fallingStarCache.length>0){var actor2=scene.fallingStarCache.shift();if(!actor2.domParent){actor2.setAnimationImageIndex([Math.random()*6>>0]).setFrameTime(actor.time,
400).setLocation(offset0+actor.x+actor.width/2,offset1+actor.y);actor2.__parent.addChild(actor2);actor2.getBehavior("__alpha").setFrameTime(actor.time,400)}}}}});this.pb.setInterpolator((new CAAT.Interpolator).createLinearInterpolator(false,false));this.rb.setFrameTime(this.time,this.timeCleared).setValues(0,(Math.PI+Math.random()*Math.PI*2)*(Math.random()<0.5?1:-1));this.ab.setFrameTime(this.time,this.timeCleared).setValues(1,0.25)}};extend(HN.BrickActor,CAAT.Actor)})();
(function(){HN.RespawnClockActor=function(){HN.RespawnClockActor.superclass.constructor.call(this);this.ticks=[];return this};HN.RespawnClockActor.prototype={ticks:null,respawnTime:1E4,scene:null,context:null,arrow:null,enabled:false,initialize:function(director,scene,context){this.scene=scene;this.context=context;var itick=director.getImage("rclock-tick");var itickci;itickci=(new CAAT.SpriteImage).initialize(itick,16,1);var ibg=director.getImage("rclock-bg");var iarrow=director.getImage("rclock-arrow");
var me=this;this.setSize(64,64);var bg=(new CAAT.Actor).setBackgroundImage(ibg,true).setLocation((this.width-ibg.width)/2,(this.height-ibg.height)/2);this.addChild(bg);var NTicks=12;for(var i=0;i<NTicks;i++){var tick=(new CAAT.Actor).setBackgroundImage(itickci.getRef(),true).setLocation(this.width/2+29*Math.cos(-Math.PI/2+i*2*Math.PI/NTicks)-itick.width/2,this.height/2+29*Math.sin(-Math.PI/2+i*2*Math.PI/NTicks)-itick.width/2);this.addChild(tick);this.ticks.push(tick);var cb=(new CAAT.ContainerBehavior).setOutOfFrameTime().addBehavior((new CAAT.ScaleBehavior).setFrameTime(i*
this.respawnTime/NTicks,300).setValues(1,3,1,3));cb.addBehavior((new CAAT.GenericBehavior).setFrameTime(i*this.respawnTime/NTicks,300).setValues(1,0,null,null,function(value,target,actor){actor.setAnimationImageIndex([15-(value*15>>0)])}));tick.addBehavior(cb)}var flecha=(new CAAT.Actor).setBackgroundImage(iarrow,true);flecha.setLocation((this.width-flecha.width)/2,this.height/2-23-0.5);this.addChild(flecha);flecha.addBehavior((new CAAT.RotateBehavior).setOutOfFrameTime().setValues(0,2*Math.PI,0.5,
23/flecha.height*100/100).addListener({behaviorExpired:function(behavior,time,actor){me.resetTimer();me.context.respawn()},behaviorApplied:function(behavior,time,normalizedTime,actor,value){}}));this.arrow=flecha;return this},resetTimer:function(){var NTicks=this.ticks.length;for(var i=0;i<NTicks;i++){this.ticks[i].resetTransform().setAnimationImageIndex([0]);this.ticks[i].behaviorList[0].setFrameTime(this.scene.time,this.respawnTime);this.ticks[i].behaviorList[0].behaviors[0].setFrameTime(i*this.respawnTime/
NTicks,300);this.ticks[i].behaviorList[0].behaviors[1].setFrameTime(i*this.respawnTime/NTicks,300)}this.arrow.behaviorList[0].setFrameTime(this.scene.time,this.respawnTime)},stopTimer:function(){for(var i=0;i<this.ticks.length;i++){this.ticks[i].resetTransform();this.ticks[i].behaviorList[0].setOutOfFrameTime()}this.arrow.behaviorList[0].setOutOfFrameTime()},contextEvent:function(event){if(!this.enabled)return;if(event.event=="status")if(event.params==HN.Context.prototype.ST_RUNNNING)this.resetTimer();
else this.stopTimer()},enable:function(enabled,respawnTime){this.respawnTime=respawnTime;this.enabled=enabled;if(enabled)this.setFrameTime(0,Number.MAX_VALUE);else this.setOutOfFrameTime()}};extend(HN.RespawnClockActor,CAAT.ActorContainer)})();
(function(){HN.GuessNumberActor=function(){HN.GuessNumberActor.superclass.constructor.call(this);this.actors=[];this.setGlobalAlpha(true);return this};HN.GuessNumberActor.prototype={guessNumber:0,numbersImage:null,offsetX:0,offsetY:0,numbers:null,tmpnumbers:null,container:null,actors:null,setNumbersImage:function(image,bg){this.setBackgroundImage(bg);this.numbersImage=image;this.container=(new CAAT.ActorContainer).setBounds(10,0,this.width,this.height);this.addChild(this.container);this.offsetX=(this.width-
2*(image.singleWidth-30))/2;this.offsetY=10+(this.height-image.singleHeight)/2;for(var i=0;i<2;i++){var digit=(new CAAT.Actor).setBackgroundImage(image.getRef(),true).setLocation(this.offsetX,this.offsetY).setVisible(false);this.actors.push(digit);this.container.addChild(digit).setGlobalAlpha(true)}return this},contextEvent:function(event){var i;if(event.source=="context")if(event.event=="guessnumber"){var me=this;me.guessNumber=event.params.guessNumber;me.numbers=[];var snumber=me.guessNumber.toString();
if(snumber.length===1)snumber="0"+snumber;me.offsetX=10;me.offsetY=(me.height-me.numbersImage.singleHeight)/2;var i;for(i=0;i<snumber.length;i++){me.numbers[i]=parseInt(snumber.charAt(i));this.actors[i].setLocation(me.offsetX+i*(me.numbersImage.singleWidth-30),this.actors[i].y);this.actors[i].setVisible(true)}if(null==me.tmpnumbers){for(i=0;i<snumber.length;i++)this.actors[i].setAnimationImageIndex([this.numbers[i]]);this.container.emptyBehaviorList();this.container.addBehavior((new CAAT.AlphaBehavior).setFrameTime(this.time,
250).setValues(0,1).setId(1E3));me.tmpnumbers=me.numbers}else{this.container.emptyBehaviorList();this.container.addBehavior((new CAAT.AlphaBehavior).setFrameTime(this.time,250).setValues(1,0).addListener({behaviorExpired:function(behavior,time,actor){for(i=0;i<snumber.length;i++)me.actors[i].setAnimationImageIndex([me.numbers[i]]);actor.emptyBehaviorList();actor.addBehavior((new CAAT.AlphaBehavior).setFrameTime(me.time,250).setValues(0,1))},behaviorApplied:function(behavior,time,normalizedTime,actor,
value){}}))}}else if(event.event=="status")if(event.params!=HN.Context.prototype.ST_RUNNNING){this.numbers=null;this.tmpnumbers=null}}};extend(HN.GuessNumberActor,CAAT.ActorContainer,null)})();
(function(){HN.Chrono=function(){HN.Chrono.superclass.constructor.call(this);this.actorventana=new CAAT.Actor;this.actorcrono=(new CAAT.Actor).setLocation(14,18);this.addChild(this.actorcrono);this.addChild(this.actorventana);return this};HN.Chrono.prototype={maxTime:0,elapsedTime:0,actorventana:null,actorcrono:null,progressHole:160,setImages:function(background,progress){this.actorventana.setBackgroundImage(background,true);this.actorcrono.setBackgroundImage(progress,true);this.setSize(this.actorventana.width,
this.actorventana.height);this.actorcrono.setImageTransformation(CAAT.SpriteImage.prototype.TR_FIXED_TO_SIZE);return this},animate:function(director,time){var size=this.maxTime!=0?this.elapsedTime/this.maxTime*this.progressHole:0;this.actorcrono.setSize(this.progressHole-size,this.actorcrono.height);return HN.Chrono.superclass.animate.call(this,director,time)},tick:function(iElapsedTime,maxTime){this.maxTime=maxTime;this.elapsedTime=iElapsedTime},contextEvent:function(event){if(event.source=="context"&&
event.event=="status")if(event.params==HN.Context.prototype.ST_ENDGAME){this.maxTime=0;this.elapsedTime=1E3}}};extend(HN.Chrono,CAAT.ActorContainer)})();
(function(){HN.SelectionPath=function(director){HN.SelectionPath.superclass.constructor.call(this);this.coords=[];this.particles=[];this.fillStyle=null;this.bolasImage=(new CAAT.SpriteImage).initialize(director.getImage("bolas"),1,8);this.director=director;return this};HN.SelectionPath.prototype={coords:null,path:null,pathMeasure:null,particles:null,particlesPerSegment:10,traversingPathTime:3E3,context:null,bolasImage:null,director:null,initialize:function(){this.coords=[];this.path=null;this.pathMeasure=
null},setup:function(context,brickActors){var i;this.context=context;this.brickActors=brickActors;this.coords=[];if(0==context.selectedList.length){this.initialize();return}var expectedParticleCount=this.particlesPerSegment*(context.selectedList.length-1);if(this.particles.length>expectedParticleCount)this.particles.splice(expectedParticleCount,this.particles.length-expectedParticleCount);else while(this.particles.length<expectedParticleCount)this.particles.push(context.selectedList.length*this.traversingPathTime+
this.traversingPathTime*Math.random())},setupPath:function(){this.coords=[];if(this.context.selectedList.length){var numberWidth=this.brickActors[0][0].width;var numberHeight=this.brickActors[0][0].height;var offsetX=(this.context.columns-this.context.currentColumns)/2*numberWidth;var offsetY=(this.context.rows-this.context.currentRows)/2*numberHeight;for(i=0;i<this.context.selectedList.length;i++){var brick=this.context.selectedList[i];var brickActor=this.brickActors[brick.row][brick.column];this.coords.push({x:brickActor.x+
brickActor.width/2,y:brickActor.y+brickActor.height/2})}this.path=new CAAT.Path;this.path.beginPath(this.coords[0].x,this.coords[0].y);for(i=1;i<this.context.selectedList.length;i++)this.path.addLineTo(this.coords[i].x,this.coords[i].y);this.path.endPath();this.pathMeasure=(new CAAT.PathBehavior).setPath(this.path).setFrameTime(0,this.traversingPathTime*this.context.selectedList.length).setCycle(true)}},paint:function(director,time){if(null!=this.context&&0!=this.context.selectedList.length){var i;
this.setupPath();var ctx=director.ctx;ctx.beginPath();var i;for(i=0;i<this.coords.length;i++)ctx.lineTo(this.coords[i].x,this.coords[i].y);ctx.strokeStyle="#ffff00";ctx.lineCap="round";ctx.lineJoin="round";for(i=2;i<=(CAAT.browser==="iOS"?2:8);i+=2){ctx.lineWidth=i;ctx.globalAlpha=0.5-i/8/3;ctx.stroke()}if(this.pathMeasure){var pos;for(i=0;i<this.particles.length;i++){pos=this.pathMeasure.positionOnTime((this.particles[i]+time)*(1+i%3*0.33));this.bolasImage.setSpriteIndex(i%8);this.bolasImage.paint(director,
0,pos.x-4,pos.y-4)}}}},contextEvent:function(event){},paintActorGL:function(director,time){if(null!=this.context&&this.context.selectedList.length>1){this.setupPath();if(null===this.coords||0===this.coords.length)return;director.glFlush();var i,pos=0,z=0,point=new CAAT.Point,m=this.worldModelViewMatrix,cc=director.coords,ccthis=this.coords,pa=this.particles;for(i=0;i<ccthis.length;i++){point.set(ccthis[i].x,ccthis[i].y,0);m.transformCoord(point);cc[pos++]=point.x;cc[pos++]=point.y;cc[pos++]=z}for(i=
2;i<=8;i+=2)director.glTextureProgram.drawPolylines(cc,ccthis.length,1,1,0,0.5-i/8/3,i);pos=0;for(i=0;i<pa.length;i++){ppos=this.pathMeasure.positionOnTime((pa[i]+time)*(1+i%3*0.33));point.set(ppos.x,ppos.y,0);m.transformCoord(point);cc[pos++]=point.x-3;cc[pos++]=point.y-3;cc[pos++]=z;cc[pos++]=point.x+3;cc[pos++]=point.y+3;cc[pos++]=z}director.glTextureProgram.drawLines(cc,pa.length,1,1,1,0.3,7)}}};extend(HN.SelectionPath,CAAT.Actor)})();
(function(){HN.ScoreActor=function(){HN.ScoreActor.superclass.constructor.call(this);return this};HN.ScoreActor.prototype={numDigits:6,incrementScore:0,maxScore:0,minScore:0,currentScore:0,numbers:null,startTime:0,interpolator:null,scoreDuration:2E3,font:null,FONT_CORRECTION:0.6,reset:function(){this.currentScore=0;this.maxScore=0;this.minScore=0;this.currentScore=0;this.setScore()},initialize:function(font,background){var i;this.font=font;this.interpolator=(new CAAT.Interpolator).createExponentialInOutInterpolator(2,
false);this.setBackgroundImage(background,true);for(i=0;i<this.numDigits;i++){var actor=(new CAAT.Actor).setBackgroundImage(font.getRef(),true).setLocation(((this.width-this.numDigits*this.font.singleWidth*this.FONT_CORRECTION)/2>>0)+i*this.font.singleWidth*this.FONT_CORRECTION-5,12).setScale(this.FONT_CORRECTION,this.FONT_CORRECTION);this.addChild(actor)}return this},contextEvent:function(event){if(event.source=="context")if(event.event=="score"){this.maxScore=event.params.score;this.minScore=this.currentScore;
this.incrementScore=this.maxScore-this.minScore;this.startTime=this.time}else if(event.event=="status")if(event.params==HN.Context.prototype.ST_STARTGAME)this.reset()},setScore:function(director){this.currentScore>>=0;var str=""+this.currentScore;while(str.length<6)str="0"+str;this.numbers=[];var i=0;for(i=0;i<str.length;i++){this.numbers[i]=parseInt(str.charAt(i));this.childrenList[i].setAnimationImageIndex([this.numbers[i]])}},animate:function(director,time){if(time>=this.startTime&&time<this.startTime+
this.scoreDuration){this.currentScore=this.minScore+this.incrementScore*this.interpolator.getPosition((time-this.startTime)/this.scoreDuration).y;this.setScore(director)}else if(this.currentScore!=this.maxScore){this.currentScore=this.maxScore;this.setScore(director)}return HN.ScoreActor.superclass.animate.call(this,director,time)}};extend(HN.ScoreActor,CAAT.ActorContainer)})();
(function(){HN.AnimatedBackground=function(){HN.AnimatedBackground.superclass.constructor.call(this);return this};HN.AnimatedBackground.prototype={timer:null,context:null,scene:null,altitude:0.05,altitudeMeterByIncrement:2,currentAltitude:0,initialOffset:0,currentOffset:0,setData:function(scene,gameContext){this.context=gameContext;this.scene=scene;return this},contextEvent:function(event){var me=this;if(event.source=="context")if(event.event=="status")if(event.params==HN.Context.prototype.ST_ENDGAME){if(this.timer!=
null){this.timer.cancel();this.timer=null;this.currentOffset=this.backgroundImage.offsetY;this.addBehavior((new CAAT.GenericBehavior).setFrameTime(this.scene.time,1E3).setValues(this.currentOffset,this.initialOffset,null,null,function(value,target,actor){me.setBackgroundImageOffset(0,value)}).setInterpolator((new CAAT.Interpolator).createBounceOutInterpolator(false)));me.currentAltitude=me.initialOffset}}else{if(event.params==HN.Context.prototype.ST_LEVEL_RESULT)this.timer.cancel()}else if(event.event==
"levelchange")this.startTimer()},startTimer:function(){var me=this;if(!this.timer)this.timer=this.scene.createTimer(me.scene.time,200,function timeout(sceneTime,time,timerTask){me.currentAltitude+=me.altitude;if(me.currentAltitude>0)me.currentAltitude=0;me.setBackgroundImageOffset(0,me.currentAltitude);timerTask.reset(me.scene.time);me.context.incrementAltitude(me.altitudeMeterByIncrement)},null,null)},setInitialOffset:function(offset){this.setBackgroundImageOffset(0,offset);this.initialOffset=offset;
this.currentAltitude=offset;return this},caer:function(time){this.setBackgroundImageOffset(0,this.currentOffset+(this.initialOffset-this.currentOffset)*time)}};extend(HN.AnimatedBackground,CAAT.Actor)})();
(function(){HN.BackgroundImage=function(){HN.BackgroundImage.superclass.constructor.call(this);return this};HN.BackgroundImage.prototype={setupBehavior:function(director,bFirstTime){var is_bg=Math.random()<0.4;this.setBackgroundImage(director.getImage("cloud"+(is_bg?"b":"")+(4*Math.random()>>0)),true);var t=3E4*(is_bg?1.5:1)+5E3*Math.random()*2;var me=this;var ix0,ix1,iy0,iy1;var dw=director.width;var dh=director.height-200;var ih=this.backgroundImage.height;var iw=this.backgroundImage.width;if(bFirstTime){ix0=
dw*Math.random();iy0=dh*Math.random();t=(dw-ix0)/dw*t}else{ix0=-iw-iw*Math.random();iy0=dh*Math.random()}ix1=dw+iw*Math.random();iy1=iy0+Math.random()*30;this.emptyBehaviorList();this.addBehavior((new CAAT.PathBehavior).setFrameTime(this.time,t).setPath((new CAAT.Path).setLinear(ix0,iy0,ix1,iy1)).addListener({behaviorExpired:function(behavior,time,actor){me.setupBehavior(director,false)},behaviorApplied:function(actor,time,normalizedTime,value){}}));return this}};extend(HN.BackgroundImage,CAAT.Actor)})();
(function(){HN.LevelActor=function(){HN.LevelActor.superclass.constructor.call(this);this.numbers=[];return this};HN.LevelActor.prototype={font:null,numbers:null,initialize:function(font,background){this.font=font;for(var i=0;i<2;i++){var digit=(new CAAT.Actor).setBackgroundImage(font.getRef(),true).setVisible(false);this.numbers.push(digit);this.addChild(digit)}this.setBackgroundImage(background,true);return this},contextEvent:function(event){if(event.source=="context")if(event.event=="levelchange"){this.level=
event.params;var snumber=this.level.toString();var i,number;var correction=this.font.singleWidth*0.8;for(i=0;i<snumber.length;i++){number=parseInt(snumber.charAt(i));this.numbers[i].setSpriteIndex(number).setLocation((this.width-snumber.length*correction)/2+i*correction,24).setVisible(true)}for(;i<this.numbers.length;i++)this.numbers[i].setVisible(false)}}};extend(HN.LevelActor,CAAT.ActorContainer)})();
(function(){HN.MultiplierActor=function(){HN.MultiplierActor.superclass.constructor.call(this);this.actorx=(new CAAT.Actor).setVisible(false);this.actornum=new CAAT.Actor;this.addChild(this.actorx);this.addChild(this.actornum);return this};HN.MultiplierActor.prototype={actorx:null,actornum:null,multiplier:0,setImages:function(font,x){this.actorx.setBackgroundImage(x,true);this.actornum.setBackgroundImage(font,true).setVisible(false);var xoffset=(this.width-x.width-font.singleWidth)/2+10;this.actorx.setLocation(xoffset,
this.height-x.height+5);this.actornum.setLocation(xoffset+x.width,0);return this},hideMultiplier:function(){this.multiplier=0;this.actornum.setVisible(false);this.actorx.setVisible(false)},b1:function(actor){actor.emptyBehaviorList();var cb=(new CAAT.ContainerBehavior).setFrameTime(this.time,1E3).setCycle(true);var ab=(new CAAT.AlphaBehavior).setFrameTime(0,1E3).setValues(0.6,0.8).setPingPong();cb.addBehavior(ab);actor.addBehavior(cb)},b2:function(actor){var me=this;actor.emptyBehaviorList();var ab=
(new CAAT.AlphaBehavior).setFrameTime(this.time,300).setValues(this.alpha,0).addListener({behaviorExpired:function(behavior,time,actor){me.hideMultiplier()},behaviorApplied:function(actor,time,normalizedTime,value){}});actor.addBehavior(ab)},contextEvent:function(event){if(event.source=="context")if(event.event=="multiplier")if(event.params.multiplier>1){this.multiplier=event.params.multiplier;this.actornum.setVisible(true).setAnimationImageIndex([this.multiplier]);this.actorx.setVisible(true);this.emptyBehaviorList();
this.addBehavior((new CAAT.ScaleBehavior).setFrameTime(this.time,1E3).setValues(0.9,1.1,0.9,1.1).setPingPong().setCycle(true));this.b1(this.actorx);this.b1(this.actornum)}else{this.emptyBehaviorList();this.b2(this.actorx);this.b2(this.actornum)}else if(event.event=="status")if(event.params==HN.Context.prototype.ST_ENDGAME)this.hideMultiplier()}};extend(HN.MultiplierActor,CAAT.ActorContainer)})();
(function(){HN.MultiplierActorS=function(){HN.MultiplierActorS.superclass.constructor.call(this);this.star=new CAAT.Actor;this.container=new CAAT.ActorContainer;this.actorx=new CAAT.Actor;this.actornum=new CAAT.Actor;this.addChild(this.star);this.addChild(this.container);this.container.addChild(this.actorx);this.container.addChild(this.actornum);this.container.setGlobalAlpha(true);return this};HN.MultiplierActorS.prototype={actorx:null,actornum:null,star:null,multiplier:0,setImages:function(font,
x,star,scene){this.scene=scene;this.setOutOfFrameTime();this.star.setBackgroundImage(star);var S=this.star.width/2;this.actorx.setBackgroundImage(x,false).setBounds(0,(this.star.height-S)/2,S,S).setImageTransformation(CAAT.SpriteImage.prototype.TR_FIXED_TO_SIZE);this.actornum.setBackgroundImage(font,true).setScale(0.4,0.4).setLocation(0,-20);this.setSize(this.star.width,this.star.height);this.container.setSize(this.star.width,this.star.height);this.container.setRotation(Math.PI/16);this.star.setLocation(0,
0);return this},hideMultiplier:function(){this.multiplier=0;this.setOutOfFrameTime()},b1:function(actor){actor.emptyBehaviorList();var cb=(new CAAT.ContainerBehavior).setFrameTime(this.scene.time,1E3).setCycle(true);var ab=(new CAAT.AlphaBehavior).setFrameTime(0,1E3).setValues(0.8,1).setPingPong();var sb=(new CAAT.ScaleBehavior).setFrameTime(0,1E3).setValues(0.8,1,0.8,1).setPingPong();cb.addBehavior(ab);cb.addBehavior(sb);actor.addBehavior(cb)},b2:function(actor){var me=this;actor.emptyBehaviorList();
var ab=(new CAAT.AlphaBehavior).setFrameTime(this.time,300).setValues(this.alpha,0).addListener({behaviorExpired:function(behavior,time,actor){me.hideMultiplier()},behaviorApplied:function(actor,time,normalizedTime,value){}});actor.addBehavior(ab)},contextEvent:function(event){if(event.source=="context")if(event.event=="multiplier")if(event.params.multiplier>1){this.multiplier=event.params.multiplier;this.actornum.setAnimationImageIndex([this.multiplier]);this.setFrameTime(0,Number.MAX_VALUE);this.emptyBehaviorList();
this.star.addBehavior((new CAAT.RotateBehavior).setFrameTime(this.time,1E3).setValues(0,Math.PI*2).setCycle(true));this.b1(this.container)}else{this.emptyBehaviorList();this.b2(this.container)}else if(event.event=="status")if(event.params==HN.Context.prototype.ST_ENDGAME)this.hideMultiplier()}};extend(HN.MultiplierActorS,CAAT.ActorContainer)})();
(function(){HN.GameScene=function(){this.gameListener=[];return this};HN.GameScene.prototype={gameRows:15,gameColumns:20,context:null,directorScene:null,selectionPath:null,bricksContainer:null,brickActors:null,particleContainer:null,selectionStarCache:null,fallingStarCache:null,brickWidth:0,brickHeight:0,buttonImage:null,starsImage:null,numbersImage:null,numbersImageSmall:null,levelActor:null,chronoActor:null,timer:null,scrollTimer:null,scoreActor:null,respawnClock:null,scoreActorEG:null,levelActorEG:null,
endGameActor:null,endLevelActor:null,endLevelMessage:null,director:null,actorInitializationCount:0,backgroundContainer:null,music:null,sound:null,gameListener:null,create:function(director,gameMode){var me=this;var i,j;this.director=director;this.bricksImageAll=(new CAAT.SpriteImage).initialize(director.getImage("bricks"),9,10);this.brickWidth=this.bricksImageAll.singleWidth;this.brickHeight=this.bricksImageAll.singleHeight;this.buttonImage=(new CAAT.SpriteImage).initialize(director.getImage("buttons"),
7,3);this.starsImage=(new CAAT.SpriteImage).initialize(director.getImage("stars"),24,6);this.numbersImage=(new CAAT.SpriteImage).initialize(director.getImage("numbers"),1,10);this.numbersImageSmall=(new CAAT.SpriteImage).initialize(director.getImage("numberssmall"),1,10);this.context=(new HN.Context).create(8,8,9).addContextListener(this);this.gameRows=this.context.rows;this.gameColumns=this.context.columns;this.directorScene=director.createScene();this.directorScene.activated=function(){me.context.setGameMode(me.gameMode);
me.prepareSound()};var dw=director.width;var dh=director.height;this.backgroundContainer=(new HN.AnimatedBackground).setBounds(0,0,dw,dh).setBackgroundImage(director.getImage("background-1")).setInitialOffset(-director.getImage("background-1").height+dh).setData(this.directorScene,this.context);this.directorScene.addChild(this.backgroundContainer);this.context.addContextListener(this.backgroundContainer);this.brickActors=[];for(i=0;i<4;i++){var cl=(new HN.BackgroundImage).setupBehavior(director,true);
this.directorScene.addChild(cl)}this.bricksContainer=(new CAAT.ActorContainer).create().setSize(this.gameColumns*this.brickWidth,this.gameRows*this.brickHeight);var TT=15;var bricksCY=dw>dh?10:dh-this.brickHeight*this.gameRows-105;var bricksCX=dw>dh?bricksCY+TT:(dw-this.gameColumns*this.brickWidth)/2;this.bricksContainer.setLocation(bricksCX,bricksCY);this.directorScene.addChild(this.bricksContainer);for(i=0;i<this.gameRows;i++){this.brickActors.push([]);for(j=0;j<this.gameColumns;j++){var brick=
(new HN.BrickActor).initialize(this.bricksImageAll,this.context.getBrick(i,j)).setLocation(-100,-100);this.brickActors[i].push(brick);this.bricksContainer.addChild(brick)}}var HH=55;var WW=10;var controls=new CAAT.ActorContainer;if(dw>dh)controls.setBounds(this.bricksContainer.x+this.bricksContainer.width+bricksCX+10,-15,dw-bricksCX-(this.bricksContainer.x+this.bricksContainer.width)-bricksCX,this.director.height-40);else controls.setBounds(0,0,dw,this.bricksContainer.y-5);this.directorScene.addChild(controls);
var restart=new CAAT.Actor;if(dw>dh)restart.setAsButton(this.buttonImage.getRef(),9,10,11,9,function(button){me.context.timeUp()}).setLocation((controls.width-this.buttonImage.singleWidth)/2-15,controls.height-this.buttonImage.singleHeight-15);else restart.setAsButton((new CAAT.SpriteImage).initialize(director.getImage("boton-salir"),1,3),0,2,0,0,function(button){me.context.timeUp()}).setLocation(0,0);restart.contextEvent=function(event){if(event.source=="context")if(event.event=="levelchange")restart.enableEvents(true);
else if(event.event=="status")if(event.params==HN.Context.prototype.ST_STARTGAME)restart.enableEvents(true);else if(event.params==HN.Context.prototype.ST_ENDGAME||event.params==HN.Context.prototype.ST_LEVEL_RESULT)restart.enableEvents(false)};this.context.addContextListener(restart);controls.addChild(restart);var guess=(new HN.GuessNumberActor).setNumbersImage(this.numbersImage,director.getImage("target-number"));if(dw>dh)guess.setLocation(-15,20,controls.width,70);else guess.setLocation(WW,HH,controls.width,
70);this.context.addContextListener(guess);controls.addChild(guess);this.scoreActor=(new HN.ScoreActor).initialize(this.numbersImageSmall,director.getImage("points"));if(dw>dh)this.scoreActor.setLocation(0,250);else this.scoreActor.setLocation(dw-this.scoreActor.width-WW,HH);controls.addChild(this.scoreActor);this.context.addContextListener(this.scoreActor);this.chronoActor=(new HN.Chrono).setImages(director.getImage("time"),director.getImage("timeprogress"));if(dw>dh)this.chronoActor.setLocation(0,
310);else this.chronoActor.setLocation(dw-this.chronoActor.width-WW,guess.y+guess.height-this.chronoActor.height-15);this.context.addContextListener(this.chronoActor);controls.addChild(this.chronoActor);this.levelActor=(new HN.LevelActor).initialize(this.numbersImageSmall,dw>dh?director.getImage("level"):director.getImage("level-small"));if(dw>dh)this.levelActor.setLocation(0,170);else this.levelActor.setLocation((this.scoreActor.x-(guess.x+guess.width)-this.levelActor.width)/2+(guess.x+guess.width),
guess.y+guess.height-this.levelActor.height-10);this.context.addContextListener(this.levelActor);controls.addChild(this.levelActor);var multiplier;var star=director.getImage("multiplier-star");multiplier=(new HN.MultiplierActorS).setLocation(this.scoreActor.x+this.scoreActor.width-star.width*0.8,this.scoreActor.y-star.height*0.3).setImages(this.numbersImage,director.getImage("multiplier"),star,this.directorScene);controls.addChild(multiplier);this.context.addContextListener(multiplier);if(!HN.LOWQUALITY){this.particleContainer=
(new CAAT.ActorContainer).create().setBounds(this.bricksContainer.x,this.bricksContainer.y,dw,dh).enableEvents(false);this.directorScene.addChild(this.particleContainer);this.create_cache()}this.selectionPath=(new HN.SelectionPath(director)).setBounds(this.bricksContainer.x,this.bricksContainer.y,this.gameColumns*this.brickWidth,this.gameRows*this.brickHeight);this.selectionPath.enableEvents(false);this.directorScene.addChild(this.selectionPath);this.context.addContextListener(this.selectionPath);
this.create_respawntimer(director);if(dw>dh)this.respawnClock.setLocation(2,2);else this.respawnClock.setLocation(this.levelActor.x+(this.levelActor.width-this.respawnClock.width)/2,this.levelActor.y-this.respawnClock.height);this.create_EndGame(director);this.create_EndLevel(director);this.soundControls(director);var me=this;var C=20;var count=0;var fpsc=0;var fps=(new CAAT.Actor).setBounds(0,0,120,40);fps.__fps=0;fps.paintActor=function(director,time){this.invalidate();CAAT.Actor.prototype.__paintActor.call(this,
director,time);fpsc+=CAAT.FRAME_TIME;count++;if(!(count%C)){this.__fps=C*1E3/fpsc>>0;fpsc=0;count=0}this.__fps=""+this.__fps;var ctx=director.ctx;var im=me.numbersImageSmall;ctx.fillStyle="rgb(32,32,32)";ctx.fillRect(0,0,this.__fps.length*im.singleWidth+10,10+im.singleHeight);for(var i=0;i<this.__fps.length;i++){var c=this.__fps.charAt(i);c=parseInt(c,10);if(c>=0&&c<=9){im.setSpriteIndex(c);im.paint(director,0,i*im.singleWidth+5,5)}}};this.directorScene.addChild(fps);return this},create_cache:function(){this.selectionStarCache=
[];this.fallingStarCache=[];var i,actor,me;me=this;for(i=0;i<16*4;i++){actor=this.createSelectionStarCache();actor.addListener({actorLifeCycleEvent:function(actor,event,time){if(event==="destroyed")me.selectionStarCache.push(actor)}});actor.__parent=this.particleContainer;this.selectionStarCache.push(actor)}for(i=0;i<384;i++){var actor=this.createCachedStar();actor.addListener({actorLifeCycleEvent:function(actor,event,time){if(event==="destroyed")me.fallingStarCache.push(actor)}});actor.__parent=
this.particleContainer;this.fallingStarCache.push(actor)}},createCachedStar:function(director){var iindex=Math.random()*this.starsImage.columns>>0;var actor=new CAAT.Actor;actor.__imageIndex=iindex;actor.setBackgroundImage(this.starsImage.getRef().setAnimationImageIndex([iindex]),true).enableEvents(false).setDiscardable(true).setOutOfFrameTime().addBehavior(this.director.getRenderType()==="CSS"?(new CAAT.AlphaBehavior).setValues(1,0.1).setId("__alpha"):(new CAAT.GenericBehavior).setValues(1,0.1,null,
null,function(value,target,actor){actor.backgroundImage.setAnimationImageIndex([actor.__imageIndex+(23-(23*value>>0))*actor.backgroundImage.getColumns()])}).setId("__alpha"));return actor},createSelectionStarCache:function(){var actor=this.createCachedStar();var trb=(new CAAT.PathBehavior).setFrameTime(this.directorScene.time,0).setPath((new CAAT.LinearPath).setInitialPosition(0,0).setFinalPosition(0,0)).setInterpolator((new CAAT.Interpolator).createExponentialOutInterpolator(2,false));actor.__trb=
trb;actor.addBehavior(trb);var ab=null;if(this.director.getRenderType()==="CSS")ab=(new CAAT.AlphaBehavior).setValues(1,0.1);else ab=(new CAAT.GenericBehavior).setValues(1,0.1,null,null,function(value,target,actor){actor.backgroundImage.setAnimationImageIndex([actor.__imageIndex+(23-(23*value>>0))*actor.backgroundImage.getColumns()])});actor.__ab=ab;actor.addBehavior(ab);return actor},create_respawntimer:function(director){var clock=(new HN.RespawnClockActor).create().initialize(director,this.directorScene,
this.context);this.directorScene.addChild(clock);this.context.addContextListener(clock);this.respawnClock=clock;this.respawnClock.setOutOfFrameTime()},create_EndLevel:function(director){this.endLevelActor=(new CAAT.ActorContainer).setBackgroundImage(director.getImage("levelclear"),true);var me=this;var me_endLevel=this.endLevelActor;var continueButton=(new CAAT.Actor).setAsButton(this.buttonImage.getRef(),12,13,14,12,function(button){director.audioPlay("11");me.removeGameEvent(me.endLevelActor,function(){me.context.nextLevel()})});
continueButton.setLocation((this.endLevelActor.width-continueButton.width)/2,this.endLevelActor.height-continueButton.height-50);this.endLevelMessage=(new CAAT.Actor).setBackgroundImage(director.getImage("msg1"),true);this.endLevelActor.addChild(continueButton);this.endLevelActor.addChild(this.endLevelMessage);this.endLevelActor.setOutOfFrameTime();this.directorScene.addChild(this.endLevelActor)},create_EndGame:function(director,go_to_menu_callback){var me=this;this.endGameActor=(new CAAT.ActorContainer).setBackgroundImage(director.getImage("background_op"),
true);var menu=(new CAAT.Actor).setAsButton(this.buttonImage.getRef(),15,16,17,15,function(button){director.audioPlay("11");me.endGameActor.enableEvents(false);var a0;var a1;a0=CAAT.Actor.prototype.ANCHOR_BOTTOM;a1=CAAT.Actor.prototype.ANCHOR_TOP;director.easeInOut(0,CAAT.Scene.EASE_TRANSLATE,a0,1,CAAT.Scene.EASE_TRANSLATE,a1,1E3,false,(new CAAT.Interpolator).createExponentialInOutInterpolator(3,false),(new CAAT.Interpolator).createExponentialInOutInterpolator(3,false))});var me_endGame=this.endGameActor;
var restart=(new CAAT.Actor).setAsButton(this.buttonImage.getRef(),12,13,14,12,function(button){director.audioPlay("11");me.removeGameEvent(me.endGameActor,function(){me.prepareSceneIn(me.context.gameMode);me.context.initialize()})});if(CAAT.browser!=="iOS"){var tweetImage=(new CAAT.SpriteImage).initialize(director.getImage("tweet"),1,3);var tweet=(new CAAT.Actor).setAsButton(tweetImage,0,1,2,0,function(button){var url="http://twitter.com/home/?status=Wow! I just scored "+me.context.score+" points (mode "+
me.context.gameMode.name+") in Sumon. Beat that! http://labs.hyperandroid.com/static/sumon/sumon.html";window.open(url,"blank","")})}var x=45;var y=this.endGameActor.height-35-menu.height;menu.setLocation(x,y);restart.setLocation(x+menu.width+10,y);this.endGameActor.addChild(menu);this.endGameActor.addChild(restart);var __buttons=[menu,restart];if(CAAT.browser!=="iOS"){tweet.setLocation(375,this.endGameActor.height-25-tweetImage.height);this.endGameActor.addChild(tweet);__buttons.push(tweet)}else CAAT.modules.LayoutUtils.row(this.endGameActor,
__buttons,{padding_left:50,padding_right:50,top:y});this.levelActorEG=(new HN.LevelActor).initialize(this.numbersImageSmall,director.getImage("level"));this.levelActorEG.setBounds((this.endGameActor.width-this.levelActorEG.width)/2,265,this.levelActorEG.width,this.levelActorEG.height);this.endGameActor.addChild(this.levelActorEG);this.context.addContextListener(this.levelActorEG);this.scoreActorEG=(new HN.ScoreActor).create().setBounds((this.endGameActor.width-this.scoreActor.width)/2|0,335,this.scoreActor.width,
this.scoreActor.height).initialize(this.numbersImageSmall,director.getImage("points"));this.endGameActor.addChild(this.scoreActorEG);this.context.addContextListener(this.scoreActorEG);this.endGameActor.setOutOfFrameTime();this.directorScene.addChild(this.endGameActor)},getBrickPosition:function(row,column){return{x:(this.context.columns-this.context.currentColumns)/2*this.brickWidth+column*this.brickWidth,y:(this.context.rows-this.context.currentRows)/2*this.brickHeight+row*this.brickHeight}},uninitializeActors:function(){this.selectionPath.initialize();
var i,j;var radius=Math.max(this.director.width,this.director.height);var angle=Math.PI*2*Math.random();var me=this;var p0=Math.random()*this.director.width;var p1=Math.random()*this.director.height;var p2=Math.random()*this.director.width;var p3=Math.random()*this.director.height;for(i=0;i<this.gameRows;i++)for(j=0;j<this.gameColumns;j++){var brickActor=this.brickActors[i][j];if(brickActor.brick.removed)continue;var random=Math.random()*1E3;brickActor.pb.emptyListenerList().setPath((new CAAT.CurvePath).setCubic(brickActor.x,
brickActor.y,p0,p1,p2,p3,radius/2+Math.cos(angle)*radius,radius/2+Math.sin(angle)*radius)).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,false));if(!HN.LOWQUALITY)brickActor.pb.setFrameTime(this.directorScene.time,1E3+random);else brickActor.pb.setFrameTime(this.directorScene.time+i*200,700+random/3);if(!HN.LOWQUALITY)brickActor.sb.emptyListenerList().setFrameTime(this.directorScene.time,1E3+random).setValues(1,0.1,1,0.1).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,
false));brickActor.enableEvents(false).setAlpha(1).resetTransform()}},initializeActors:function(){this.selectionPath.initialize();var i,j;var maxt=0;var animationDuration;var animationStartTime;var stepTime=30;var brickPosition;var context;var radius=Math.max(this.director.width,this.director.height);var angle=Math.PI*2*Math.random();var me=this;var p0=Math.random()*this.director.width;var p1=Math.random()*this.director.height;var p2=Math.random()*this.director.width;var p3=Math.random()*this.director.height;
for(i=0;i<this.gameRows;i++)for(j=0;j<this.gameColumns;j++){var brickActor=this.brickActors[i][j];if(brickActor.brick.removed)brickActor.setOutOfFrameTime();else{brickActor.setFrameTime(this.directorScene.time,Number.MAX_VALUE).setAlpha(1).enableEvents(true).reset();var random=Math.random()*1E3>>0;var brickPosition=this.getBrickPosition(i,j);brickActor.pb.emptyListenerList().setPath((new CAAT.CurvePath).setCubic(radius/2+Math.cos(angle)*radius,radius/2+Math.sin(angle)*radius,p0,p1,p2,p3,brickPosition.x,
brickPosition.y)).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,false)).setFrameTime(this.directorScene.time,1E3+random);brickActor.sb.emptyListenerList().setValues(0.1,1,0.1,1).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,false)).setFrameTime(this.directorScene.time,1E3+random);brickActor.enableEvents(false);var actorCount=0;brickActor.pb.addListener({behaviorExpired:function(behavior,time,actor){actorCount++;if(actorCount==me.context.getLevelActiveBricks()){brickActor.pb.emptyListenerList();
if(me.context.status==me.context.ST_INITIALIZING)me.context.setStatus(me.context.ST_RUNNNING)}}})}}context=this.context;this.directorScene.createTimer(this.directorScene.time,maxt,function timeout(){if(context.status==context.ST_INITIALIZING)context.setStatus(context.ST_RUNNNING)});this.actorInitializationCount=0},contextEvent:function(event){var i,j;var brickActor;var me=this;if(event.source=="context")if(event.event=="levelchange")this.bricksContainer.enableEvents(true);else{if(event.event=="status")if(event.params==
this.context.ST_INITIALIZING){this.director.audioPlay("mostrarpanel");this.initializeActors()}else if(event.params==this.context.ST_RUNNNING){for(i=0;i<this.gameRows;i++)for(j=0;j<this.gameColumns;j++)brickActor=this.brickActors[i][j].set();this.cancelTimer();this.enableTimer()}else if(event.params==this.context.ST_LEVEL_RESULT){this.director.audioPlay("10");this.cancelTimer();var me=this;var timer=this.directorScene.createTimer(this.directorScene.time,1E3,function(sceneTime,time,timerTask){me.endLevel()},
null)}else if(event.params==this.context.ST_ENDGAME){this.director.audioPlay("01");this.endGame()}}else if(event.source==="brick"){if(event.event==="selection"){this.director.audioPlay(event.params.selected?"11":"deseleccionar");this.brickSelectionEvent(event)}else if(event.event==="selectionoverflow"){this.director.audioPlay("sumamal");this.selectionOverflowEvent(event)}else if(event.event==="selection-cleared"){CAAT.setCursor("default");this.director.audioPlay("12");this.selectionClearedEvent(event)}else if(event.event===
"rearranged")this.rearrange(event);else if(event.event==="respawn")this.respawn(event);this.selectionPath.setup(this.context,this.brickActors)}},respawn:function(event){var respawnData=event.params;for(var i=0;i<respawnData.length;i++){var row=respawnData[i].row;var col=respawnData[i].column;var brickPos=this.getBrickPosition(row,col);this.brickActors[row][col].respawn(brickPos.x,brickPos.y)}},rearrange:function(event){var fromRow=event.params.fromRow;var toRow=event.params.toRow;var column=event.params.column;
var tmp=this.brickActors[fromRow][column];this.brickActors[fromRow][column]=this.brickActors[toRow][column];this.brickActors[toRow][column]=tmp;var brickActor=this.brickActors[toRow][column];var brickPos=this.getBrickPosition(toRow,column);brickActor.rearrange(brickPos.x,brickPos.y)},brickSelectionEvent:function(event){var me=this;var brick=event.params;var brickActor=this.brickActors[brick.row][brick.column];if(brick.selected){if(!HN.LOWQUALITY){var x0=brickActor.x+brickActor.width/2-this.starsImage.singleWidth/
2;var y0=brickActor.y+brickActor.height/2-this.starsImage.singleHeight/2;var R=Math.sqrt(brickActor.width*brickActor.width+brickActor.height*brickActor.height)/2;var N=16;var i;var rad=Math.PI/N*2;var T=300;for(i=0;i<N;i++){var x1=x0+R*Math.cos(i*rad);var y1=y0+R*Math.sin(i*rad);if(this.selectionStarCache.length){var actor=this.selectionStarCache.shift();actor.setFrameTime(this.directorScene.time,T);actor.backgroundImage.setAnimationImageIndex([Math.random()*6>>0]);actor.__trb.setFrameTime(this.directorScene.time,
T);actor.__trb.path.setInitialPosition(x0,y0).setFinalPosition(x1,y1);actor.__ab.setFrameTime(this.directorScene.time,T);actor.__parent.addChild(actor)}}}brickActor.setSelected()}else brickActor.reset()},selectionOverflowEvent:function(event){var i,j;var selectedContextBricks=event.params;var actor;for(i=0;i<selectedContextBricks.length;i++)this.brickActors[selectedContextBricks[i].row][selectedContextBricks[i].column].reset();this.bricksContainer.enableEvents(false);var activeActors=[];for(i=0;i<
this.gameRows;i++)for(j=0;j<this.gameColumns;j++){actor=this.brickActors[i][j];if(!actor.brick.removed)activeActors.push(actor)}var me=this;for(i=0;i<activeActors.length;i++)activeActors[i].selectionOverflow();var ttimer;ttimer=this.directorScene.createTimer(this.directorScene.time,HN.BrickActor.prototype.timeOverflow+100,function timeout(sceneTime,time,timerTask){me.bricksContainer.enableEvents(true)},function tick(sceneTime,time,timerTask){})},selectionClearedEvent:function(event){var selectedContextBricks=
event.params;var i;for(i=0;i<selectedContextBricks.length;i++){var actor=this.brickActors[selectedContextBricks[i].row][selectedContextBricks[i].column];actor.parent.setZOrder(actor,Number.MAX_VALUE);actor.selectionCleared(this,this.director.height)}this.timer.reset(this.directorScene.time)},showLevelInfo:function(){},prepareSceneIn:function(gameMode){var i,j;this.gameMode=gameMode;if(this.gameMode.respawn)this.respawnClock.enable(true,this.gameMode.respawn_time);else this.respawnClock.enable(false,
this.gameMode.respawn_time);this.bricksContainer.enableEvents(true);for(i=0;i<this.gameRows;i++)for(j=0;j<this.gameColumns;j++)this.brickActors[i][j].setLocation(-100,-100);this.selectionPath.initialize();this.chronoActor.tick(0,0);this.scoreActor.reset();this.endGameActor.setFrameTime(-1,0)},endGame:function(){this.fireEvent("end-game",{score:this.context.score,level:this.context.level,gameMode:this.context.gameMode.name});this.showGameEvent(this.endGameActor)},addGameListener:function(gameListener){this.gameListener.push(gameListener)},
fireEvent:function(type,data){for(var i=0,l=this.gameListener.length;i<l;i++)this.gameListener[i].gameEvent(type,data)},setDifficulty:function(level){this.context.difficulty=level},cancelTimer:function(){if(this.timer!=null)this.timer.cancel();this.timer=null},enableTimer:function(){var me=this;this.timer=this.directorScene.createTimer(this.directorScene.time,this.context.turnTime,function timeout(sceneTime,time,timerTask){me.context.timeUp()},function tick(sceneTime,time,timerTask){me.chronoActor.tick(time,
timerTask.duration)})},setGameMode:function(gameMode){this.context.setGameMode(gameMode)},endLevel:function(){var level=this.context.level;if(level>7)level=7;var image=this.director.getImage("msg"+level);if(null!=image){this.endLevelMessage.setBackgroundImage(image,true);this.endLevelMessage.setLocation((this.endLevelMessage.parent.width-image.width)/2,this.endLevelMessage.parent.height/2-25)}this.showGameEvent(this.endLevelActor)},removeGameEvent:function(actor,callback){actor.enableEvents(false);
this.uninitializeActors();var me=this;actor.emptyBehaviorList();actor.addBehavior((new CAAT.PathBehavior).setFrameTime(actor.time,2E3).setPath((new CAAT.LinearPath).setInitialPosition(actor.x,actor.y).setFinalPosition(actor.x,-actor.height)).setInterpolator((new CAAT.Interpolator).createExponentialInInterpolator(2,false)).addListener({behaviorExpired:function(behavior,time,actor){actor.setOutOfFrameTime();callback()}}))},showGameEvent:function(actor){this.cancelTimer();this.bricksContainer.enableEvents(false);
var x=(this.directorScene.width-actor.width)/2;var y=(this.directorScene.height-actor.height)/2-100;var me_endGameActor=actor;actor.emptyBehaviorList().setFrameTime(this.directorScene.time,Number.MAX_VALUE).enableEvents(false).addBehavior((new CAAT.PathBehavior).setFrameTime(this.directorScene.time,2E3).setPath((new CAAT.LinearPath).setInitialPosition(x,this.directorScene.height).setFinalPosition(x,y)).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,false)).addListener({behaviorExpired:function(behavior,
time,actor){me_endGameActor.enableEvents(true);me_endGameActor.emptyBehaviorList();me_endGameActor.addBehavior((new CAAT.PathBehavior).setFrameTime(time,3E3).setPath((new CAAT.LinearPath).setInitialPosition(me_endGameActor.x,me_endGameActor.y).setFinalPosition(me_endGameActor.x+(Math.random()<0.5?1:-1)*(5+5*Math.random()),me_endGameActor.y+(Math.random()<0.5?1:-1)*(5+5*Math.random()))).addListener({behaviorExpired:function(behavior,time,actor){behavior.setFrameTime(time,3E3);behavior.path.setFinalPosition(me_endGameActor.x+
(Math.random()<0.5?1:-1)*(5+5*Math.random()),me_endGameActor.y+(Math.random()<0.5?1:-1)*(5+5*Math.random()))},behaviorApplied:function(behavior,time,normalizedTime,actor,value){}}).setInterpolator((new CAAT.Interpolator).createExponentialInOutInterpolator(3,true)))},behaviorApplied:function(behavior,time,normalizedTime,actor,value){}}))},soundControls:function(director){var ci=(new CAAT.SpriteImage).initialize(director.getImage("sound"),2,3);var dw=director.width;var dh=director.height;var music=
(new CAAT.Actor).setAsButton(ci.getRef(),0,1,0,0,function(button){director.audioManager.setMusicEnabled(!director.audioManager.isMusicEnabled());if(director.audioManager.isMusicEnabled())button.setButtonImageIndex(0,1,0,0);else button.setButtonImageIndex(2,2,2,2)}).setBounds(dw-ci.singleWidth-2,2,ci.singleWidth,ci.singleHeight);var sound=(new CAAT.Actor).setAsButton(ci.getRef(),3,4,3,3,function(button){director.audioManager.setSoundEffectsEnabled(!director.audioManager.isSoundEffectsEnabled());if(director.audioManager.isSoundEffectsEnabled())button.setButtonImageIndex(3,
4,3,3);else button.setButtonImageIndex(5,5,5,5)});if(director.width>director.height)sound.setBounds(dw-ci.singleWidth-2,2+2+ci.singleHeight,ci.singleWidth,ci.singleHeight);else sound.setBounds(dw-ci.singleWidth*2-2,2+2,ci.singleWidth,ci.singleHeight);music.prepare=function(){if(director.audioManager.isMusicEnabled())this.setButtonImageIndex(0,1,0,0);else this.setButtonImageIndex(2,2,2,2)};sound.prepare=function(){if(director.audioManager.isSoundEffectsEnabled())this.setButtonImageIndex(3,4,3,3);else this.setButtonImageIndex(5,
5,5,5)};this.directorScene.addChild(sound);this.directorScene.addChild(music);this.music=music;this.sound=sound},prepareSound:function(){try{this.sound.prepare();this.music.prepare()}catch(e){}}}})();
